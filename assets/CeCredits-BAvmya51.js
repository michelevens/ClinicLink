import{c as w,a as q,j as e,ai as R,A as C,E as j,g as S,r as p,bX as I,a1 as A,bY as B,B as U,e as k,F as z,as as Y,bZ as O,b_ as X,b$ as J,t as g,c0 as Z}from"./index-GzcG7CSS.js";import{u as G}from"./usePageTitle-CSRQyC0a.js";import{T as E}from"./triangle-alert-DWR7AhnE.js";import{S as N}from"./shield-B4OQBYN4.js";import{D as T}from"./download-COygb2Hf.js";import{C as K}from"./chevron-up-B1BLTNfs.js";import{H}from"./hash-Dj_bhZyC.js";import{U as Q}from"./user-BvMymkx8.js";import{C as P}from"./circle-check-big-B5eOtT2b.js";import{C as D}from"./circle-x-BhxGvoPR.js";import{S as W}from"./save-Ba530v52.js";import{E as $}from"./eye-DPEVXjN5.js";const ee=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],f=w("ban",ee);const se=[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]],te=w("calendar-range",se);const re=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],L=w("history",re);const ae=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],y=w("settings-2",ae);function we(){G("CE Credits");const{user:s}=q();return s?.role==="preceptor"?e.jsx(ie,{}):s?.role==="coordinator"?e.jsx(ne,{}):s?.role==="admin"?e.jsx(oe,{}):null}function ie(){const{data:s,isLoading:n}=R(),o=s?.ce_certificates||[],a=o.filter(l=>l.status==="issued").reduce((l,m)=>l+Number(m.contact_hours),0),t=o.filter(l=>l.status==="pending").length,i=o.filter(l=>l.status==="revoked").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-stone-900",children:"My CE Credits"}),e.jsx("p",{className:"text-stone-500 mt-1",children:"Continuing education credits earned through precepting"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl border border-stone-200 p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center",children:e.jsx(C,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:a.toFixed(1)}),e.jsx("p",{className:"text-xs text-stone-500",children:"Total CE Hours"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-stone-200 p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-sky-100 flex items-center justify-center",children:e.jsx(j,{className:"w-5 h-5 text-sky-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:o.filter(l=>l.status==="issued").length}),e.jsx("p",{className:"text-xs text-stone-500",children:"Issued Certificates"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-stone-200 p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(S,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:t}),e.jsx("p",{className:"text-xs text-stone-500",children:"Pending Approval"})]})]})}),i>0&&e.jsx("div",{className:"bg-white rounded-xl border border-stone-200 p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(f,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:i}),e.jsx("p",{className:"text-xs text-stone-500",children:"Revoked"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-stone-200",children:[e.jsx("div",{className:"p-4 border-b border-stone-100",children:e.jsx("h2",{className:"font-semibold text-stone-900",children:"CE Certificates"})}),n?e.jsx("div",{className:"p-8 text-center text-stone-400",children:"Loading..."}):o.length===0?e.jsxs("div",{className:"p-8 text-center text-stone-400",children:[e.jsx(j,{className:"w-12 h-12 mx-auto mb-3 text-stone-300"}),e.jsx("p",{children:"No CE certificates yet"}),e.jsx("p",{className:"text-sm mt-1",children:"CE credits are automatically awarded when placements are completed at participating universities."})]}):e.jsx("div",{className:"divide-y divide-stone-100",children:o.map(l=>e.jsx(M,{cert:l,showActions:!1},l.id))})]})]})}function ne(){const{user:s}=q(),[n,o]=p.useState("approvals"),a=s?.universityId||null,{data:t,isLoading:i}=I(a),l=!i&&a&&(!t?.policy||!t.policy.offers_ce);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-stone-900",children:"CE Credit Management"}),e.jsx("p",{className:"text-stone-500 mt-1",children:"Manage continuing education credits, policies, and audit trails"})]}),l&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 flex items-start gap-3",children:[e.jsx(E,{className:"w-5 h-5 text-amber-600 shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-amber-800",children:"CE Credits Not Configured"}),e.jsx("p",{className:"text-sm text-amber-700 mt-0.5",children:"Your university has not enabled CE credits. Preceptors supervising your students won't receive CE certificates until you configure a CE policy."}),e.jsxs("button",{onClick:()=>o("policy"),className:"mt-2 px-4 py-1.5 rounded-lg text-sm font-medium bg-amber-600 text-white hover:bg-amber-700 transition-colors",children:[e.jsx(y,{className:"w-3.5 h-3.5 inline mr-1.5"}),"Configure CE Policy"]})]})]}),e.jsxs("div",{className:"flex gap-1 bg-stone-100 p-1 rounded-lg w-fit",children:[e.jsxs("button",{onClick:()=>o("approvals"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${n==="approvals"?"bg-white text-stone-900 shadow-sm":"text-stone-600 hover:text-stone-900"}`,children:[e.jsx(A,{className:"w-4 h-4 inline mr-1.5"}),"Approvals"]}),e.jsxs("button",{onClick:()=>o("policy"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${n==="policy"?"bg-white text-stone-900 shadow-sm":"text-stone-600 hover:text-stone-900"}`,children:[e.jsx(y,{className:"w-4 h-4 inline mr-1.5"}),"CE Policy"]}),e.jsxs("button",{onClick:()=>o("audit"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${n==="audit"?"bg-white text-stone-900 shadow-sm":"text-stone-600 hover:text-stone-900"}`,children:[e.jsx(N,{className:"w-4 h-4 inline mr-1.5"}),"Audit & Compliance"]})]}),n==="approvals"&&e.jsx(V,{universityId:a}),n==="policy"&&a&&e.jsx(me,{universityId:a}),n==="policy"&&!a&&e.jsxs("div",{className:"bg-white rounded-xl border border-stone-200 p-8 text-center text-stone-400",children:[e.jsx(E,{className:"w-12 h-12 mx-auto mb-3 text-stone-300"}),e.jsx("p",{children:"No university affiliation found. Please update your profile."})]}),n==="audit"&&e.jsx(F,{universityId:a})]})}function oe(){const[s,n]=p.useState("approvals");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-stone-900",children:"CE Credit Administration"}),e.jsx("p",{className:"text-stone-500 mt-1",children:"View all CE certificates and audit trails across the platform"})]}),e.jsxs("div",{className:"flex gap-1 bg-stone-100 p-1 rounded-lg w-fit",children:[e.jsxs("button",{onClick:()=>n("approvals"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${s==="approvals"?"bg-white text-stone-900 shadow-sm":"text-stone-600 hover:text-stone-900"}`,children:[e.jsx(A,{className:"w-4 h-4 inline mr-1.5"}),"All Certificates"]}),e.jsxs("button",{onClick:()=>n("audit"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${s==="audit"?"bg-white text-stone-900 shadow-sm":"text-stone-600 hover:text-stone-900"}`,children:[e.jsx(N,{className:"w-4 h-4 inline mr-1.5"}),"Audit & Compliance"]})]}),s==="approvals"&&e.jsx(V,{universityId:null}),s==="audit"&&e.jsx(F,{universityId:null})]})}function F({universityId:s}){const{data:n,isLoading:o}=R(s?{university_id:s}:void 0),a=n?.ce_certificates||[];if(o)return e.jsx("div",{className:"p-8 text-center text-stone-400",children:"Loading..."});if(a.length===0)return e.jsxs("div",{className:"bg-white rounded-xl border border-stone-200 p-8 text-center text-stone-400",children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-3 text-stone-300"}),e.jsx("p",{children:"No CE certificates to audit"}),e.jsx("p",{className:"text-sm mt-1",children:"Audit trails will appear here once CE certificates are created."})]});const t={total:a.length,issued:a.filter(i=>i.status==="issued").length,pending:a.filter(i=>i.status==="pending").length,revoked:a.filter(i=>i.status==="revoked").length,rejected:a.filter(i=>i.status==="rejected").length};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-3",children:[e.jsx(v,{label:"Total",value:t.total,color:"stone"}),e.jsx(v,{label:"Issued",value:t.issued,color:"emerald"}),e.jsx(v,{label:"Pending",value:t.pending,color:"amber"}),e.jsx(v,{label:"Revoked",value:t.revoked,color:"red"}),e.jsx(v,{label:"Rejected",value:t.rejected,color:"stone"})]}),e.jsxs("div",{className:"bg-sky-50 border border-sky-200 rounded-xl p-4 flex items-start gap-3",children:[e.jsx(N,{className:"w-5 h-5 text-sky-600 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-sky-800",children:"Immutable Audit Trail"}),e.jsx("p",{className:"text-sm text-sky-700 mt-0.5",children:"All CE audit events are cryptographically immutable — they cannot be edited or deleted once recorded. Every approval, rejection, revocation, download, and policy change is permanently logged for accreditation compliance."})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-stone-200",children:[e.jsx("div",{className:"p-4 border-b border-stone-100",children:e.jsxs("h2",{className:"font-semibold text-stone-900 flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-stone-400"}),"Certificate Audit Trails"]})}),e.jsx("div",{className:"divide-y divide-stone-100",children:a.map(i=>e.jsx(M,{cert:i,showActions:!0,showAuditTrail:!0},i.id))})]})]})}function v({label:s,value:n,color:o}){const a={stone:"bg-stone-50 text-stone-700",emerald:"bg-emerald-50 text-emerald-700",amber:"bg-amber-50 text-amber-700",red:"bg-red-50 text-red-700"};return e.jsxs("div",{className:`rounded-lg p-3 text-center ${a[o]||a.stone}`,children:[e.jsx("p",{className:"text-2xl font-bold",children:n}),e.jsx("p",{className:"text-xs font-medium mt-0.5",children:s})]})}function V({universityId:s}){const{data:n,isLoading:o}=R(s?{university_id:s}:void 0),a=O(),t=X(),[i,l]=p.useState(null),[m,u]=p.useState(""),d=n?.ce_certificates||[],r=d.filter(c=>c.status==="pending"),h=d.filter(c=>c.status!=="pending"),_=c=>{a.mutate(c,{onSuccess:()=>g.success("CE certificate approved and issued."),onError:x=>g.error(x.message)})},b=()=>{!i||!m.trim()||t.mutate({id:i,data:{rejection_reason:m}},{onSuccess:()=>{g.success("CE certificate rejected."),l(null),u("")},onError:c=>g.error(c.message)})};return o?e.jsx("div",{className:"p-8 text-center text-stone-400",children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[r.length>0&&e.jsxs("div",{className:"bg-white rounded-xl border border-amber-200",children:[e.jsx("div",{className:"p-4 border-b border-amber-100 bg-amber-50 rounded-t-xl",children:e.jsxs("h2",{className:"font-semibold text-amber-800 flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),"Pending Approvals (",r.length,")"]})}),e.jsx("div",{className:"divide-y divide-stone-100",children:r.map(c=>e.jsxs("div",{className:"p-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"font-medium text-stone-900",children:[c.preceptor?.first_name," ",c.preceptor?.last_name]}),e.jsxs("p",{className:"text-sm text-stone-500",children:[c.application?.slot?.specialty," at ",c.application?.slot?.site?.name]}),e.jsxs("p",{className:"text-sm text-stone-500",children:[c.contact_hours," contact hours • ",c.university?.name]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs("button",{onClick:()=>_(c.id),disabled:a.isPending,className:"px-3 py-1.5 rounded-lg text-sm font-medium bg-emerald-50 text-emerald-700 hover:bg-emerald-100 transition-colors",children:[e.jsx(P,{className:"w-4 h-4 inline mr-1"}),"Approve"]}),e.jsxs("button",{onClick:()=>l(c.id),className:"px-3 py-1.5 rounded-lg text-sm font-medium bg-red-50 text-red-700 hover:bg-red-100 transition-colors",children:[e.jsx(D,{className:"w-4 h-4 inline mr-1"}),"Reject"]})]})]},c.id))})]}),i&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",onClick:()=>l(null),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4 p-6",onClick:c=>c.stopPropagation(),children:[e.jsx("h3",{className:"text-lg font-semibold text-stone-900 mb-4",children:"Reject CE Certificate"}),e.jsx("textarea",{value:m,onChange:c=>u(c.target.value),placeholder:"Reason for rejection...",className:"w-full border border-stone-300 rounded-lg p-3 text-sm min-h-[100px] focus:ring-2 focus:ring-primary-500 focus:border-primary-500"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx("button",{onClick:()=>{l(null),u("")},className:"px-4 py-2 text-sm rounded-lg text-stone-600 hover:bg-stone-100",children:"Cancel"}),e.jsx("button",{onClick:b,disabled:!m.trim()||t.isPending,className:"px-4 py-2 text-sm rounded-lg bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",children:"Reject"})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl border border-stone-200",children:[e.jsx("div",{className:"p-4 border-b border-stone-100",children:e.jsxs("h2",{className:"font-semibold text-stone-900",children:[r.length>0?"Processed Certificates":"All CE Certificates",h.length>0&&` (${h.length})`]})}),d.length===0?e.jsxs("div",{className:"p-8 text-center text-stone-400",children:[e.jsx(j,{className:"w-12 h-12 mx-auto mb-3 text-stone-300"}),e.jsx("p",{children:"No CE certificates yet"})]}):e.jsx("div",{className:"divide-y divide-stone-100",children:(r.length>0?h:d).map(c=>e.jsx(M,{cert:c,showActions:!0},c.id))})]})]})}function M({cert:s,showActions:n=!1,showAuditTrail:o=!1}){const{user:a}=q(),[t,i]=p.useState(!1),[l,m]=p.useState(!1),[u,d]=p.useState(""),r=B(),h=n&&(a?.role==="coordinator"||a?.role==="admin")&&(s.status==="approved"||s.status==="issued"),_={pending:{color:"bg-amber-100 text-amber-700",icon:e.jsx(S,{className:"w-3.5 h-3.5"}),label:"Pending"},approved:{color:"bg-sky-100 text-sky-700",icon:e.jsx(P,{className:"w-3.5 h-3.5"}),label:"Approved"},issued:{color:"bg-emerald-100 text-emerald-700",icon:e.jsx(j,{className:"w-3.5 h-3.5"}),label:"Issued"},rejected:{color:"bg-red-100 text-red-700",icon:e.jsx(D,{className:"w-3.5 h-3.5"}),label:"Rejected"},revoked:{color:"bg-red-100 text-red-800 ring-1 ring-red-300",icon:e.jsx(f,{className:"w-3.5 h-3.5"}),label:"Revoked"}},b=_[s.status]||_.pending,c=()=>{u.trim()&&r.mutate({id:s.id,data:{revocation_reason:u}},{onSuccess:()=>{g.success("CE certificate revoked."),m(!1),d("")},onError:x=>g.error(x.message)})};return e.jsxs("div",{children:[e.jsxs("div",{className:`p-4 flex items-center justify-between gap-4 ${o||h?"cursor-pointer hover:bg-stone-50 transition-colors":""}`,onClick:()=>(o||h)&&i(!t),children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("p",{className:"font-medium text-stone-900",children:[s.preceptor?.first_name," ",s.preceptor?.last_name]}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium ${b.color}`,children:[b.icon,b.label]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-stone-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-3.5 h-3.5"}),s.application?.slot?.site?.name||"N/A"]}),e.jsx("span",{children:s.application?.slot?.specialty||"N/A"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"w-3.5 h-3.5"}),s.contact_hours," hrs"]}),s.issued_at&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"w-3.5 h-3.5"}),new Date(s.issued_at).toLocaleDateString()]})]}),s.university&&e.jsx("p",{className:"text-xs text-stone-400 mt-1",children:s.university.name}),s.rejection_reason&&e.jsxs("p",{className:"text-xs text-red-500 mt-1",children:["Rejected: ",s.rejection_reason]}),s.revocation_reason&&e.jsxs("div",{className:"mt-1 flex items-start gap-1",children:[e.jsx(f,{className:"w-3 h-3 text-red-500 shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-red-600",children:["Revoked",s.revoked_at?` on ${new Date(s.revoked_at).toLocaleDateString()}`:"",": ",s.revocation_reason]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[(s.status==="issued"||s.status==="approved")&&e.jsxs("a",{href:z.downloadUrl(s.id),target:"_blank",rel:"noopener noreferrer",onClick:x=>x.stopPropagation(),className:"px-3 py-1.5 rounded-lg text-sm font-medium bg-stone-100 text-stone-700 hover:bg-stone-200 transition-colors",children:[e.jsx(T,{className:"w-4 h-4 inline mr-1"}),"PDF"]}),(o||h)&&(t?e.jsx(K,{className:"w-4 h-4 text-stone-400"}):e.jsx(Y,{className:"w-4 h-4 text-stone-400"}))]})]}),t&&e.jsxs("div",{className:"px-4 pb-4 space-y-4",children:[e.jsxs("div",{className:"bg-stone-50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-stone-500 uppercase tracking-wider mb-3",children:"Certificate Details"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-3.5 h-3.5 text-stone-400"}),e.jsx("span",{className:"text-stone-500",children:"Verification:"}),e.jsxs("span",{className:"font-mono text-xs text-stone-700",children:[s.verification_uuid?.slice(0,8),"..."]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-3.5 h-3.5 text-stone-400"}),e.jsx("span",{className:"text-stone-500",children:"Contact Hours:"}),e.jsx("span",{className:"font-medium text-stone-700",children:s.contact_hours})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-3.5 h-3.5 text-stone-400"}),e.jsx("span",{className:"text-stone-500",children:"Created:"}),e.jsx("span",{className:"text-stone-700",children:new Date(s.created_at).toLocaleDateString()})]}),s.issued_at&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-3.5 h-3.5 text-stone-400"}),e.jsx("span",{className:"text-stone-500",children:"Issued:"}),e.jsx("span",{className:"text-stone-700",children:new Date(s.issued_at).toLocaleDateString()})]}),s.approved_by_user&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-3.5 h-3.5 text-stone-400"}),e.jsx("span",{className:"text-stone-500",children:"Approved by:"}),e.jsxs("span",{className:"text-stone-700",children:[s.approved_by_user.first_name," ",s.approved_by_user.last_name]})]}),s.revoked_by_user&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-3.5 h-3.5 text-red-400"}),e.jsx("span",{className:"text-stone-500",children:"Revoked by:"}),e.jsxs("span",{className:"text-red-700",children:[s.revoked_by_user.first_name," ",s.revoked_by_user.last_name]})]})]})]}),h&&!l&&e.jsxs("button",{onClick:x=>{x.stopPropagation(),m(!0)},className:"px-4 py-2 rounded-lg text-sm font-medium bg-red-50 text-red-700 hover:bg-red-100 transition-colors flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"}),"Revoke Certificate"]}),l&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",onClick:x=>x.stopPropagation(),children:[e.jsxs("h4",{className:"text-sm font-semibold text-red-800 mb-2 flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4"}),"Revoke CE Certificate"]}),e.jsx("p",{className:"text-xs text-red-600 mb-3",children:"This action is permanent and will be recorded in the immutable audit trail. The certificate will be invalidated and the verification page will show it as revoked."}),e.jsx("textarea",{value:u,onChange:x=>d(x.target.value),placeholder:"Reason for revocation (required)...",className:"w-full border border-red-300 rounded-lg p-3 text-sm min-h-[80px] focus:ring-2 focus:ring-red-500 focus:border-red-500 bg-white"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-3",children:[e.jsx("button",{onClick:()=>{m(!1),d("")},className:"px-4 py-2 text-sm rounded-lg text-stone-600 hover:bg-stone-100",children:"Cancel"}),e.jsxs("button",{onClick:c,disabled:!u.trim()||r.isPending,className:"px-4 py-2 text-sm rounded-lg bg-red-600 text-white hover:bg-red-700 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"}),r.isPending?"Revoking...":"Confirm Revocation"]})]})]}),o&&e.jsx(le,{certificateId:s.id})]})]})}function le({certificateId:s}){const{data:n,isLoading:o}=Z(s),a=n?.audit_trail||[],t={created:{label:"Certificate Created",color:"text-sky-600",icon:e.jsx(A,{className:"w-3.5 h-3.5"})},eligibility_checked:{label:"Eligibility Checked",color:"text-stone-600",icon:e.jsx($,{className:"w-3.5 h-3.5"})},approved:{label:"Approved",color:"text-emerald-600",icon:e.jsx(P,{className:"w-3.5 h-3.5"})},issued:{label:"Issued",color:"text-emerald-600",icon:e.jsx(j,{className:"w-3.5 h-3.5"})},rejected:{label:"Rejected",color:"text-red-600",icon:e.jsx(D,{className:"w-3.5 h-3.5"})},revoked:{label:"Revoked",color:"text-red-700",icon:e.jsx(f,{className:"w-3.5 h-3.5"})},downloaded:{label:"PDF Downloaded",color:"text-stone-500",icon:e.jsx(T,{className:"w-3.5 h-3.5"})},verified:{label:"Public Verification",color:"text-sky-500",icon:e.jsx($,{className:"w-3.5 h-3.5"})},policy_changed:{label:"Policy Changed",color:"text-amber-600",icon:e.jsx(y,{className:"w-3.5 h-3.5"})}};return o?e.jsx("div",{className:"p-4 text-center text-stone-400 text-sm",children:"Loading audit trail..."}):a.length===0?e.jsx("div",{className:"bg-stone-50 rounded-lg p-4 text-center text-stone-400 text-sm",children:"No audit events recorded yet."}):e.jsxs("div",{className:"bg-stone-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-xs font-semibold text-stone-500 uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(L,{className:"w-3.5 h-3.5"}),"Audit Trail (",a.length," events)"]}),e.jsx("div",{className:"space-y-0",children:a.map((i,l)=>e.jsx(ce,{event:i,config:t,isLast:l===a.length-1},i.id))})]})}function ce({event:s,config:n,isLast:o}){const a=n[s.event_type]||{label:s.event_type,color:"text-stone-500",icon:e.jsx(L,{className:"w-3.5 h-3.5"})};return e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-7 h-7 rounded-full bg-white border-2 border-stone-200 flex items-center justify-center ${a.color}`,children:a.icon}),!o&&e.jsx("div",{className:"w-0.5 h-6 bg-stone-200"})]}),e.jsxs("div",{className:`flex-1 ${o?"":"pb-2"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`text-sm font-medium ${a.color}`,children:a.label}),e.jsx("span",{className:"text-xs text-stone-400",children:new Date(s.created_at).toLocaleString()})]}),e.jsxs("div",{className:"text-xs text-stone-500 mt-0.5",children:[s.actor?e.jsxs("span",{children:[s.actor.first_name," ",s.actor.last_name," (",s.actor_role,")"]}):e.jsx("span",{children:s.actor_role}),s.ip_address&&e.jsx("span",{className:"ml-2 text-stone-400",children:s.ip_address})]}),s.metadata&&Object.keys(s.metadata).length>0&&e.jsx(de,{metadata:s.metadata,eventType:s.event_type})]})]})}function de({metadata:s,eventType:n}){return n==="revoked"&&s.revocation_reason?e.jsxs("p",{className:"text-xs text-red-500 mt-1",children:["Reason: ",String(s.revocation_reason)]}):n==="rejected"&&s.rejection_reason?e.jsxs("p",{className:"text-xs text-red-500 mt-1",children:["Reason: ",String(s.rejection_reason)]}):n==="eligibility_checked"?e.jsxs("p",{className:"text-xs text-stone-500 mt-1",children:[s.eligible?"Eligible":"Not eligible",s.reason?` — ${String(s.reason)}`:""]}):n==="policy_changed"?e.jsxs("p",{className:"text-xs text-stone-500 mt-1",children:["Version ",String(s.old_version||"?")," → ",String(s.new_version||"?")]}):null}function me({universityId:s}){const{data:n,isLoading:o}=I(s),a=J(),[t,i]=p.useState({offers_ce:!1,accrediting_body:"",contact_hours_per_rotation:0,max_hours_per_year:"",requires_final_evaluation:!0,requires_midterm_evaluation:!1,requires_minimum_hours:!1,minimum_hours_required:"",approval_required:!0,signer_name:"",signer_credentials:"",effective_from:"",effective_to:""}),[l,m]=p.useState(!1);if(n?.policy&&!l){const r=n.policy;i({offers_ce:r.offers_ce,accrediting_body:r.accrediting_body||"",contact_hours_per_rotation:r.contact_hours_per_rotation,max_hours_per_year:r.max_hours_per_year?.toString()||"",requires_final_evaluation:r.requires_final_evaluation,requires_midterm_evaluation:r.requires_midterm_evaluation,requires_minimum_hours:r.requires_minimum_hours,minimum_hours_required:r.minimum_hours_required?.toString()||"",approval_required:r.approval_required,signer_name:r.signer_name||"",signer_credentials:r.signer_credentials||"",effective_from:r.effective_from||"",effective_to:r.effective_to||""}),m(!0)}else n&&!n.policy&&!l&&m(!0);const u=()=>{a.mutate({universityId:s,data:{offers_ce:t.offers_ce,accrediting_body:t.accrediting_body||null,contact_hours_per_rotation:Number(t.contact_hours_per_rotation),max_hours_per_year:t.max_hours_per_year?Number(t.max_hours_per_year):null,requires_final_evaluation:t.requires_final_evaluation,requires_midterm_evaluation:t.requires_midterm_evaluation,requires_minimum_hours:t.requires_minimum_hours,minimum_hours_required:t.minimum_hours_required?Number(t.minimum_hours_required):null,approval_required:t.approval_required,signer_name:t.signer_name||null,signer_credentials:t.signer_credentials||null,effective_from:t.effective_from||null,effective_to:t.effective_to||null}},{onSuccess:()=>g.success("CE policy saved. Changes are recorded in the audit trail."),onError:r=>g.error(r.message)})};if(o)return e.jsx("div",{className:"p-8 text-center text-stone-400",children:"Loading policy..."});const d=n?.policy;return e.jsxs("div",{className:"space-y-4",children:[d&&e.jsxs("div",{className:"bg-stone-50 border border-stone-200 rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-stone-600",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(H,{className:"w-3.5 h-3.5 text-stone-400"}),"Version ",d.version||1]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(k,{className:"w-3.5 h-3.5 text-stone-400"}),"Last updated: ",new Date(d.updated_at).toLocaleDateString()]}),d.effective_from&&e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(te,{className:"w-3.5 h-3.5 text-stone-400"}),"Effective: ",new Date(d.effective_from).toLocaleDateString(),d.effective_to?` — ${new Date(d.effective_to).toLocaleDateString()}`:" — Ongoing"]})]}),e.jsx("span",{className:"text-xs text-stone-400",children:"All changes are audit-logged"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-stone-200",children:[e.jsx("div",{className:"p-4 border-b border-stone-100",children:e.jsxs("h2",{className:"font-semibold text-stone-900 flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-stone-400"}),"CE Policy Settings"]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:t.offers_ce,onChange:r=>i({...t,offers_ce:r.target.checked}),className:"w-4 h-4 rounded border-stone-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm font-medium text-stone-700",children:"University offers CE credits for preceptors"})]}),t.offers_ce&&e.jsxs("div",{className:"space-y-5 pl-7",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Accrediting Body"}),e.jsx("input",{type:"text",value:t.accrediting_body,onChange:r=>i({...t,accrediting_body:r.target.value}),placeholder:"e.g. ANCC, AAPA",className:"w-full border border-stone-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Contact Hours per Rotation"}),e.jsx("input",{type:"number",step:"0.5",min:"0",value:t.contact_hours_per_rotation,onChange:r=>i({...t,contact_hours_per_rotation:Number(r.target.value)}),className:"w-full border border-stone-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Max Hours per Year (optional)"}),e.jsx("input",{type:"number",step:"0.5",min:"0",value:t.max_hours_per_year,onChange:r=>i({...t,max_hours_per_year:r.target.value}),placeholder:"No limit",className:"w-full border border-stone-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Effective From"}),e.jsx("input",{type:"date",value:t.effective_from,onChange:r=>i({...t,effective_from:r.target.value}),className:"w-full border border-stone-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Effective To (optional)"}),e.jsx("input",{type:"date",value:t.effective_to,onChange:r=>i({...t,effective_to:r.target.value}),className:"w-full border border-stone-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-stone-700",children:"Eligibility Requirements"}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:t.requires_final_evaluation,onChange:r=>i({...t,requires_final_evaluation:r.target.checked}),className:"w-4 h-4 rounded border-stone-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-stone-600",children:"Require final evaluation from preceptor"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:t.requires_midterm_evaluation,onChange:r=>i({...t,requires_midterm_evaluation:r.target.checked}),className:"w-4 h-4 rounded border-stone-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-stone-600",children:"Require mid-rotation evaluation"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:t.requires_minimum_hours,onChange:r=>i({...t,requires_minimum_hours:r.target.checked}),className:"w-4 h-4 rounded border-stone-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-stone-600",children:"Require minimum logged hours"})]}),t.requires_minimum_hours&&e.jsx("div",{className:"pl-7",children:e.jsx("input",{type:"number",step:"1",min:"0",value:t.minimum_hours_required,onChange:r=>i({...t,minimum_hours_required:r.target.value}),placeholder:"Minimum hours",className:"w-40 border border-stone-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:t.approval_required,onChange:r=>i({...t,approval_required:r.target.checked}),className:"w-4 h-4 rounded border-stone-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-stone-600",children:"Require coordinator approval before issuing"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Certificate Signer Name"}),e.jsx("input",{type:"text",value:t.signer_name,onChange:r=>i({...t,signer_name:r.target.value}),placeholder:"e.g. Dr. Jane Smith",className:"w-full border border-stone-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Signer Credentials"}),e.jsx("input",{type:"text",value:t.signer_credentials,onChange:r=>i({...t,signer_credentials:r.target.value}),placeholder:"e.g. DNP, FNP-BC, Program Director",className:"w-full border border-stone-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-stone-100",children:[e.jsxs("p",{className:"text-xs text-stone-400 flex items-center gap-1",children:[e.jsx(N,{className:"w-3.5 h-3.5"}),"Policy changes are recorded in the immutable audit trail"]}),e.jsxs("button",{onClick:u,disabled:a.isPending,className:"px-5 py-2.5 rounded-xl text-sm font-medium bg-primary-600 text-white hover:bg-primary-700 transition-colors disabled:opacity-50 flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),a.isPending?"Saving...":"Save Policy"]})]})]})]})]})}export{we as CeCredits};
