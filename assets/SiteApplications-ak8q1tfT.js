import{r as d,a4 as S,aA as E,aB as D,j as e,w as R,G as B,e as L,B as z,as as M,a1 as F,f as r,g as P,aC as U,E as T,t as m}from"./index-GzcG7CSS.js";import{C as j}from"./Card-FSc1waky.js";import{B as W}from"./Badge-9_pL70Ln.js";import{M as $}from"./Modal-CA0K5bCb.js";import{E as I}from"./EmptyState-A3BIGBYI.js";import{u as G}from"./usePageTitle-CSRQyC0a.js";import{U as O}from"./user-BvMymkx8.js";import{M as X}from"./map-pin-B8WKBtoC.js";import{C as q}from"./chevron-up-B1BLTNfs.js";import{C as H}from"./circle-check-big-B5eOtT2b.js";import{C as J}from"./circle-x-BhxGvoPR.js";import{C as N}from"./circle-check-DXK6A2lJ.js";import{I as K}from"./info-DQlfYAyl.js";import{T as Q}from"./triangle-alert-DWR7AhnE.js";function xe(){G("Site Applications");const[a,x]=d.useState("all"),[t,o]=d.useState(null),[i,c]=d.useState("accepted"),[u,p]=d.useState(""),[v,w]=d.useState(null),{data:b,isLoading:y}=S(),f=E(),C=D(),l=b?.data||[],g=a==="all"?l:l.filter(s=>s.status===a),_={all:l.length,pending:l.filter(s=>s.status==="pending").length,accepted:l.filter(s=>s.status==="accepted").length,completed:l.filter(s=>s.status==="completed").length,declined:l.filter(s=>s.status==="declined").length,waitlisted:l.filter(s=>s.status==="waitlisted").length},h=(s,n)=>{o(s),c(n),p("")},A=async()=>{if(t)try{await f.mutateAsync({id:t.id,data:{status:i,notes:u||void 0}}),m.success(i==="accepted"?"Application accepted!":i==="declined"?"Application declined":"Application waitlisted"),o(null)}catch(s){const n=s instanceof Error?s.message:"Failed to review application";m.error(n)}},k=s=>{const n={pending:"warning",accepted:"success",completed:"primary",declined:"danger",waitlisted:"secondary",withdrawn:"default"};return e.jsx(W,{variant:n[s]||"default",children:s})};return y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(R,{className:"w-8 h-8 animate-spin text-primary-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-stone-900",children:"Applications"}),e.jsx("p",{className:"text-stone-500",children:"Review and manage student applications"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["all","pending","accepted","completed","declined","waitlisted"].map(s=>e.jsxs("button",{onClick:()=>x(s),className:`px-4 py-2 rounded-xl text-sm font-medium transition-all ${a===s?"bg-primary-500 text-white":"bg-stone-100 text-stone-600 hover:bg-stone-200"}`,children:[s.charAt(0).toUpperCase()+s.slice(1),e.jsxs("span",{className:"ml-1.5 opacity-80",children:["(",_[s],")"]})]},s))}),g.length===0&&e.jsx(j,{children:e.jsx(I,{illustration:"inbox",title:"No applications",description:a==="all"?"No applications have been received yet. They will appear here when students apply to your rotation slots.":`No ${a} applications found. Try changing the filter.`})}),e.jsx("div",{className:"space-y-3",children:g.map(s=>{const n=v===s.id;return e.jsxs(j,{padding:"none",children:[e.jsx("div",{className:"p-4 sm:p-6 cursor-pointer",onClick:()=>w(n?null:s.id),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary-50 text-primary-600 flex items-center justify-center shrink-0",children:e.jsx(O,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("h3",{className:"font-semibold text-stone-900",children:[s.student?.first_name," ",s.student?.last_name]}),k(s.status)]}),s.student?.student_profile?.university&&e.jsxs("p",{className:"text-xs text-stone-500 flex items-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"}),s.student.student_profile.university.name,s.student.student_profile.program&&e.jsxs("span",{className:"text-stone-400",children:["(",s.student.student_profile.program.degree_type,")"]})]}),e.jsxs("p",{className:"text-sm text-stone-500 mt-0.5",children:["Applied for: ",e.jsx("span",{className:"text-stone-700 font-medium",children:s.slot?.title})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-2 text-xs text-stone-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"w-3.5 h-3.5"}),new Date(s.submitted_at||s.created_at).toLocaleDateString()]}),s.slot?.site&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"w-3.5 h-3.5"}),s.slot.site.city,", ",s.slot.site.state]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"w-3.5 h-3.5"}),s.slot?.specialty]})]})]}),e.jsx("div",{className:"shrink-0 text-stone-400",children:n?e.jsx(q,{className:"w-5 h-5"}):e.jsx(M,{className:"w-5 h-5"})})]})}),n&&e.jsxs("div",{className:"border-t border-stone-200 p-4 sm:p-6 bg-stone-50/50",children:[s.cover_letter&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(F,{className:"w-4 h-4 text-stone-500"}),e.jsx("h4",{className:"text-sm font-medium text-stone-700",children:"Cover Letter"})]}),e.jsx("p",{className:"text-sm text-stone-600 bg-white rounded-xl p-4 border border-stone-200",children:s.cover_letter})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-3 border border-stone-200",children:[e.jsx("p",{className:"text-xs text-stone-500",children:"Email"}),e.jsx("p",{className:"text-sm font-medium text-stone-900 truncate",children:s.student?.email})]}),s.student?.student_profile?.university&&e.jsxs("div",{className:"bg-white rounded-xl p-3 border border-stone-200",children:[e.jsx("p",{className:"text-xs text-stone-500",children:"University"}),e.jsx("p",{className:"text-sm font-medium text-stone-900 truncate",children:s.student.student_profile.university.name}),s.student.student_profile.program&&e.jsxs("p",{className:"text-xs text-stone-500",children:[s.student.student_profile.program.name," (",s.student.student_profile.program.degree_type,")"]})]}),s.slot?.preceptor&&e.jsxs("div",{className:"bg-white rounded-xl p-3 border border-stone-200",children:[e.jsx("p",{className:"text-xs text-stone-500",children:"Preceptor"}),e.jsxs("p",{className:"text-sm font-medium text-stone-900",children:[s.slot.preceptor.first_name," ",s.slot.preceptor.last_name]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 border border-stone-200",children:[e.jsx("p",{className:"text-xs text-stone-500",children:"Rotation Dates"}),e.jsxs("p",{className:"text-sm font-medium text-stone-900",children:[s.slot?.start_date?new Date(s.slot.start_date).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"—"," - ",s.slot?.end_date?new Date(s.slot.end_date).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"—"]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 border border-stone-200",children:[e.jsx("p",{className:"text-xs text-stone-500",children:"Spots Available"}),e.jsxs("p",{className:"text-sm font-medium text-stone-900",children:[(s.slot?.capacity||0)-(s.slot?.filled||0)," remaining"]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 border border-stone-200",children:[e.jsx("p",{className:"text-xs text-stone-500",children:"Submitted"}),e.jsx("p",{className:"text-sm font-medium text-stone-900",children:new Date(s.submitted_at||s.created_at).toLocaleDateString()})]})]}),s.notes&&e.jsxs("div",{className:"mb-4 bg-white rounded-xl p-3 border border-stone-200",children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"Review Notes"}),e.jsx("p",{className:"text-sm text-stone-700",children:s.notes})]}),s.status==="pending"&&e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[e.jsxs(r,{size:"sm",onClick:()=>h(s,"accepted"),children:[e.jsx(H,{className:"w-4 h-4"})," Accept"]}),e.jsxs(r,{size:"sm",variant:"outline",onClick:()=>h(s,"waitlisted"),children:[e.jsx(P,{className:"w-4 h-4"})," Waitlist"]}),e.jsxs(r,{size:"sm",variant:"danger",onClick:()=>h(s,"declined"),children:[e.jsx(J,{className:"w-4 h-4"})," Decline"]})]}),s.status==="accepted"&&e.jsx(V,{app:s,completeMutation:C})]})]},s.id)})}),e.jsx($,{isOpen:!!t,onClose:()=>o(null),title:i==="accepted"?"Accept Application":i==="declined"?"Decline Application":"Waitlist Application",size:"sm",children:t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-stone-50 rounded-xl p-4",children:[e.jsxs("p",{className:"text-sm text-stone-900 font-medium",children:[t.student?.first_name," ",t.student?.last_name]}),e.jsx("p",{className:"text-xs text-stone-500",children:t.slot?.title})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Notes (optional)"}),e.jsx("textarea",{value:u,onChange:s=>p(s.target.value),rows:3,placeholder:i==="accepted"?"Welcome message or next steps...":i==="declined"?"Reason for declining...":"Waitlist position or notes...",className:"w-full rounded-xl border border-stone-300 px-4 py-3 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none resize-none"})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(r,{variant:"ghost",onClick:()=>o(null),children:"Cancel"}),e.jsx(r,{variant:i==="declined"?"danger":"primary",onClick:A,isLoading:f.isPending,children:i==="accepted"?"Accept":i==="declined"?"Decline":"Waitlist"})]})]})})]})}function V({app:a,completeMutation:x}){const{data:t}=U(a.id),[o,i]=d.useState(!1);return e.jsxs("div",{className:"pt-2 space-y-2",children:[t&&e.jsx("div",{className:`flex items-center gap-1.5 text-xs px-2.5 py-1.5 rounded-lg ${t.eligible?"bg-green-50 text-green-700":t.reason?.includes("does not offer")?"bg-stone-50 text-stone-500":"bg-amber-50 text-amber-700"}`,children:t.eligible?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-3.5 h-3.5 shrink-0"})," CE: ",t.contact_hours,"h will be awarded to preceptor"]}):t.reason?.includes("does not offer")?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-3.5 h-3.5 shrink-0"})," CE not configured for university"]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-3.5 h-3.5 shrink-0"})," CE: ",t.reason]})}),o?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(r,{size:"sm",isLoading:x.isPending,onClick:()=>{x.mutate(a.id,{onSuccess:c=>{m.success("Placement marked as completed!"),c.ce?.ce_certificate_created&&m.success(`CE certificate created (${c.ce.contact_hours} hrs) — Status: ${c.ce.ce_status}`),i(!1)},onError:c=>m.error(c.message)})},children:[e.jsx(N,{className:"w-4 h-4"})," Confirm"]}),e.jsx(r,{size:"sm",variant:"ghost",onClick:()=>i(!1),children:"Cancel"})]}):e.jsxs(r,{size:"sm",variant:"outline",onClick:()=>i(!0),children:[e.jsx(T,{className:"w-4 h-4"})," Mark Complete"]})]})}export{xe as SiteApplications};
