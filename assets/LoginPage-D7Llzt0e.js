import{r as s,a as M,u as D,k as F,j as e,l as k,f as E,m as O,L as g,S as R,g as _,t as L,s as $,B as q,d as T,n as V}from"./index-GzcG7CSS.js";import{I as Y}from"./Input-B5MQDJHu.js";import{C as j}from"./Card-FSc1waky.js";import{u as W}from"./usePageTitle-CSRQyC0a.js";import{U as z}from"./user-BvMymkx8.js";import{L as G}from"./lock-BbcKluH6.js";import{E as H}from"./eye-off-BQvtsNqL.js";import{E as J}from"./eye-DPEVXjN5.js";function oe(){W("Sign In");const[n,f]=s.useState(""),[o,m]=s.useState(""),[a,x]=s.useState(!1),{login:b,verifyMfa:u,cancelMfa:h,mfaPending:r,isLoading:v,isAuthenticated:N}=M(),y=D(),[P]=F(),w=P.get("redirect"),[c,p]=s.useState(""),[d,S]=s.useState(!1),[I,A]=s.useState(!1);s.useEffect(()=>{N&&y(w||"/dashboard")},[N,y,w]);const U=async t=>{t.preventDefault();try{await b(n,o)}catch(i){const l=i;if(l.body?.email_not_verified&&l.body?.email){y("/verify-email?email="+encodeURIComponent(l.body.email));return}if(l.body?.pending_approval){A(!0);return}const B=i instanceof Error?i.message:"Login failed. Please check your credentials.";L.error(B)}},X=async t=>{if(t.preventDefault(),!!c.trim())try{await u(c.trim())}catch(i){const l=i instanceof Error?i.message:"Invalid verification code.";L.error(l)}},C=t=>{p(d?t:t.replace(/\D/g,"").slice(0,6))};return r?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary-50 via-white to-secondary-50 px-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gradient-to-br from-primary-500 to-secondary-500 flex items-center justify-center mx-auto mb-4",children:e.jsx(k,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-stone-900",children:"Two-Factor Authentication"}),e.jsx("p",{className:"text-stone-500 mt-1",children:d?"Enter one of your backup codes":"Enter the 6-digit code from your authenticator app"})]}),e.jsxs(j,{children:[e.jsxs("form",{onSubmit:X,className:"space-y-4",children:[d?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Backup Code"}),e.jsx("input",{type:"text",value:c,onChange:t=>C(t.target.value),placeholder:"XXXX-XXXX",autoFocus:!0,className:"w-full rounded-xl border border-stone-300 bg-white px-4 py-3 text-base font-mono tracking-wider text-center focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Verification Code"}),e.jsx("input",{type:"text",inputMode:"numeric",value:c,onChange:t=>C(t.target.value),placeholder:"000000",maxLength:6,autoFocus:!0,className:"w-full rounded-xl border border-stone-300 bg-white px-4 py-3 text-2xl font-mono tracking-[0.5em] text-center focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"})]}),e.jsxs(E,{type:"submit",isLoading:v,className:"w-full",disabled:!c.trim(),children:[e.jsx(k,{className:"w-4 h-4"})," Verify"]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>{h(),p(""),S(!1)},className:"text-sm text-stone-500 hover:text-stone-700 flex items-center gap-1",children:[e.jsx(O,{className:"w-3.5 h-3.5"})," Back to login"]}),e.jsx("button",{onClick:()=>{S(!d),p("")},className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:d?"Use authenticator app":"Use a backup code"})]})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary-50 via-white to-secondary-50 px-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs(g,{to:"/",className:"inline-flex items-center gap-2.5 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-primary-500 to-secondary-500 flex items-center justify-center",children:e.jsx(R,{className:"w-6 h-6 text-white"})}),e.jsx("span",{className:"text-2xl font-bold bg-gradient-to-r from-primary-600 to-secondary-600 bg-clip-text text-transparent",children:"ClinicLink"})]}),e.jsx("h1",{className:"text-2xl font-bold text-stone-900",children:"Welcome back"}),e.jsx("p",{className:"text-stone-500 mt-1",children:"Sign in to your account"})]}),I&&e.jsxs("div",{className:"mb-4 bg-amber-50 border border-amber-200 rounded-2xl p-5 text-center space-y-2",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center mx-auto",children:e.jsx(_,{className:"w-6 h-6 text-amber-600"})}),e.jsx("h3",{className:"text-base font-bold text-stone-900",children:"Account Pending Approval"}),e.jsx("p",{className:"text-sm text-stone-600",children:"Your registration has been received and is awaiting admin review. You'll receive an email once your account is activated."})]}),e.jsxs(j,{children:[e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsx(Y,{label:"Email, Username, or Phone",type:"text",placeholder:"you@university.edu, username, or phone",value:n,onChange:t=>f(t.target.value),icon:e.jsx(z,{className:"w-4 h-4"}),required:!0}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-stone-400",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx("input",{type:a?"text":"password",placeholder:"Enter your password",value:o,onChange:t=>m(t.target.value),required:!0,className:"w-full rounded-xl border border-stone-300 bg-white pl-10 pr-10 py-2.5 text-sm text-stone-900 placeholder:text-stone-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none transition-all duration-200"}),e.jsx("button",{type:"button",onClick:()=>x(!a),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-stone-400 hover:text-stone-600",children:a?e.jsx(H,{className:"w-4 h-4"}):e.jsx(J,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(g,{to:"/forgot-password",className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"Forgot password?"})}),e.jsx(E,{type:"submit",isLoading:v,className:"w-full",children:"Sign In"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-stone-500",children:["Don't have an account?"," ",e.jsx(g,{to:"/register",className:"text-primary-600 hover:text-primary-700 font-medium",children:"Register"})]})})]}),e.jsx(K,{}),e.jsx("p",{className:"text-center text-xs text-stone-400 mt-6",children:"Demo: student@cliniclink.health / ClinicLink2026! (or any demo role email)"})]})})}function K(){const[n,f]=s.useState([]),[o,m]=s.useState(""),[a,x]=s.useState(""),[b,u]=s.useState(!1);if(s.useEffect(()=>{$.universities().then(f).catch(()=>{})},[]),n.length===0)return null;const h=o?n.filter(r=>r.name.toLowerCase().includes(o.toLowerCase())):n;return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"relative flex items-center my-4",children:[e.jsx("div",{className:"flex-1 border-t border-stone-200"}),e.jsx("span",{className:"px-3 text-xs text-stone-400 uppercase tracking-wider",children:"Or"}),e.jsx("div",{className:"flex-1 border-t border-stone-200"})]}),b?e.jsx(j,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-stone-700",children:"Select your university"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-stone-400",children:e.jsx(T,{className:"w-4 h-4"})}),e.jsx("input",{type:"text",placeholder:"Search universities...",value:o,onChange:r=>m(r.target.value),className:"w-full rounded-xl border border-stone-300 bg-white pl-10 pr-4 py-2 text-sm text-stone-900 placeholder:text-stone-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"})]}),e.jsxs("div",{className:"max-h-40 overflow-y-auto space-y-1",children:[h.map(r=>e.jsx("button",{onClick:()=>x(r.id),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors ${a===r.id?"bg-primary-50 text-primary-700 font-medium":"text-stone-700 hover:bg-stone-50"}`,children:r.name},r.id)),h.length===0&&e.jsx("p",{className:"text-sm text-stone-400 text-center py-2",children:"No universities found"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{u(!1),m(""),x("")},className:"flex-1 text-sm text-stone-500 hover:text-stone-700 py-2",children:"Cancel"}),e.jsx("button",{onClick:()=>{a&&(window.location.href=`${V}/sso/login/${a}`)},disabled:!a,className:"flex-1 rounded-xl bg-primary-600 px-4 py-2 text-sm font-medium text-white hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Continue with SSO"})]})]})}):e.jsxs("button",{onClick:()=>u(!0),className:"w-full flex items-center justify-center gap-2 rounded-xl border border-stone-300 bg-white px-4 py-2.5 text-sm font-medium text-stone-700 hover:bg-stone-50 hover:border-stone-400 transition-all duration-200",children:[e.jsx(q,{className:"w-4 h-4 text-primary-600"}),"Sign in with University SSO"]})]})}export{oe as LoginPage};
