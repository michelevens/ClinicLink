import{b as q,j as e,r as d,a8 as G,aw as Q,ax as Y,ay as V,az as W,w as H,f as l,af as M,d as J,B as K,e as X,U as D,g as E,T as P,t as p}from"./index-GzcG7CSS.js";import{C as v}from"./Card-FSc1waky.js";import{B as N}from"./Badge-9_pL70Ln.js";import{I as n}from"./Input-B5MQDJHu.js";import{M as F}from"./Modal-CA0K5bCb.js";import{F as Z,i as ee}from"./index-pbZfDgWV.js";import{E as se}from"./EmptyState-A3BIGBYI.js";import{u as te}from"./usePageTitle-CSRQyC0a.js";import{U as ae}from"./user-BvMymkx8.js";import{P as ie}from"./pencil-Cb-MolFd.js";import{D as re}from"./dollar-sign-B0eOAqoO.js";function le({siteId:x,selectedStartDate:m,selectedEndDate:o}){const{data:f}=q({site_id:x}),r=(f?.data||[]).map(i=>({id:i.id,title:`${i.title} (${i.filled}/${i.capacity})`,start:i.start_date,end:i.end_date,color:i.status==="open"?"#3b82f6":i.status==="filled"?"#22c55e":"#9ca3af",display:"block"}));return m&&o&&r.push({id:"selected-range",title:"New Slot",start:m,end:o,color:"#f59e0b",display:"background"}),e.jsxs("div",{className:"border border-stone-200 rounded-xl p-3 bg-white",children:[e.jsx("p",{className:"text-xs font-medium text-stone-500 mb-2",children:"Site Slot Calendar"}),e.jsx("div",{className:"text-xs [&_.fc-toolbar-title]:text-sm [&_.fc-button]:text-xs [&_.fc-button]:px-2 [&_.fc-button]:py-1 [&_.fc-daygrid-day-number]:text-xs",children:e.jsx(Z,{plugins:[ee],initialView:"dayGridMonth",events:r,height:280,headerToolbar:{left:"prev",center:"title",right:"next"},dayMaxEvents:2})}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-stone-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm bg-blue-500"}),"Open"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm bg-green-500"}),"Filled"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm bg-stone-400"}),"Closed"]}),m&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm bg-amber-500"}),"New Slot"]})]})]})}const ne=["Emergency Medicine","Family Practice","Internal Medicine","Pediatrics","OB/GYN","Surgery","Orthopedics","Cardiology","Neurology","Psychiatry","ICU/Critical Care","Geriatrics","Physical Therapy","Social Work","Urgent Care","Rehabilitation"],R={site_id:"",title:"",specialty:"",description:"",start_date:"",end_date:"",capacity:"2",cost:"0",cost_type:"free",shift_schedule:"",requirements:"",preceptor_id:""};function ve(){te("Rotation Slots");const[x,m]=d.useState(""),[o,f]=d.useState("all"),[b,r]=d.useState(!1),[i,_]=d.useState(null),[t,a]=d.useState({...R}),[g,u]=d.useState(null),{data:I}=G(),j=I?.sites||[],{data:T}=Q(),B=T?.preceptors||[],{data:L,isLoading:U}=q({search:x||void 0,status:o!=="all"?o:void 0}),S=Y(),C=V(),w=W(),z=new Set(j.map(s=>s.id)),h=(L?.data||[]).filter(s=>z.has(s.site_id)),k=()=>{_(null),a({...R,site_id:j[0]?.id||""}),r(!0)},A=s=>{_(s),a({site_id:s.site_id,title:s.title,specialty:s.specialty,description:s.description,start_date:s.start_date,end_date:s.end_date,capacity:String(s.capacity),cost:String(s.cost),cost_type:s.cost_type,shift_schedule:s.shift_schedule||"",requirements:s.requirements.join(", "),preceptor_id:s.preceptor_id||""}),r(!0)},O=async()=>{if(!t.site_id||!t.title||!t.specialty||!t.start_date||!t.end_date){p.error("Please fill in all required fields");return}const s={site_id:t.site_id,title:t.title,specialty:t.specialty,description:t.description,start_date:t.start_date,end_date:t.end_date,capacity:parseInt(t.capacity),cost:parseFloat(t.cost),cost_type:t.cost_type,shift_schedule:t.shift_schedule||null,requirements:t.requirements?t.requirements.split(",").map(c=>c.trim()).filter(Boolean):[],preceptor_id:t.preceptor_id||null,status:"open"};try{i?(await C.mutateAsync({id:i.id,data:s}),p.success("Rotation slot updated")):(await S.mutateAsync(s),p.success("Rotation slot created")),r(!1)}catch(c){const y=c instanceof Error?c.message:"Failed to save";p.error(y)}},$=async s=>{try{await w.mutateAsync(s),p.success("Rotation slot deleted"),u(null)}catch(c){const y=c instanceof Error?c.message:"Failed to delete";p.error(y)}};return U?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(H,{className:"w-8 h-8 animate-spin text-primary-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-stone-900",children:"Rotation Slots"}),e.jsx("p",{className:"text-stone-500",children:"Create and manage rotation opportunities"})]}),e.jsxs(l,{onClick:k,children:[e.jsx(M,{className:"w-4 h-4"})," Create Slot"]})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(n,{placeholder:"Search slots...",value:x,onChange:s=>m(s.target.value),icon:e.jsx(J,{className:"w-4 h-4"})})}),e.jsxs("select",{value:o,onChange:s=>f(s.target.value),className:"rounded-xl border border-stone-300 px-3 py-2.5 text-sm bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"filled",children:"Filled"}),e.jsx("option",{value:"closed",children:"Closed"})]})]}),e.jsxs("p",{className:"text-sm text-stone-500 mt-3",children:[h.length," slot",h.length!==1?"s":""]})]}),e.jsxs("div",{className:"space-y-4",children:[h.length===0&&e.jsx(v,{children:e.jsx(se,{illustration:"calendar",title:"No rotation slots yet",description:"Create your first rotation slot to start receiving applications from students.",action:e.jsxs(l,{onClick:k,children:[e.jsx(M,{className:"w-4 h-4"})," Create Slot"]})})}),h.map(s=>e.jsx(v,{children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary-50 text-primary-600 flex items-center justify-center shrink-0",children:e.jsx(K,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-stone-900",children:s.title}),e.jsx("p",{className:"text-sm text-stone-500",children:s.site?.name})]})]}),s.description&&e.jsx("p",{className:"text-sm text-stone-600 mb-3",children:s.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx(N,{variant:"primary",children:s.specialty}),e.jsx(N,{variant:s.status==="open"?"success":s.status==="filled"?"warning":"danger",children:s.status}),e.jsx(N,{variant:s.cost_type==="free"?"success":"warning",children:s.cost_type==="free"?"Free":`$${s.cost}`})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-xs text-stone-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"w-3.5 h-3.5"}),new Date(s.start_date).toLocaleDateString()," - ",new Date(s.end_date).toLocaleDateString()]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-3.5 h-3.5"}),s.filled,"/",s.capacity," filled"]}),s.shift_schedule&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(E,{className:"w-3.5 h-3.5"}),s.shift_schedule]}),s.preceptor&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-3.5 h-3.5"}),s.preceptor.first_name," ",s.preceptor.last_name]})]})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>A(s),children:[e.jsx(ie,{className:"w-4 h-4"})," Edit"]}),e.jsx(l,{size:"sm",variant:"danger",onClick:()=>u(s.id),children:e.jsx(P,{className:"w-4 h-4"})})]})]})},s.id))]}),e.jsx(F,{isOpen:b,onClose:()=>r(!1),title:i?"Edit Rotation Slot":"Create Rotation Slot",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Site *"}),e.jsxs("select",{value:t.site_id,onChange:s=>a({...t,site_id:s.target.value}),className:"w-full rounded-xl border border-stone-300 px-4 py-2.5 text-sm bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"",children:"Select a site..."}),j.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsx(n,{label:"Title *",placeholder:"e.g. Emergency Medicine Rotation - Spring 2025",value:t.title,onChange:s=>a({...t,title:s.target.value}),required:!0}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Specialty *"}),e.jsxs("select",{value:t.specialty,onChange:s=>a({...t,specialty:s.target.value}),className:"w-full rounded-xl border border-stone-300 px-4 py-2.5 text-sm bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"",children:"Select specialty..."}),ne.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Description"}),e.jsx("textarea",{value:t.description,onChange:s=>a({...t,description:s.target.value}),rows:3,placeholder:"Describe the rotation experience, learning objectives, etc.",className:"w-full rounded-xl border border-stone-300 px-4 py-3 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(n,{label:"Start Date *",type:"date",value:t.start_date,onChange:s=>a({...t,start_date:s.target.value})}),e.jsx(n,{label:"End Date *",type:"date",value:t.end_date,onChange:s=>a({...t,end_date:s.target.value})})]}),t.site_id&&e.jsx(le,{siteId:t.site_id,selectedStartDate:t.start_date,selectedEndDate:t.end_date}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:[e.jsx(n,{label:"Capacity",type:"number",min:"1",max:"50",value:t.capacity,onChange:s=>a({...t,capacity:s.target.value}),icon:e.jsx(D,{className:"w-4 h-4"})}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Cost Type"}),e.jsxs("select",{value:t.cost_type,onChange:s=>a({...t,cost_type:s.target.value}),className:"w-full rounded-xl border border-stone-300 px-3 py-2.5 text-sm bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"free",children:"Free"}),e.jsx("option",{value:"paid",children:"Paid"})]})]}),t.cost_type==="paid"&&e.jsx(n,{label:"Cost ($)",type:"number",min:"0",step:"50",value:t.cost,onChange:s=>a({...t,cost:s.target.value}),icon:e.jsx(re,{className:"w-4 h-4"})})]}),e.jsx(n,{label:"Shift Schedule",placeholder:"e.g. Mon-Fri 7am-3pm",value:t.shift_schedule,onChange:s=>a({...t,shift_schedule:s.target.value}),icon:e.jsx(E,{className:"w-4 h-4"})}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Preceptor"}),e.jsxs("select",{value:t.preceptor_id,onChange:s=>a({...t,preceptor_id:s.target.value}),className:"w-full rounded-xl border border-stone-300 px-4 py-2.5 text-sm bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"",children:"No preceptor assigned"}),B.map(s=>e.jsxs("option",{value:s.id,children:[s.first_name," ",s.last_name," (",s.email,")"]},s.id))]})]}),e.jsx(n,{label:"Requirements (comma separated)",placeholder:"e.g. BLS, Background Check, Immunizations",value:t.requirements,onChange:s=>a({...t,requirements:s.target.value})}),e.jsxs("div",{className:"flex gap-3 justify-end pt-2",children:[e.jsx(l,{variant:"ghost",onClick:()=>r(!1),children:"Cancel"}),e.jsx(l,{onClick:O,isLoading:S.isPending||C.isPending,children:i?"Update Slot":"Create Slot"})]})]})}),e.jsx(F,{isOpen:!!g,onClose:()=>u(null),title:"Delete Rotation Slot",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-stone-600",children:"Are you sure you want to delete this rotation slot? This action cannot be undone."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(l,{variant:"ghost",onClick:()=>u(null),children:"Cancel"}),e.jsxs(l,{variant:"danger",onClick:()=>g&&$(g),isLoading:w.isPending,children:[e.jsx(P,{className:"w-4 h-4"})," Delete"]})]})]})})]})}export{ve as SlotManagement};
