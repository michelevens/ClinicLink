import{y as L,a as S,u as C,r as a,I as u,j as e,w as B,L as c,f as n,S as E,B as Y,t as j}from"./index-GzcG7CSS.js";import{T as f}from"./triangle-alert-DWR7AhnE.js";import{C as g}from"./circle-check-big-B5eOtT2b.js";import{A as T}from"./arrow-right-CU9vIbfs.js";import{M as _}from"./map-pin-B8WKBtoC.js";import{L as $}from"./log-in-10vrFb_d.js";import{U as G}from"./user-plus-CC3Tiyyp.js";function O(){const{token:i}=L(),{isAuthenticated:l,user:o}=S(),d=C(),[s,N]=a.useState(null),[b,m]=a.useState(!0),[x,v]=a.useState(""),[w,h]=a.useState(!1),[p,y]=a.useState(!1),[r,A]=a.useState(null);a.useEffect(()=>{i&&u.validate(i).then(t=>{t.already_accepted?A(t.site_name||"the site"):N(t.invite),m(!1)}).catch(t=>{v(t.message||"Invalid invite link"),m(!1)})},[i]);const k=async()=>{if(i){h(!0);try{const t=await u.accept(i);j.success(t.message),y(!0)}catch(t){const I=t instanceof Error?t.message:"Failed to accept invite";j.error(I)}h(!1)}};if(b)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center",children:e.jsx(B,{className:"w-8 h-8 animate-spin text-primary-500"})});if(x)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-orange-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-red-100 text-red-500 flex items-center justify-center mx-auto mb-4",children:e.jsx(f,{className:"w-8 h-8"})}),e.jsx("h1",{className:"text-xl font-bold text-stone-900 mb-2",children:"Invalid Invite"}),e.jsx("p",{className:"text-stone-500 mb-6",children:x}),e.jsx(c,{to:"/login",children:e.jsx(n,{children:"Go to Login"})})]})});if(p||r){const t=p?s?.site.name:r;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 via-white to-teal-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-100 text-green-500 flex items-center justify-center mx-auto mb-4",children:e.jsx(g,{className:"w-8 h-8"})}),e.jsx("h1",{className:"text-xl font-bold text-stone-900 mb-2",children:r?"You're Already a Member!":"You've Joined!"}),e.jsxs("p",{className:"text-stone-500 mb-2",children:["You are now affiliated with ",e.jsx("strong",{children:t}),"."]}),e.jsx("p",{className:"text-sm text-stone-400 mb-6",children:"The site manager can now assign you to rotation slots."}),e.jsxs(n,{onClick:()=>d("/dashboard"),children:["Go to Dashboard ",e.jsx(T,{className:"w-4 h-4"})]})]})})}return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary-500 to-secondary-500 px-8 py-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center",children:e.jsx(E,{className:"w-7 h-7"})}),e.jsx("span",{className:"text-2xl font-bold",children:"ClinicLink"})]}),e.jsx("p",{className:"text-white/80 text-sm",children:"You've been invited to join a clinical site"})]}),e.jsxs("div",{className:"p-8",children:[e.jsx("div",{className:"bg-stone-50 rounded-2xl p-5 mb-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-primary-500 to-secondary-500 text-white flex items-center justify-center flex-shrink-0",children:e.jsx(Y,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-stone-900",children:s?.site.name}),(s?.site.city||s?.site.state)&&e.jsxs("p",{className:"text-sm text-stone-500 flex items-center gap-1 mt-0.5",children:[e.jsx(_,{className:"w-3.5 h-3.5"}),[s.site.city,s.site.state].filter(Boolean).join(", ")]}),s?.site.specialties&&s.site.specialties.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[s.site.specialties.slice(0,4).map(t=>e.jsx("span",{className:"text-xs bg-primary-100 text-primary-700 rounded-full px-2 py-0.5",children:t},t)),s.site.specialties.length>4&&e.jsxs("span",{className:"text-xs text-stone-400",children:["+",s.site.specialties.length-4]})]}),s?.site.description&&e.jsx("p",{className:"text-sm text-stone-600 mt-2 line-clamp-2",children:s.site.description})]})]})}),s?.invited_by&&e.jsxs("p",{className:"text-sm text-stone-500 mb-6 text-center",children:["Invited by ",e.jsx("strong",{className:"text-stone-700",children:s.invited_by})]}),l&&o?.role==="preceptor"?e.jsxs(n,{className:"w-full",onClick:k,isLoading:w,children:[e.jsx(g,{className:"w-4 h-4"})," Accept & Join This Site"]}):l?e.jsxs("div",{className:"text-center space-y-3",children:[e.jsxs("div",{className:"bg-amber-50 text-amber-800 rounded-xl px-4 py-3 text-sm",children:[e.jsx(f,{className:"w-4 h-4 inline mr-1"}),"Only preceptor accounts can accept site invites. You're logged in as ",e.jsx("strong",{children:o?.role}),"."]}),e.jsx(n,{variant:"outline",onClick:()=>d("/dashboard"),children:"Go to Dashboard"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-stone-600 text-center mb-4",children:"Log in or register as a preceptor to join this site."}),e.jsx(c,{to:`/login?redirect=/invite/${i}`,className:"block",children:e.jsxs(n,{className:"w-full",children:[e.jsx($,{className:"w-4 h-4"})," Log In"]})}),e.jsx(c,{to:`/register?redirect=/invite/${i}&role=preceptor${s?.email?`&email=${encodeURIComponent(s.email)}`:""}`,className:"block",children:e.jsxs(n,{variant:"outline",className:"w-full",children:[e.jsx(G,{className:"w-4 h-4"})," Create Account"]})})]})]})]})})}export{O as AcceptInvite};
