import{a as ee,r as i,a6 as se,a4 as te,at as ae,au as re,j as e,f as _,ar as D,af as ne,A as le,C as $,h as O,B as ie,e as oe,as as ce,av as de,t as g}from"./index-GzcG7CSS.js";import{C as m}from"./Card-FSc1waky.js";import{E as me}from"./EmptyState-A3BIGBYI.js";import{C as xe}from"./Skeleton-CErRX1HU.js";import{B as T}from"./Badge-9_pL70Ln.js";import{M as ue}from"./Modal-CA0K5bCb.js";import{u as pe}from"./usePageTitle-CSRQyC0a.js";import{D as he}from"./download-COygb2Hf.js";import{F as ge}from"./funnel-fE0ZCBlq.js";import{U as fe}from"./user-BvMymkx8.js";import{C as be}from"./chevron-up-B1BLTNfs.js";import{T as B}from"./trending-up-Cyj7Q2GJ.js";import{S as L}from"./star-CqpiQmYF.js";const je=[{key:"clinical_knowledge",label:"Clinical Knowledge"},{key:"clinical_skills",label:"Clinical Skills"},{key:"professionalism",label:"Professionalism"},{key:"communication",label:"Communication"},{key:"critical_thinking",label:"Critical Thinking"},{key:"teamwork",label:"Teamwork"},{key:"time_management",label:"Time Management"},{key:"documentation",label:"Documentation"}];function Pe(){pe("Evaluations");const{user:j}=ee(),[U,v]=i.useState(!1),[W,V]=i.useState(null),[k,G]=i.useState("list"),[f,H]=i.useState("all"),[M,N]=i.useState(!1),[y,C]=i.useState(""),[a,c]=i.useState({type:j?.role==="preceptor"?"mid_rotation":"student_feedback",student_id:"",slot_id:"",ratings:{},comments:"",strengths:"",areas_for_improvement:""}),{data:Y,isLoading:q}=se(),{data:K}=te(),A=ae(),{data:P}=re(),l=Y?.data||[],b=(K?.data||[]).filter(s=>s.status==="accepted"),u=j?.role==="preceptor",n=j?.role==="student",p=i.useMemo(()=>(P||[]).filter(t=>t.type===a.type&&t.is_active),[P,a.type]),o=i.useMemo(()=>y?p.find(s=>s.id===y)||null:p.length>0?p[0]:null,[p,y]),Q=i.useMemo(()=>o?o.categories.map(s=>({key:s.key,label:s.label})):n?[{key:"clinical_environment",label:"Clinical Environment"},{key:"preceptor_teaching",label:"Preceptor Teaching Quality"},{key:"learning_opportunities",label:"Learning Opportunities"},{key:"support_mentorship",label:"Support & Mentorship"},{key:"organization",label:"Site Organization"},{key:"communication",label:"Communication"},{key:"work_life_balance",label:"Work-Life Balance"},{key:"overall_experience",label:"Overall Experience"}]:je,[o,n]),S=i.useMemo(()=>o?.rating_scale&&o.rating_scale.length>=2?o.rating_scale:[{value:1,label:"Poor"},{value:2,label:"Below Average"},{value:3,label:"Average"},{value:4,label:"Above Average"},{value:5,label:"Outstanding"}],[o]),F=f==="all"?l:l.filter(s=>s.type===f),R=i.useMemo(()=>{const s=l.filter(t=>t.overall_score!=null&&!isNaN(Number(t.overall_score)));return s.length===0?0:Math.round(s.reduce((t,r)=>t+Number(r.overall_score),0)/s.length*10)/10},[l]),E=i.useMemo(()=>{const s={};for(const t of l)for(const[r,x]of Object.entries(t.ratings))s[r]||(s[r]={sum:0,count:0}),s[r].sum+=x,s[r].count+=1;return Object.entries(s).map(([t,r])=>({key:t,label:t.replace(/_/g," "),avg:Math.round(r.sum/r.count*10)/10})).sort((t,r)=>r.avg-t.avg)},[l]),J=i.useMemo(()=>l.filter(s=>s.overall_score!=null).sort((s,t)=>new Date(s.created_at).getTime()-new Date(t.created_at).getTime()).map(s=>({date:new Date(s.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"}),score:Number(s.overall_score),type:s.type})),[l]),X=(s,t)=>{c(r=>({...r,ratings:{...r.ratings,[s]:t}}))},w=()=>{const s=Object.values(a.ratings);return s.length===0?0:Math.round(s.reduce((t,r)=>t+r,0)/s.length*10)/10},Z=async()=>{if(!a.slot_id){g.error("Please select a rotation");return}if(u&&!a.student_id){g.error("Please select a student");return}if(Object.keys(a.ratings).length<3){g.error("Please rate at least 3 categories");return}if(!a.comments){g.error("Please add comments");return}try{await A.mutateAsync({type:a.type,template_id:o?.id||void 0,student_id:a.student_id||void 0,slot_id:a.slot_id,ratings:a.ratings,comments:a.comments,overall_score:w(),strengths:a.strengths||null,areas_for_improvement:a.areas_for_improvement||null,is_submitted:!0}),g.success("Evaluation submitted successfully"),v(!1),C(""),c({type:u?"mid_rotation":"student_feedback",student_id:"",slot_id:"",ratings:{},comments:"",strengths:"",areas_for_improvement:""})}catch(s){const t=s instanceof Error?s.message:"Failed to submit evaluation";g.error(t)}},d=(s,t="sm")=>{const r=t==="sm"?"w-4 h-4":"w-5 h-5";return e.jsx("div",{className:"flex gap-0.5",children:[1,2,3,4,5].map(x=>e.jsx(L,{className:`${r} ${x<=Math.round(s)?"text-amber-400 fill-amber-400":"text-stone-300"}`},x))})},I=s=>{const t=a.ratings[s]||0;return e.jsxs("div",{className:"flex gap-1 items-center",children:[S.map(r=>e.jsxs("button",{onClick:()=>X(s,r.value),className:"focus:outline-none group relative",title:`${r.label}${r.description?` - ${r.description}`:""}`,children:[e.jsx(L,{className:`w-6 h-6 transition-colors ${r.value<=t?"text-amber-400 fill-amber-400":"text-stone-300 hover:text-amber-300"}`}),e.jsx("span",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-1.5 px-2 py-1 text-xs bg-stone-800 text-white rounded-lg whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:r.label})]},r.value)),t>0&&e.jsx("span",{className:"text-xs text-stone-500 ml-1.5",children:S.find(r=>r.value===t)?.label})]})},h=s=>{switch(s){case"mid_rotation":return"Mid-Rotation";case"final":return"Final";case"student_feedback":return"Site Feedback";default:return s}},z=s=>{switch(s){case"mid_rotation":return"primary";case"final":return"success";case"student_feedback":return"secondary";default:return"default"}};return q?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"h-7 w-48 bg-stone-200/60 rounded-lg animate-pulse"}),e.jsx("div",{className:"h-4 w-72 bg-stone-200/60 rounded-lg animate-pulse mt-2"})]})}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((s,t)=>e.jsx(xe,{},t))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-stone-900",children:"Evaluations"}),e.jsx("p",{className:"text-stone-500",children:u?"Evaluate your students' performance":n?"View your evaluations and provide site feedback":"Clinical evaluations overview"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(_,{variant:"secondary",onClick:()=>N(!M),children:[e.jsx(he,{className:"w-4 h-4"})," Export"]}),M&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>N(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-44 bg-white rounded-xl shadow-lg border border-stone-200 py-1 z-20",children:[e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-stone-50",onClick:()=>{window.open(D.evaluationsCsvUrl()),N(!1)},children:"Download CSV"}),e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-stone-50",onClick:()=>{window.open(D.evaluationsPdfUrl()),N(!1)},children:"Download PDF"})]})]})]}),(u||n||j?.role==="coordinator")&&e.jsxs(_,{onClick:()=>v(!0),children:[e.jsx(ne,{className:"w-4 h-4"})," ",n?"Give Site Feedback":"New Evaluation"]})]})]}),l.length>0&&e.jsx(m,{className:"bg-gradient-to-r from-amber-50 to-primary-50 border-amber-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(le,{className:"w-5 h-5 text-amber-600"}),e.jsx("h3",{className:"font-semibold text-stone-900",children:"Overall Performance"})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx("span",{className:"text-3xl font-bold text-amber-600",children:R}),e.jsxs("div",{children:[d(R,"md"),e.jsxs("p",{className:"text-xs text-stone-500 mt-0.5",children:[l.length," evaluation",l.length!==1?"s":""]})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:l.filter(s=>s.type==="mid_rotation").length}),e.jsx("p",{className:"text-xs text-stone-500",children:"Mid-Rotation"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:l.filter(s=>s.type==="final").length}),e.jsx("p",{className:"text-xs text-stone-500",children:"Final"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:l.filter(s=>s.type==="student_feedback").length}),e.jsx("p",{className:"text-xs text-stone-500",children:"Feedback"})]})]})]})}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1",children:[{key:"list",label:"Evaluations",icon:e.jsx($,{className:"w-4 h-4"})},{key:"summary",label:"Performance Summary",icon:e.jsx(O,{className:"w-4 h-4"})}].map(s=>e.jsxs("button",{onClick:()=>G(s.key),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-medium whitespace-nowrap transition-all ${k===s.key?"bg-primary-500 text-white":"bg-stone-100 text-stone-600 hover:bg-stone-200"}`,children:[s.icon," ",s.label]},s.key))}),k==="list"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-stone-400"}),["all","mid_rotation","final","student_feedback"].map(s=>e.jsx("button",{onClick:()=>H(s),className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${f===s?"bg-primary-100 text-primary-700":"bg-stone-50 text-stone-500 hover:bg-stone-100"}`,children:s==="all"?"All":h(s)},s))]}),F.length===0&&e.jsx(m,{children:e.jsx(me,{illustration:"clipboard",title:f==="all"?"No evaluations yet":`No ${h(f).toLowerCase()} evaluations`,description:u?"Create your first evaluation for a student.":n?"Evaluations from your preceptors will appear here.":"No evaluations have been submitted."})}),e.jsx("div",{className:"space-y-3",children:F.map(s=>{const t=W===s.id;return e.jsxs(m,{padding:"none",children:[e.jsx("div",{className:"p-4 sm:p-6 cursor-pointer hover:bg-stone-50/30 transition-colors",onClick:()=>V(t?null:s.id),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center shrink-0 ${Number(s.overall_score)>=4?"bg-green-50 text-green-600":Number(s.overall_score)>=3?"bg-amber-50 text-amber-600":"bg-red-50 text-red-600"}`,children:e.jsx($,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("h3",{className:"font-semibold text-stone-900",children:[h(s.type)," Evaluation"]}),e.jsx(T,{variant:z(s.type),size:"sm",children:h(s.type)}),e.jsxs(T,{variant:Number(s.overall_score)>=4?"success":Number(s.overall_score)>=3?"warning":"danger",children:[Number(s.overall_score)||0,"/5"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-1.5 text-xs text-stone-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"w-3.5 h-3.5"}),n?`By ${s.preceptor?.first_name||""} ${s.preceptor?.last_name||""}`:`${s.student?.first_name||""} ${s.student?.last_name||""}`]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-3.5 h-3.5"}),s.slot?.title||s.slot?.specialty||"Rotation"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-3.5 h-3.5"}),new Date(s.created_at).toLocaleDateString()]})]}),e.jsx("div",{className:"mt-2",children:d(s.overall_score)})]}),e.jsx("div",{className:"shrink-0 text-stone-400",children:t?e.jsx(be,{className:"w-5 h-5"}):e.jsx(ce,{className:"w-5 h-5"})})]})}),t&&e.jsxs("div",{className:"border-t border-stone-200 p-4 sm:p-6 bg-stone-50/50 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-stone-700 mb-3",children:"Rating Breakdown"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:Object.entries(s.ratings).map(([r,x])=>e.jsxs("div",{className:"flex items-center justify-between bg-white rounded-xl p-3 border border-stone-200",children:[e.jsx("span",{className:"text-sm text-stone-700 capitalize",children:r.replace(/_/g," ")}),e.jsxs("div",{className:"flex items-center gap-2",children:[d(x),e.jsx("span",{className:"text-sm font-medium text-stone-900 w-6 text-right",children:x})]})]},r))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(de,{className:"w-4 h-4 text-stone-500"}),e.jsx("h4",{className:"text-sm font-medium text-stone-700",children:"Comments"})]}),e.jsx("p",{className:"text-sm text-stone-600 bg-white rounded-xl p-4 border border-stone-200 leading-relaxed",children:s.comments})]}),s.strengths&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-green-700 mb-1",children:"Strengths"}),e.jsx("p",{className:"text-sm text-stone-600 bg-green-50 rounded-xl p-3 border border-green-200",children:s.strengths})]}),s.areas_for_improvement&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-amber-700 mb-1",children:"Areas for Improvement"}),e.jsx("p",{className:"text-sm text-stone-600 bg-amber-50 rounded-xl p-3 border border-amber-200",children:s.areas_for_improvement})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2 border-t border-stone-200",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-100 text-primary-700 flex items-center justify-center font-semibold text-xs",children:n?`${s.preceptor?.first_name?.[0]||""}${s.preceptor?.last_name?.[0]||""}`:`${s.student?.first_name?.[0]||""}${s.student?.last_name?.[0]||""}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-stone-900",children:n?`${s.preceptor?.first_name||""} ${s.preceptor?.last_name||""}`:`${s.student?.first_name||""} ${s.student?.last_name||""}`}),e.jsxs("p",{className:"text-xs text-stone-500",children:[n?"Preceptor":"Student"," - ",s.slot?.site?.name||s.slot?.title]})]})]})]})]},s.id)})})]}),k==="summary"&&e.jsx("div",{className:"space-y-6",children:l.length===0?e.jsxs(m,{className:"text-center py-12",children:[e.jsx(O,{className:"w-12 h-12 text-stone-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-stone-700 mb-2",children:"No data yet"}),e.jsx("p",{className:"text-stone-500",children:"Performance summary will appear after you receive evaluations"})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(m,{children:[e.jsx("h3",{className:"font-semibold text-stone-900 mb-4",children:"Skill Ratings"}),e.jsx("div",{className:"space-y-3",children:E.map(s=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-stone-700 capitalize",children:s.label}),e.jsxs("div",{className:"flex items-center gap-2",children:[d(s.avg),e.jsx("span",{className:"font-medium text-stone-900 w-8 text-right",children:s.avg})]})]}),e.jsx("div",{className:"w-full bg-stone-100 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${s.avg>=4?"bg-green-500":s.avg>=3?"bg-amber-500":"bg-red-500"}`,style:{width:`${s.avg/5*100}%`}})})]},s.key))})]}),e.jsxs(m,{children:[e.jsx("h3",{className:"font-semibold text-stone-900 mb-4",children:"Score History"}),e.jsx("div",{className:"space-y-3",children:J.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl border border-stone-200",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center shrink-0 ${s.score>=4?"bg-green-50 text-green-600":s.score>=3?"bg-amber-50 text-amber-600":"bg-red-50 text-red-600"}`,children:e.jsx("span",{className:"text-lg font-bold",children:s.score})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-medium text-stone-900",children:[h(s.type)," Evaluation"]}),e.jsx(T,{variant:z(s.type),size:"sm",children:h(s.type)})]}),e.jsx("p",{className:"text-xs text-stone-500",children:s.date})]}),d(s.score)]},t))})]}),e.jsxs(m,{children:[e.jsxs("h3",{className:"font-semibold text-green-800 mb-3 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"})," Top Strengths"]}),E.slice(0,3).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 mb-1",children:[e.jsx("span",{className:"text-sm text-stone-700 capitalize",children:s.label}),e.jsxs("div",{className:"flex items-center gap-1",children:[d(s.avg),e.jsx("span",{className:"text-sm font-semibold text-green-600 ml-1",children:s.avg})]})]},s.key))]}),e.jsxs(m,{children:[e.jsxs("h3",{className:"font-semibold text-amber-800 mb-3 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 rotate-180"})," Areas to Develop"]}),E.slice(-3).reverse().map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 mb-1",children:[e.jsx("span",{className:"text-sm text-stone-700 capitalize",children:s.label}),e.jsxs("div",{className:"flex items-center gap-1",children:[d(s.avg),e.jsx("span",{className:"text-sm font-semibold text-amber-600 ml-1",children:s.avg})]})]},s.key))]})]})}),e.jsx(ue,{isOpen:U,onClose:()=>v(!1),title:n?"Site & Preceptor Feedback":"New Evaluation",size:"lg",children:e.jsxs("div",{className:"space-y-5",children:[n&&e.jsxs("div",{className:"bg-secondary-50 rounded-xl p-4 text-sm text-secondary-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Help improve clinical education!"}),e.jsx("p",{className:"text-xs text-secondary-700",children:"Your feedback helps other students find great rotations and helps sites improve their programs. All feedback is confidential."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[!n&&e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Evaluation Type"}),e.jsxs("select",{value:a.type,onChange:s=>{c({...a,type:s.target.value,ratings:{}}),C("")},className:"w-full rounded-xl border border-stone-300 px-4 py-2.5 text-sm bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"mid_rotation",children:"Mid-Rotation"}),e.jsx("option",{value:"final",children:"Final"})]})]}),p.length>0&&e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Rubric Template"}),e.jsx("select",{value:y||o?.id||"",onChange:s=>{C(s.target.value),c(t=>({...t,ratings:{}}))},className:"w-full rounded-xl border border-stone-300 px-4 py-2.5 text-sm bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:p.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.categories.length," categories",s.rating_scale?`, ${s.rating_scale.length}-pt scale`:"",")"]},s.id))}),o?.rating_scale&&e.jsxs("p",{className:"text-xs text-stone-400",children:["Scale: ",o.rating_scale.map(s=>`${s.value}=${s.label}`).join(", ")]})]}),u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Rotation *"}),e.jsxs("select",{value:a.slot_id,onChange:s=>c({...a,slot_id:s.target.value,student_id:""}),className:"w-full rounded-xl border border-stone-300 px-4 py-2.5 text-sm bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"",children:"Select rotation..."}),[...new Map(b.map(s=>[s.slot_id,s])).values()].map(s=>e.jsxs("option",{value:s.slot_id,children:[s.slot?.title||"Rotation"," - ",s.slot?.site?.name]},s.slot_id))]})]}),e.jsxs("div",{className:"space-y-1.5 sm:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Student *"}),e.jsxs("select",{value:a.student_id,onChange:s=>c({...a,student_id:s.target.value}),className:"w-full rounded-xl border border-stone-300 px-4 py-2.5 text-sm bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",disabled:!a.slot_id,children:[e.jsx("option",{value:"",children:a.slot_id?"Select student...":"Select a rotation first"}),b.filter(s=>s.slot_id===a.slot_id).map(s=>e.jsxs("option",{value:s.student_id,children:[s.student?.first_name," ",s.student?.last_name]},s.student_id))]}),a.slot_id&&b.filter(s=>s.slot_id===a.slot_id).length===0&&e.jsx("p",{className:"text-xs text-amber-600",children:"No accepted students for this rotation."})]})]}):e.jsxs("div",{className:`space-y-1.5 ${n?"sm:col-span-2":""}`,children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Rotation *"}),e.jsxs("select",{value:a.slot_id,onChange:s=>{const t=b.find(r=>r.slot_id===s.target.value);c({...a,slot_id:s.target.value,student_id:t?.student_id||""})},className:"w-full rounded-xl border border-stone-300 px-4 py-2.5 text-sm bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"",children:"Select rotation..."}),b.map(s=>e.jsxs("option",{value:s.slot_id,children:[s.slot?.title||"Rotation"," - ",s.slot?.site?.name]},s.id))]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-stone-700",children:n?"Rate Your Experience":"Performance Ratings"}),w()>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-stone-500",children:"Overall:"}),e.jsx("span",{className:"text-lg font-bold text-amber-500",children:w()}),e.jsxs("span",{className:"text-sm text-stone-400",children:["/ ",Math.max(...S.map(s=>s.value))]}),d(w(),"md")]})]}),e.jsx("div",{className:"space-y-3",children:Q.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl border border-stone-200 bg-white",children:[e.jsx("span",{className:"text-sm text-stone-700",children:s.label}),I(s.key)]},s.key))})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:n?"Your Feedback *":"Comments *"}),e.jsx("textarea",{value:a.comments,onChange:s=>c({...a,comments:s.target.value}),rows:4,placeholder:n?"Share your overall experience with this rotation. What did you learn? How was the preceptor?":"Provide detailed feedback on the student's clinical performance...",className:"w-full rounded-xl border border-stone-300 px-4 py-3 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-green-700",children:n?"What was great?":"Strengths"}),e.jsx("textarea",{value:a.strengths,onChange:s=>c({...a,strengths:s.target.value}),rows:3,placeholder:n?"What aspects of the rotation were excellent?":"Areas where the student excels...",className:"w-full rounded-xl border border-green-200 px-4 py-3 text-sm focus:border-green-500 focus:ring-2 focus:ring-green-500/20 focus:outline-none resize-none bg-green-50/50"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-amber-700",children:n?"What could improve?":"Areas for Improvement"}),e.jsx("textarea",{value:a.areas_for_improvement,onChange:s=>c({...a,areas_for_improvement:s.target.value}),rows:3,placeholder:n?"Suggestions for improving the rotation experience...":"Areas where the student can grow...",className:"w-full rounded-xl border border-amber-200 px-4 py-3 text-sm focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20 focus:outline-none resize-none bg-amber-50/50"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-2",children:[e.jsx(_,{variant:"ghost",onClick:()=>v(!1),children:"Cancel"}),e.jsxs(_,{onClick:Z,isLoading:A.isPending,children:[e.jsx($,{className:"w-4 h-4"})," ",n?"Submit Feedback":"Submit Evaluation"]})]})]})})]})}export{Pe as Evaluations};
