import{c as E,a as M,r as p,j as e,f as L,ar as S,a8 as V,bU as B,B as A,l as h,g as D,d as F,as as b,bV as R,a4 as $,bW as O,a1 as U,G as z}from"./index-GzcG7CSS.js";import{C as o}from"./Card-FSc1waky.js";import{B as v}from"./Badge-9_pL70Ln.js";import{u as G}from"./usePageTitle-CSRQyC0a.js";import{D as W}from"./download-COygb2Hf.js";import{C as w}from"./chevron-right-D8jrJqqK.js";import{P as X}from"./paperclip-CDP-dEKu.js";import{C as q}from"./circle-check-big-B5eOtT2b.js";import{C as Y}from"./circle-x-BhxGvoPR.js";import{T as k}from"./triangle-alert-DWR7AhnE.js";const H=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]],P=E("shield-x",H),J={compliant:{icon:h,color:"text-green-600",bg:"bg-green-50",label:"Compliant"},in_progress:{icon:D,color:"text-amber-600",bg:"bg-amber-50",label:"In Progress"},non_compliant:{icon:P,color:"text-red-600",bg:"bg-red-50",label:"Non-Compliant"}};function y({status:s}){const l=J[s],i=l.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${l.bg} ${l.color}`,children:[e.jsx(i,{className:"w-3.5 h-3.5"}),l.label]})}function T({value:s,max:l,color:i="bg-primary-500"}){const d=l>0?Math.round(s/l*100):100;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-stone-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${i} rounded-full transition-all`,style:{width:`${d}%`}})}),e.jsxs("span",{className:"text-xs text-stone-500 w-8 text-right",children:[d,"%"]})]})}function _({student:s}){return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-stone-50 rounded-xl",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-stone-700",children:[e.jsx(U,{className:"w-4 h-4 text-primary-500"}),"Credentials"]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-stone-500",children:"Total"}),e.jsx("span",{className:"font-medium",children:s.credentials.total})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-stone-500",children:"Valid"}),e.jsx("span",{className:"font-medium text-green-600",children:s.credentials.valid})]}),s.credentials.expired>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-stone-500",children:"Expired"}),e.jsx("span",{className:"font-medium text-red-600",children:s.credentials.expired})]}),s.credentials.expiring_soon>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-stone-500",children:"Expiring Soon"}),e.jsx("span",{className:"font-medium text-amber-600",children:s.credentials.expiring_soon})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-stone-500",children:"With Documents"}),e.jsxs("span",{className:"font-medium",children:[s.credentials.has_files,"/",s.credentials.total]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-stone-700",children:[e.jsx(q,{className:"w-4 h-4 text-secondary-500"}),"Onboarding Tasks"]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-stone-500",children:"Required"}),e.jsx("span",{className:"font-medium",children:s.tasks.required})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-stone-500",children:"Completed"}),e.jsxs("span",{className:"font-medium text-green-600",children:[s.tasks.required_completed,"/",s.tasks.required]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-stone-500",children:"Verified"}),e.jsxs("span",{className:"font-medium text-primary-600",children:[s.tasks.required_verified,"/",s.tasks.required]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-stone-500",children:"Files Attached"}),e.jsxs("span",{className:"font-medium",children:[s.tasks.with_files,"/",s.tasks.total]})]})]}),s.tasks.required>0&&e.jsx(T,{value:s.tasks.required_verified,max:s.tasks.required,color:s.tasks.required_verified===s.tasks.required?"bg-green-500":"bg-amber-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-stone-700",children:[e.jsx(z,{className:"w-4 h-4 text-amber-500"}),"Affiliation Agreement"]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-stone-500",children:"Status"}),s.agreement.status==="active"?e.jsx(v,{variant:"success",children:"Active"}):s.agreement.status==="none"?e.jsx(v,{variant:"danger",children:"None"}):e.jsx(v,{variant:"warning",children:s.agreement.status.replace("_"," ")})]}),s.agreement.end_date&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-stone-500",children:"Expires"}),e.jsx("span",{className:"font-medium",children:new Date(s.agreement.end_date).toLocaleDateString()})]})]})]})]})}function K(){const{data:s}=V(),l=s?.sites||[],[i,d]=p.useState(null),x=i||l[0]?.id||null,{data:m,isLoading:j}=B(x),n=m?.students||[],[r,N]=p.useState(""),[a,c]=p.useState("all"),[f,I]=p.useState(null),C=p.useMemo(()=>n.filter(t=>{if(a!=="all"&&t.overall_status!==a)return!1;if(r){const g=r.toLowerCase();return t.student_name.toLowerCase().includes(g)||t.student_email.toLowerCase().includes(g)||t.rotation.toLowerCase().includes(g)}return!0}),[n,r,a]),u=p.useMemo(()=>({total:n.length,compliant:n.filter(t=>t.overall_status==="compliant").length,inProgress:n.filter(t=>t.overall_status==="in_progress").length,nonCompliant:n.filter(t=>t.overall_status==="non_compliant").length}),[n]);return e.jsxs("div",{className:"space-y-6",children:[l.length>1&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"w-5 h-5 text-stone-400"}),e.jsx("select",{value:x||"",onChange:t=>d(t.target.value),className:"border border-stone-200 rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500",children:l.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{className:"w-5 h-5 text-stone-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:u.total}),e.jsx("p",{className:"text-xs text-stone-500",children:"Total Students"})]})]})}),e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:u.compliant}),e.jsx("p",{className:"text-xs text-stone-500",children:"Compliant"})]})]})}),e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"w-5 h-5 text-amber-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:u.inProgress}),e.jsx("p",{className:"text-xs text-stone-500",children:"In Progress"})]})]})}),e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:"w-5 h-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:u.nonCompliant}),e.jsx("p",{className:"text-xs text-stone-500",children:"Non-Compliant"})]})]})})]}),e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-stone-400"}),e.jsx("input",{type:"text",placeholder:"Search students...",value:r,onChange:t=>N(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-stone-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500"})]}),e.jsxs("select",{value:a,onChange:t=>c(t.target.value),className:"border border-stone-200 rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"compliant",children:"Compliant"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"non_compliant",children:"Non-Compliant"})]})]})}),j?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):C.length===0?e.jsxs(o,{className:"p-12 text-center",children:[e.jsx(h,{className:"w-12 h-12 text-stone-300 mx-auto mb-3"}),e.jsx("p",{className:"text-stone-500 font-medium",children:"No students found"}),e.jsx("p",{className:"text-sm text-stone-400 mt-1",children:n.length===0?"No accepted students at this site yet.":"Try adjusting your filters."})]}):e.jsx("div",{className:"space-y-2",children:C.map(t=>e.jsxs(o,{className:"overflow-hidden",children:[e.jsxs("button",{className:"w-full p-4 flex items-center gap-3 text-left hover:bg-stone-50 transition-colors",onClick:()=>I(f===t.application_id?null:t.application_id),children:[f===t.application_id?e.jsx(b,{className:"w-4 h-4 text-stone-400 shrink-0"}):e.jsx(w,{className:"w-4 h-4 text-stone-400 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-stone-900",children:t.student_name}),e.jsx("span",{className:"text-xs text-stone-400",children:t.student_email})]}),e.jsx("p",{className:"text-xs text-stone-500 mt-0.5",children:t.rotation})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-2 text-xs text-stone-500",children:[e.jsxs("span",{className:"flex items-center gap-1",title:"Credentials",children:[e.jsx(X,{className:"w-3 h-3"}),t.credentials.valid+t.credentials.no_expiration,"/",t.credentials.total]}),e.jsxs("span",{className:"flex items-center gap-1",title:"Tasks verified",children:[e.jsx(q,{className:"w-3 h-3"}),t.tasks.required_verified,"/",t.tasks.required]}),t.agreement.status==="active"?e.jsx("span",{className:"text-green-600",title:"Agreement active",children:e.jsx(h,{className:"w-3.5 h-3.5"})}):e.jsx("span",{className:"text-red-500",title:`Agreement: ${t.agreement.status}`,children:e.jsx(Y,{className:"w-3.5 h-3.5"})})]}),e.jsx(y,{status:t.overall_status})]})]}),f===t.application_id&&e.jsx("div",{className:"border-t border-stone-100",children:e.jsx(_,{student:t})})]},t.application_id))})]})}function Q(){const{data:s,isLoading:l}=R(),i=s?.sites||[],[d,x]=p.useState(null),[m,j]=p.useState(null);if(l)return e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})});const n=i.reduce((a,c)=>a+c.total_students,0),r=i.reduce((a,c)=>a+c.compliant_students,0),N=n>0?Math.round(r/n*100):100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(o,{className:"p-4",children:[e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:i.length}),e.jsx("p",{className:"text-xs text-stone-500",children:"Active Sites"})]}),e.jsxs(o,{className:"p-4",children:[e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:n}),e.jsx("p",{className:"text-xs text-stone-500",children:"Total Students"})]}),e.jsxs(o,{className:"p-4",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:r}),e.jsx("p",{className:"text-xs text-stone-500",children:"Fully Compliant"})]}),e.jsxs(o,{className:"p-4",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary-600",children:[N,"%"]}),e.jsx("p",{className:"text-xs text-stone-500",children:"Compliance Rate"})]})]}),i.length===0?e.jsxs(o,{className:"p-12 text-center",children:[e.jsx(h,{className:"w-12 h-12 text-stone-300 mx-auto mb-3"}),e.jsx("p",{className:"text-stone-500 font-medium",children:"No active placements"}),e.jsx("p",{className:"text-sm text-stone-400 mt-1",children:"Students with accepted applications will appear here."})]}):e.jsx("div",{className:"space-y-3",children:i.map(a=>e.jsxs(o,{className:"overflow-hidden",children:[e.jsxs("button",{className:"w-full p-4 flex items-center gap-3 text-left hover:bg-stone-50 transition-colors",onClick:()=>x(d===a.site_id?null:a.site_id),children:[d===a.site_id?e.jsx(b,{className:"w-4 h-4 text-stone-400 shrink-0"}):e.jsx(w,{className:"w-4 h-4 text-stone-400 shrink-0"}),e.jsx(A,{className:"w-5 h-5 text-secondary-500 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"font-semibold text-stone-900",children:a.site_name}),e.jsxs("p",{className:"text-xs text-stone-500",children:[a.site_city,", ",a.site_state]})]}),e.jsxs("div",{className:"flex items-center gap-4 shrink-0",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold text-stone-900",children:[a.compliant_students,"/",a.total_students]}),e.jsx("p",{className:"text-xs text-stone-500",children:"compliant"})]}),e.jsx("div",{className:"w-16",children:e.jsx(T,{value:a.compliant_students,max:a.total_students,color:a.compliance_percentage===100?"bg-green-500":a.compliance_percentage>=50?"bg-amber-500":"bg-red-500"})})]})]}),d===a.site_id&&e.jsx("div",{className:"border-t border-stone-100 divide-y divide-stone-100",children:a.students.map(c=>e.jsxs("div",{children:[e.jsxs("button",{className:"w-full px-4 py-3 flex items-center gap-3 text-left hover:bg-stone-50 transition-colors",onClick:()=>j(m===c.application_id?null:c.application_id),children:[e.jsx("div",{className:"w-4"})," ",m===c.application_id?e.jsx(b,{className:"w-3.5 h-3.5 text-stone-400 shrink-0"}):e.jsx(w,{className:"w-3.5 h-3.5 text-stone-400 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-medium text-stone-900",children:c.student_name}),e.jsx("span",{className:"text-xs text-stone-400 ml-2",children:c.rotation})]}),e.jsx(y,{status:c.overall_status})]}),m===c.application_id&&e.jsx("div",{className:"px-4 pb-3",children:e.jsx(_,{student:c})})]},c.application_id))})]},a.site_id))})]})}function Z(){const{data:s}=$(),l=(s?.data||[]).filter(r=>r.status==="accepted"),[i,d]=p.useState(null),x=i||l[0]?.id||null,{data:m,isLoading:j}=O(x),n=m?.compliance;return l.length===0?e.jsxs(o,{className:"p-12 text-center",children:[e.jsx(h,{className:"w-12 h-12 text-stone-300 mx-auto mb-3"}),e.jsx("p",{className:"text-stone-500 font-medium",children:"No active rotations"}),e.jsx("p",{className:"text-sm text-stone-400 mt-1",children:"Once you have an accepted application, your compliance checklist will appear here."})]}):e.jsxs("div",{className:"space-y-6",children:[l.length>1&&e.jsx("select",{value:x||"",onChange:r=>d(r.target.value),className:"border border-stone-200 rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500",children:l.map(r=>e.jsxs("option",{value:r.id,children:[r.slot?.title||"Rotation"," - ",r.slot?.site?.name||"Site"]},r.id))}),j?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(o,{className:"p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-stone-900",children:n.rotation}),e.jsx("p",{className:"text-sm text-stone-500",children:n.site_name})]}),e.jsx(y,{status:n.overall_status})]}),n.overall_status==="non_compliant"&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-red-50 rounded-xl text-sm text-red-700 mb-4",children:[e.jsx(k,{className:"w-4 h-4 shrink-0 mt-0.5"}),e.jsxs("span",{children:[n.credentials.expired>0&&"You have expired credentials. ",n.agreement.status!=="active"&&"No active affiliation agreement between your university and this site. ","Please address these issues to become compliant."]})]}),n.credentials.expiring_soon>0&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 rounded-xl text-sm text-amber-700 mb-4",children:[e.jsx(k,{className:"w-4 h-4 shrink-0 mt-0.5"}),e.jsxs("span",{children:[n.credentials.expiring_soon," credential(s) expiring within 30 days. Please renew soon."]})]})]}),e.jsx(_,{student:n})]}):null]})}function de(){G("Compliance");const{user:s}=M(),[l,i]=p.useState(!1),d=s?.role==="site_manager",x=s?.role==="coordinator"||s?.role==="professor"||s?.role==="admin",m=s?.role==="student";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-stone-900",children:"Compliance Dashboard"}),e.jsxs("p",{className:"text-stone-500 mt-1",children:[d&&"Track student documentation and compliance status for your site.",x&&"Monitor compliance across all your student placements.",m&&"View your documentation status for active rotations."]})]}),(d||x)&&e.jsxs("div",{className:"relative",children:[e.jsxs(L,{variant:"secondary",onClick:()=>i(!l),children:[e.jsx(W,{className:"w-4 h-4"})," Export"]}),l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>i(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-44 bg-white rounded-xl shadow-lg border border-stone-200 py-1 z-20",children:[e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-stone-50",onClick:()=>{window.open(S.complianceCsvUrl()),i(!1)},children:"Download CSV"}),e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-stone-50",onClick:()=>{window.open(S.compliancePdfUrl()),i(!1)},children:"Download PDF"})]})]})]})]}),d&&e.jsx(K,{}),x&&e.jsx(Q,{}),m&&e.jsx(Z,{})]})}export{de as ComplianceDashboard};
