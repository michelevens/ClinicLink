import{r as c,au as ue,aJ as xe,bK as he,bL as ge,bM as be,j as e,f as b,af as O,w as G,T as fe,X as F,as as ve,t as x}from"./index-GzcG7CSS.js";import{C as M}from"./Card-FSc1waky.js";import{B as D}from"./Badge-9_pL70Ln.js";import{M as I}from"./Modal-CA0K5bCb.js";import{E as ye}from"./EmptyState-A3BIGBYI.js";import{u as je}from"./usePageTitle-CSRQyC0a.js";import{C as Ne}from"./copy-CERpL2dH.js";import{P as Ce}from"./pencil-Cb-MolFd.js";import{G as we}from"./grip-vertical-DIjb3W0q.js";import{C as ke}from"./chevron-right-D8jrJqqK.js";import{E as _e}from"./eye-DPEVXjN5.js";const q=["Clinical Skills","Professionalism","Communication","Critical Thinking","Patient Care","Medical Knowledge","Practice-Based Learning","Systems-Based Practice","Interpersonal Skills","Documentation","Clinical Judgment","Time Management","Teamwork & Collaboration","Ethics & Integrity","Patient Safety","Cultural Competency","Leadership","Problem Solving","Evidence-Based Practice","Self-Directed Learning","Technical Competence","Empathy & Compassion","Adaptability","Accountability","Initiative"],Se={mid_rotation:"Mid-Rotation",final:"Final",student_feedback:"Student Feedback"},f={3:[{value:1,label:"Below Expectations",description:"Does not meet minimum standards"},{value:2,label:"Meets Expectations",description:"Meets expected competency level"},{value:3,label:"Exceeds Expectations",description:"Demonstrates advanced competency"}],4:[{value:1,label:"Unsatisfactory",description:"Fails to meet requirements"},{value:2,label:"Developing",description:"Progressing but not yet competent"},{value:3,label:"Competent",description:"Meets expected standards"},{value:4,label:"Exceptional",description:"Consistently exceeds standards"}],5:[{value:1,label:"Poor",description:"Significant improvement needed"},{value:2,label:"Below Average",description:"Does not consistently meet expectations"},{value:3,label:"Average",description:"Meets expectations"},{value:4,label:"Above Average",description:"Frequently exceeds expectations"},{value:5,label:"Outstanding",description:"Consistently exceptional performance"}],10:Array.from({length:10},(y,h)=>({value:h+1,label:`${h+1}`,description:h===0?"Lowest":h===9?"Highest":void 0}))};function ze(){je("Evaluation Templates");const[y,h]=c.useState(""),[A,J]=c.useState(""),{data:k,isLoading:K}=ue({university_id:y||void 0,type:A||void 0}),{data:V}=xe(),L=V?.data||[],_=he(),S=ge(),H=be(),[W,m]=c.useState(!1),[X,E]=c.useState(!1),[v,T]=c.useState(null),[j,N]=c.useState(""),[$,C]=c.useState("mid_rotation"),[P,w]=c.useState(""),[n,o]=c.useState([]),[l,p]=c.useState(f[5]),[Q,u]=c.useState("5"),Y=()=>[{key:"clinical_skills",label:"Clinical Skills",description:"",weight:"",criteria:[],expanded:!1},{key:"professionalism",label:"Professionalism",description:"",weight:"",criteria:[],expanded:!1},{key:"communication",label:"Communication",description:"",weight:"",criteria:[],expanded:!1}],Z=()=>{T(null),N(""),C("mid_rotation"),w(y||""),o(Y()),p(f[5]),u("5"),m(!0)},ee=t=>{T(t),N(t.name),C(t.type),w(t.university_id),o(t.categories.map(s=>({key:s.key,label:s.label,description:s.description||"",weight:s.weight!=null?String(s.weight):"",criteria:(s.criteria||[]).map(a=>({key:a.key,label:a.label,description:a.description||""})),expanded:!1}))),p(t.rating_scale||f[5]),u(t.rating_scale?"custom":"5"),m(!0)},te=t=>{T(null),N(`${t.name} (Copy)`),C(t.type),w(t.university_id),o(t.categories.map(s=>({key:s.key,label:s.label,description:s.description||"",weight:s.weight!=null?String(s.weight):"",criteria:(s.criteria||[]).map(a=>({key:a.key,label:a.label,description:a.description||""})),expanded:!1}))),p(t.rating_scale||f[5]),u(t.rating_scale?"custom":"5"),m(!0)},se=()=>{const t=`category_${n.length+1}`;o([...n,{key:t,label:"",description:"",weight:"",criteria:[],expanded:!1}])},ae=t=>{o(n.filter((s,a)=>a!==t))},g=(t,s,a)=>{o(n.map((r,i)=>{if(i!==t)return r;const d={...r,[s]:a};return s==="label"&&(d.key=a.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_|_$/g,"")),d}))},re=t=>{o(n.map((s,a)=>a===t?{...s,expanded:!s.expanded}:s))},ie=t=>{o(n.map((s,a)=>{if(a!==t)return s;const r=`criterion_${s.criteria.length+1}`;return{...s,criteria:[...s.criteria,{key:r,label:"",description:""}],expanded:!0}}))},ne=(t,s)=>{o(n.map((a,r)=>r!==t?a:{...a,criteria:a.criteria.filter((i,d)=>d!==s)}))},U=(t,s,a,r)=>{o(n.map((i,d)=>d!==t?i:{...i,criteria:i.criteria.map((z,pe)=>{if(pe!==s)return z;const B={...z,[a]:r};return a==="label"&&(B.key=r.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_|_$/g,"")),B})}))},le=t=>{u(t),t!=="custom"&&f[t]&&p(f[t])},R=(t,s,a)=>{p(l.map((r,i)=>i===t?{...r,[s]:a}:r)),u("custom")},oe=()=>{const t=Math.max(...l.map(s=>s.value),0);p([...l,{value:t+1,label:"",description:""}]),u("custom")},ce=t=>{l.length<=2||(p(l.filter((s,a)=>a!==t)),u("custom"))},de=()=>{if(!j||!P||n.some(a=>!a.label)){x.error("Please fill in all required fields");return}const t=n.map(a=>({key:a.key,label:a.label,description:a.description||void 0,weight:a.weight?Number(a.weight):void 0,criteria:a.criteria.length>0?a.criteria.filter(r=>r.label).map(r=>({key:r.key,label:r.label,description:r.description||void 0})):void 0})),s=l.length>=2?l:void 0;v?S.mutate({id:v.id,data:{name:j,categories:t,rating_scale:s}},{onSuccess:()=>{x.success("Template updated"),m(!1)},onError:a=>x.error(a.message)}):_.mutate({university_id:P,type:$,name:j,categories:t,rating_scale:s},{onSuccess:()=>{x.success("Template created"),m(!1)},onError:a=>x.error(a.message)})},me=t=>{confirm("Delete this template?")&&H.mutate(t,{onSuccess:()=>x.success("Template deleted"),onError:s=>x.error(s.message)})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-stone-900",children:"Evaluation Templates"}),e.jsx("p",{className:"text-stone-500",children:"Manage custom evaluation rubrics per university"})]}),e.jsxs(b,{onClick:Z,children:[e.jsx(O,{className:"w-4 h-4"})," New Template"]})]}),e.jsx(M,{children:e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("select",{value:y,onChange:t=>h(t.target.value),className:"rounded-xl border border-stone-300 px-3 py-2 text-sm bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"",children:"All Universities"}),L.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("select",{value:A,onChange:t=>J(t.target.value),className:"rounded-xl border border-stone-300 px-3 py-2 text-sm bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"mid_rotation",children:"Mid-Rotation"}),e.jsx("option",{value:"final",children:"Final"}),e.jsx("option",{value:"student_feedback",children:"Student Feedback"})]})]})}),K?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(G,{className:"w-8 h-8 animate-spin text-primary-500"})}):!k||k.length===0?e.jsx(M,{children:e.jsx(ye,{illustration:"clipboard",title:"No templates found",description:"Create a template to customize evaluation categories and scoring rubrics."})}):e.jsx("div",{className:"grid gap-4",children:k.map(t=>e.jsx(M,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-stone-900",children:t.name}),e.jsx(D,{variant:t.is_active?"success":"default",size:"sm",children:t.is_active?"Active":"Inactive"}),e.jsx(D,{variant:"primary",size:"sm",children:Se[t.type]||t.type}),t.rating_scale&&e.jsxs(D,{variant:"secondary",size:"sm",children:[t.rating_scale.length,"-point scale"]})]}),e.jsx("p",{className:"text-sm text-stone-500 mb-3",children:t.university?.name}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.categories.map(s=>e.jsxs("span",{className:"text-xs bg-stone-100 text-stone-600 px-2 py-1 rounded-lg",children:[s.label,s.weight?` (${s.weight}%)`:"",s.criteria&&s.criteria.length>0&&e.jsxs("span",{className:"text-stone-400 ml-1",children:["(",s.criteria.length," criteria)"]})]},s.key))})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx("button",{onClick:()=>te(t),className:"p-2 rounded-lg hover:bg-stone-100 text-stone-500 transition-colors",title:"Duplicate",children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ee(t),className:"p-2 rounded-lg hover:bg-stone-100 text-stone-500 transition-colors",title:"Edit",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>me(t.id),className:"p-2 rounded-lg hover:bg-red-50 text-stone-500 hover:text-red-600 transition-colors",title:"Delete",children:e.jsx(fe,{className:"w-4 h-4"})})]})]})},t.id))}),e.jsx(I,{isOpen:W,onClose:()=>m(!1),title:v?"Edit Template":"New Evaluation Template",size:"xl",children:e.jsxs("div",{className:"space-y-4 max-h-[70vh] overflow-y-auto pr-1",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Template Name *"}),e.jsx("input",{value:j,onChange:t=>N(t.target.value),placeholder:"e.g. Standard Mid-Rotation",className:"w-full rounded-xl border border-stone-300 px-3 py-2.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"})]}),!v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Type *"}),e.jsxs("select",{value:$,onChange:t=>C(t.target.value),className:"w-full rounded-xl border border-stone-300 px-3 py-2.5 text-sm bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"mid_rotation",children:"Mid-Rotation"}),e.jsx("option",{value:"final",children:"Final"}),e.jsx("option",{value:"student_feedback",children:"Student Feedback"})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"University *"}),e.jsxs("select",{value:P,onChange:t=>w(t.target.value),className:"w-full rounded-xl border border-stone-300 px-3 py-2.5 text-sm bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"",children:"Select university..."}),L.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-stone-700",children:"Rating Scale"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-stone-500",children:"Preset:"}),["3","4","5","10"].map(t=>e.jsxs("button",{type:"button",onClick:()=>le(t),className:`px-2.5 py-1 text-xs rounded-lg border transition-colors ${Q===t?"bg-primary-50 border-primary-300 text-primary-700":"border-stone-200 text-stone-600 hover:bg-stone-50"}`,children:[t,"-pt"]},t))]})]}),e.jsxs("div",{className:"space-y-1.5",children:[l.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 bg-stone-50 rounded-lg px-3 py-2",children:[e.jsx("input",{type:"number",value:t.value,onChange:a=>R(s,"value",Number(a.target.value)),className:"w-14 rounded-lg border border-stone-200 px-2 py-1.5 text-sm text-center focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",min:"0"}),e.jsx("input",{value:t.label,onChange:a=>R(s,"label",a.target.value),placeholder:"Label *",className:"flex-1 rounded-lg border border-stone-200 px-3 py-1.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"}),e.jsx("input",{value:t.description||"",onChange:a=>R(s,"description",a.target.value),placeholder:"Description (optional)",className:"flex-1 rounded-lg border border-stone-200 px-3 py-1.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"}),l.length>2&&e.jsx("button",{onClick:()=>ce(s),className:"p-1 rounded hover:bg-red-50 text-stone-400 hover:text-red-600",children:e.jsx(F,{className:"w-3.5 h-3.5"})})]},s)),e.jsx("button",{type:"button",onClick:oe,className:"text-xs text-primary-600 hover:text-primary-700 font-medium pl-1",children:"+ Add level"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-stone-700",children:"Rating Categories *"}),e.jsxs(b,{size:"sm",variant:"outline",onClick:se,children:[e.jsx(O,{className:"w-3 h-3"})," Add"]})]}),e.jsx("div",{className:"space-y-2",children:n.map((t,s)=>e.jsxs("div",{className:"bg-stone-50 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(we,{className:"w-4 h-4 text-stone-400 mt-2.5 shrink-0"}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 sm:grid-cols-3 gap-2",children:[q.includes(t.label)||t.label===""?e.jsxs("select",{value:t.label,onChange:a=>{a.target.value==="__other__"?(g(s,"label",""),o(r=>r.map((i,d)=>d===s?{...i,key:"__custom__",label:""}:i))):g(s,"label",a.target.value)},className:"rounded-lg border border-stone-200 px-3 py-2 text-sm bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"",children:"Select category..."}),q.filter(a=>a===t.label||!n.some(r=>r.label===a)).map(a=>e.jsx("option",{value:a,children:a},a)),e.jsx("option",{value:"__other__",children:"Other (custom)..."})]}):e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{value:t.label,onChange:a=>g(s,"label",a.target.value),placeholder:"Custom category name *",className:"flex-1 rounded-lg border border-stone-200 px-3 py-2 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>g(s,"label",""),className:"px-2 py-1 text-xs text-primary-600 hover:text-primary-700 hover:bg-primary-50 rounded-lg transition-colors shrink-0",title:"Switch back to preset list",children:"Presets"})]}),e.jsx("input",{value:t.description,onChange:a=>g(s,"description",a.target.value),placeholder:"Description (optional)",className:"rounded-lg border border-stone-200 px-3 py-2 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"}),e.jsx("input",{value:t.weight,onChange:a=>g(s,"weight",a.target.value),placeholder:"Weight % (optional)",type:"number",min:"0",max:"100",className:"rounded-lg border border-stone-200 px-3 py-2 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"})]}),n.length>1&&e.jsx("button",{onClick:()=>ae(s),className:"p-1.5 rounded-lg hover:bg-red-50 text-stone-400 hover:text-red-600 mt-1.5",children:e.jsx(F,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"ml-6 mt-2",children:[e.jsxs("button",{type:"button",onClick:()=>re(s),className:"flex items-center gap-1 text-xs text-stone-500 hover:text-stone-700 font-medium mb-1",children:[t.expanded?e.jsx(ve,{className:"w-3 h-3"}):e.jsx(ke,{className:"w-3 h-3"}),"Criteria (",t.criteria.length,")"]}),t.expanded&&e.jsxs("div",{className:"space-y-1.5 pl-1",children:[t.criteria.map((a,r)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-stone-400 w-4 text-right",children:[r+1,"."]}),e.jsx("input",{value:a.label,onChange:i=>U(s,r,"label",i.target.value),placeholder:"Criterion name",className:"flex-1 rounded-lg border border-stone-200 px-2.5 py-1.5 text-xs focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"}),e.jsx("input",{value:a.description,onChange:i=>U(s,r,"description",i.target.value),placeholder:"Description (optional)",className:"flex-1 rounded-lg border border-stone-200 px-2.5 py-1.5 text-xs focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"}),e.jsx("button",{onClick:()=>ne(s,r),className:"p-1 rounded hover:bg-red-50 text-stone-400 hover:text-red-500",children:e.jsx(F,{className:"w-3 h-3"})})]},r)),e.jsx("button",{type:"button",onClick:()=>ie(s),className:"text-xs text-primary-600 hover:text-primary-700 font-medium",children:"+ Add criterion"})]})]})]},s))})]}),e.jsxs("div",{className:"flex justify-between pt-2",children:[e.jsxs(b,{variant:"outline",onClick:()=>E(!0),children:[e.jsx(_e,{className:"w-4 h-4"})," Preview Rubric"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{variant:"secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsxs(b,{onClick:de,disabled:_.isPending||S.isPending,children:[(_.isPending||S.isPending)&&e.jsx(G,{className:"w-4 h-4 animate-spin"}),v?"Update Template":"Create Template"]})]})]})]})}),e.jsxs(I,{isOpen:X,onClose:()=>E(!1),title:"Rubric Preview",size:"xl",children:[e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-stone-50",children:[e.jsx("th",{className:"text-left px-3 py-2 border border-stone-200 font-medium text-stone-700",children:"Category"}),l.map(t=>e.jsxs("th",{className:"text-center px-3 py-2 border border-stone-200 font-medium text-stone-700 min-w-[100px]",children:[e.jsx("div",{children:t.label}),e.jsxs("div",{className:"text-xs font-normal text-stone-400",children:["(",t.value,")"]})]},t.value))]})}),e.jsx("tbody",{children:n.filter(t=>t.label).map(t=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsxs("td",{className:"px-3 py-2 border border-stone-200 font-medium text-stone-900",children:[t.label,t.weight&&e.jsxs("span",{className:"text-xs text-stone-400 ml-1",children:["(",t.weight,"%)"]}),t.description&&e.jsx("p",{className:"text-xs text-stone-500 font-normal mt-0.5",children:t.description})]}),l.map(s=>e.jsx("td",{className:"text-center px-3 py-2 border border-stone-200",children:e.jsx("div",{className:"w-4 h-4 rounded-full border-2 border-stone-300 mx-auto"})},s.value))]},t.key),t.criteria.filter(s=>s.label).map(s=>e.jsxs("tr",{className:"bg-stone-50/50",children:[e.jsxs("td",{className:"px-3 py-1.5 border border-stone-200 pl-8 text-stone-600 text-xs",children:[s.label,s.description&&e.jsxs("span",{className:"text-stone-400 ml-1",children:["- ",s.description]})]}),l.map(a=>e.jsx("td",{className:"text-center px-3 py-1.5 border border-stone-200",children:e.jsx("div",{className:"w-3 h-3 rounded-full border border-stone-300 mx-auto"})},a.value))]},`${t.key}-${s.key}`))]}))})]}),l.some(t=>t.description)&&e.jsxs("div",{className:"mt-3 text-xs text-stone-500",children:[e.jsx("strong",{children:"Scale descriptions: "}),l.filter(t=>t.description).map(t=>`${t.value} = ${t.description}`).join(" | ")]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(b,{variant:"secondary",onClick:()=>E(!1),children:"Close"})})]})]})}export{ze as EvaluationTemplates};
