import{a as R,a8 as A,aZ as F,a_ as L,a$ as B,b0 as D,r as m,j as e,f as n,af as N,B as w,S as J,ac as U,U as G,g as W,t as i}from"./index-GzcG7CSS.js";import{C as x}from"./Card-FSc1waky.js";import{B as p}from"./Badge-9_pL70Ln.js";import{M as H}from"./Modal-CA0K5bCb.js";import{u as I}from"./usePageTitle-CSRQyC0a.js";import{M as O}from"./map-pin-B8WKBtoC.js";import{P as V}from"./phone-D6Tod6__.js";import{G as Z}from"./globe-DMMzYTpl.js";import{S as $}from"./star-CqpiQmYF.js";import{P as T}from"./pencil-Cb-MolFd.js";import{C as X}from"./circle-check-big-B5eOtT2b.js";import{C as K}from"./circle-x-BhxGvoPR.js";function ce(){I("My Sites");const{user:v}=R(),k=v?.role==="preceptor",{data:C,isLoading:S}=A(),u=C?.sites||[],h=F(),f=L(),{data:P}=B(),g=D(),b=P?.join_requests||[],[_,o]=m.useState(!1),[c,j]=m.useState(null),[t,a]=m.useState({name:"",address:"",city:"",state:"FL",zip:"",phone:"",website:"",description:"",specialties:"",ehr_system:""}),y=()=>{j(null),a({name:"",address:"",city:"",state:"FL",zip:"",phone:"",website:"",description:"",specialties:"",ehr_system:""}),o(!0)},z=s=>{j(s),a({name:s.name,address:s.address,city:s.city,state:s.state,zip:s.zip,phone:s.phone,website:s.website||"",description:s.description,specialties:s.specialties.join(", "),ehr_system:s.ehr_system||""}),o(!0)},M=async()=>{let s=t.website.trim();s&&!/^https?:\/\//i.test(s)&&(s="https://"+s);const r={...t,website:s||null,specialties:t.specialties.split(",").map(l=>l.trim()).filter(Boolean)};try{c?(await f.mutateAsync({id:c.id,data:r}),i.success("Site updated successfully")):(await h.mutateAsync(r),i.success("Site created successfully")),o(!1)}catch(l){const d=l;if(d?.response?.data?.errors){const E=Object.values(d.response.data.errors)[0]?.[0];i.error(E||"Validation failed. Please check your inputs.")}else i.error(d?.response?.data?.message||"Failed to save site. Please try again.")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-stone-900 dark:text-stone-100",children:"My Sites"}),e.jsx("p",{className:"text-stone-500 dark:text-stone-400 mt-1",children:"Manage your rotation sites and their details"})]}),e.jsxs(n,{onClick:y,children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Add Site"]})]}),S?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"})}):u.length===0?e.jsx(x,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(w,{className:"w-12 h-12 text-stone-300 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-stone-900 dark:text-stone-100 mb-1",children:"No sites yet"}),e.jsx("p",{className:"text-stone-500 dark:text-stone-400 text-sm mb-4",children:"Create your first rotation site to start accepting students."}),e.jsxs(n,{onClick:y,children:[e.jsx(N,{className:"w-4 h-4 mr-2"})," Add Site"]})]})}):e.jsx("div",{className:"grid gap-4",children:u.map(s=>e.jsx(x,{hover:!0,children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-primary-100 to-secondary-100 text-primary-600 flex items-center justify-center shrink-0",children:e.jsx(w,{className:"w-7 h-7"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-stone-900 dark:text-stone-100",children:s.name}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-sm text-stone-500 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"w-3.5 h-3.5"})," ",s.city,", ",s.state," ",s.zip]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-3.5 h-3.5"})," ",s.phone]}),s.website&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"w-3.5 h-3.5"})," ",s.website]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($,{className:"w-3.5 h-3.5 text-amber-400"})," ",s.rating," (",s.review_count," reviews)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:s.is_verified?"success":"warning",size:"sm",children:s.is_verified?"Verified":"Pending"}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>z(s),children:e.jsx(T,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-stone-600 dark:text-stone-400 line-clamp-2 mb-3",children:s.description}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mb-3",children:s.specialties.map(r=>e.jsx(p,{variant:"default",size:"sm",children:r},r))}),e.jsxs("div",{className:"flex gap-4 text-sm text-stone-500",children:[s.ehr_system&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-3.5 h-3.5"})," ",s.ehr_system]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-3.5 h-3.5"})," ",s.slots?.length||0," slots"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-3.5 h-3.5"})," ",s.slots?.reduce((r,l)=>r+l.filled,0)||0," students"]})]})]})]})},s.id))}),k&&b.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-stone-900 dark:text-stone-100",children:"My Join Requests"}),b.map(s=>e.jsx(x,{className:"!py-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center shrink-0 ${s.status==="pending"?"bg-amber-100 text-amber-600":s.status==="approved"?"bg-green-100 text-green-600":s.status==="denied"?"bg-red-100 text-red-600":"bg-stone-100 text-stone-500"}`,children:s.status==="pending"?e.jsx(W,{className:"w-5 h-5"}):s.status==="approved"?e.jsx(X,{className:"w-5 h-5"}):e.jsx(K,{className:"w-5 h-5"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-stone-900 dark:text-stone-100",children:s.site?.name}),e.jsxs("p",{className:"text-xs text-stone-500",children:[s.site?.city,", ",s.site?.state,e.jsx("span",{className:"mx-1",children:"Â·"}),"Submitted ",new Date(s.created_at).toLocaleDateString()]}),s.review_notes&&e.jsxs("p",{className:"text-xs text-stone-600 mt-0.5 italic",children:["Note: ",s.review_notes]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx(p,{variant:s.status==="pending"?"warning":s.status==="approved"?"success":s.status==="denied"?"danger":"default",children:s.status}),s.status==="pending"&&e.jsx(n,{variant:"outline",size:"sm",onClick:async()=>{try{await g.mutateAsync(s.id),i.success("Request withdrawn")}catch{i.error("Failed to withdraw")}},isLoading:g.isPending,children:"Withdraw"})]})]})},s.id))]}),e.jsx(H,{isOpen:_,onClose:()=>o(!1),title:c?"Edit Site":"Add New Site",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"sm:col-span-2 space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 dark:text-stone-300",children:"Site Name *"}),e.jsx("input",{value:t.name,onChange:s=>a({...t,name:s.target.value}),className:"w-full rounded-xl border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-800 dark:text-stone-100 px-4 py-2.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",placeholder:"e.g. Mercy General Hospital"})]}),e.jsxs("div",{className:"sm:col-span-2 space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 dark:text-stone-300",children:"Address *"}),e.jsx("input",{value:t.address,onChange:s=>a({...t,address:s.target.value}),className:"w-full rounded-xl border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-800 dark:text-stone-100 px-4 py-2.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 dark:text-stone-300",children:"City *"}),e.jsx("input",{value:t.city,onChange:s=>a({...t,city:s.target.value}),className:"w-full rounded-xl border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-800 dark:text-stone-100 px-4 py-2.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 dark:text-stone-300",children:"State *"}),e.jsx("input",{value:t.state,onChange:s=>a({...t,state:s.target.value.toUpperCase().slice(0,2)}),maxLength:2,className:"w-full rounded-xl border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-800 dark:text-stone-100 px-4 py-2.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",placeholder:"FL"})]}),e.jsxs("div",{className:"flex-1 space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 dark:text-stone-300",children:"ZIP *"}),e.jsx("input",{value:t.zip,onChange:s=>a({...t,zip:s.target.value}),className:"w-full rounded-xl border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-800 dark:text-stone-100 px-4 py-2.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",placeholder:"33101"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 dark:text-stone-300",children:"Phone *"}),e.jsx("input",{value:t.phone,onChange:s=>a({...t,phone:s.target.value}),className:"w-full rounded-xl border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-800 dark:text-stone-100 px-4 py-2.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",placeholder:"(305) 555-0100"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 dark:text-stone-300",children:"Website"}),e.jsx("input",{value:t.website,onChange:s=>a({...t,website:s.target.value}),className:"w-full rounded-xl border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-800 dark:text-stone-100 px-4 py-2.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",placeholder:"example.com"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 dark:text-stone-300",children:"EHR System"}),e.jsx("input",{value:t.ehr_system,onChange:s=>a({...t,ehr_system:s.target.value}),className:"w-full rounded-xl border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-800 dark:text-stone-100 px-4 py-2.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",placeholder:"e.g. Epic, Cerner"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 dark:text-stone-300",children:"Specialties (comma-separated)"}),e.jsx("input",{value:t.specialties,onChange:s=>a({...t,specialties:s.target.value}),className:"w-full rounded-xl border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-800 dark:text-stone-100 px-4 py-2.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",placeholder:"e.g. Emergency Medicine, ICU"})]}),e.jsxs("div",{className:"sm:col-span-2 space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 dark:text-stone-300",children:"Description"}),e.jsx("textarea",{value:t.description,onChange:s=>a({...t,description:s.target.value}),rows:3,className:"w-full rounded-xl border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-800 dark:text-stone-100 px-4 py-2.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none resize-none",placeholder:"Describe your site, facilities, and what students can expect..."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx(n,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(n,{onClick:M,disabled:!t.name||!t.address||!t.city||!t.state||!t.zip||!t.phone,isLoading:h.isPending||f.isPending,children:c?"Save Changes":"Create Site"})]})]})})]})}export{ce as MySite};
