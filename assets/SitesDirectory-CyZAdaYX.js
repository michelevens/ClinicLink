import{a as Ne,u as be,r,a$ as we,ba as Ce,I as Se,bb as ke,aZ as ze,a_ as _e,j as e,f as a,af as qe,d as Ae,B as se,S as De,g as Ee,T as P,t as o,q as Pe}from"./index-GzcG7CSS.js";import{C as R}from"./Card-FSc1waky.js";import{C as Re,T as Me}from"./Skeleton-CErRX1HU.js";import{B as c}from"./Badge-9_pL70Ln.js";import{M as g}from"./Modal-CA0K5bCb.js";import{I as d}from"./Input-B5MQDJHu.js";import{u as Je}from"./usePageTitle-CSRQyC0a.js";import{L as Le}from"./layout-grid-DbvINEB5.js";import{L as Fe}from"./list-NlTBPj9A.js";import{M as Te}from"./map-pin-B8WKBtoC.js";import{S as M}from"./star-CqpiQmYF.js";import{C as Ie}from"./circle-check-big-B5eOtT2b.js";import{U as J}from"./user-plus-CC3Tiyyp.js";import{P as L}from"./pencil-Cb-MolFd.js";import{C as Be}from"./chevron-left-Be6DhBVQ.js";import{C as Ve}from"./chevron-right-D8jrJqqK.js";import{P as $e}from"./phone-D6Tod6__.js";import{G as Ge}from"./globe-DMMzYTpl.js";const te={name:"",address:"",city:"",state:"",zip:"",phone:"",website:"",description:"",specialties:[],ehr_system:""};function ds(){Je("Sites Directory");const{user:v}=Ne(),F=v?.role==="admin",ae=v?.role==="site_manager",y=v?.role==="preceptor",ie=F||ae,T=be(),[I,re]=r.useState(""),[B,ne]=r.useState(""),[V,le]=r.useState(""),[N,h]=r.useState(1),[i,p]=r.useState(null),[b,$]=r.useState("grid"),[ce,w]=r.useState(!1),[_,C]=r.useState(null),[u,x]=r.useState(null),[oe,G]=r.useState(!1),[n,l]=r.useState(te),[O,S]=r.useState(""),[k,j]=r.useState(null),[U,z]=r.useState(""),{data:de}=we(),H=Ce(),xe=de?.join_requests||[],[me,Oe]=r.useState(new Set);r.useEffect(()=>{y&&Se.myPending().then(s=>{}).catch(()=>{})},[y]);const W=s=>{if(me.has(s))return"linked";const t=xe.find(f=>f.site_id===s);return t?.status==="pending"?"pending":t?.status==="approved"?"approved":"none"},he=async()=>{if(k)try{await H.mutateAsync({site_id:k,message:U||void 0}),o.success("Join request submitted!"),j(null),z("")}catch(s){o.error(s instanceof Error?s.message:"Failed to submit request")}},{data:q,isLoading:pe,refetch:ue}=ke({search:I,specialty:B||void 0,state:V||void 0,page:N}),Y=ze(),Z=_e(),m=q?.data||[],A=q?.last_page||1,K=q?.total||0,X=r.useMemo(()=>{const s=new Set;return m.forEach(t=>t.specialties.forEach(f=>s.add(f))),Array.from(s).sort()},[m]),je=()=>{l(te),S(""),w(!0)},D=s=>{l({name:s.name,address:s.address,city:s.city,state:s.state,zip:s.zip,phone:s.phone,website:s.website||"",description:s.description,specialties:[...s.specialties],ehr_system:s.ehr_system||""}),S(""),C(s)},E=s=>F||s.manager_id===v?.id,fe=async s=>{s.preventDefault();try{await Y.mutateAsync(n),o.success("Site created successfully"),w(!1)}catch(t){o.error(t instanceof Error?t.message:"Failed to create site")}},ge=async s=>{if(s.preventDefault(),!!_)try{await Z.mutateAsync({id:_.id,data:n}),o.success("Site updated successfully"),C(null)}catch(t){o.error(t instanceof Error?t.message:"Failed to update site")}},ve=async()=>{if(u){G(!0);try{await Pe.delete(u.id),o.success("Site deleted successfully"),x(null),i?.id===u.id&&p(null),ue()}catch(s){o.error(s instanceof Error?s.message:"Failed to delete site")}finally{G(!1)}}},Q=()=>{const s=O.trim();s&&!n.specialties.includes(s)&&(l(t=>({...t,specialties:[...t.specialties,s]})),S(""))},ye=s=>{l(t=>({...t,specialties:t.specialties.filter(f=>f!==s)}))},ee=e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{label:"Name",required:!0,value:n.name,onChange:s=>l(t=>({...t,name:s.target.value})),placeholder:"Site name"}),e.jsx(d,{label:"Address",required:!0,value:n.address,onChange:s=>l(t=>({...t,address:s.target.value})),placeholder:"Street address"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(d,{label:"City",required:!0,value:n.city,onChange:s=>l(t=>({...t,city:s.target.value})),placeholder:"City"}),e.jsx(d,{label:"State",required:!0,value:n.state,onChange:s=>l(t=>({...t,state:s.target.value.toUpperCase().slice(0,2)})),placeholder:"FL"}),e.jsx(d,{label:"ZIP",required:!0,value:n.zip,onChange:s=>l(t=>({...t,zip:s.target.value})),placeholder:"33101"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(d,{label:"Phone",required:!0,value:n.phone,onChange:s=>l(t=>({...t,phone:s.target.value})),placeholder:"(555) 555-5555"}),e.jsx(d,{label:"EHR System",value:n.ehr_system,onChange:s=>l(t=>({...t,ehr_system:s.target.value})),placeholder:"Epic, Cerner..."})]}),e.jsx(d,{label:"Website",type:"url",value:n.website,onChange:s=>l(t=>({...t,website:s.target.value})),placeholder:"https://..."}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Description"}),e.jsx("textarea",{value:n.description,onChange:s=>l(t=>({...t,description:s.target.value})),rows:3,placeholder:"Describe this clinical site...",className:"w-full rounded-xl border border-stone-300 bg-white px-4 py-2.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none resize-none"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Specialties"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:O,onChange:s=>S(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),Q())},placeholder:"Type and press Enter",className:"flex-1 rounded-xl border border-stone-300 bg-white px-4 py-2.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"}),e.jsx(a,{type:"button",variant:"outline",size:"sm",onClick:Q,children:"Add"})]}),n.specialties.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:n.specialties.map(s=>e.jsxs(c,{variant:"primary",size:"sm",children:[s,e.jsx("button",{type:"button",onClick:()=>ye(s),className:"ml-1 hover:text-red-300",children:"×"})]},s))})]})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-stone-900",children:"Sites Directory"}),e.jsxs("p",{className:"text-stone-500 mt-1",children:["Browse ",K>0?`${K} `:"","clinical rotation sites"]})]}),ie&&e.jsxs(a,{onClick:je,children:[e.jsx(qe,{className:"w-4 h-4 mr-1.5"})," Add Site"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-stone-400"}),e.jsx("input",{type:"text",placeholder:"Search sites by name, city...",value:I,onChange:s=>{re(s.target.value),h(1)},className:"w-full pl-10 pr-4 py-2.5 rounded-xl border border-stone-300 bg-white text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"})]}),X.length>0&&e.jsxs("select",{value:B,onChange:s=>{ne(s.target.value),h(1)},className:"px-4 py-2.5 rounded-xl border border-stone-300 bg-white text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"",children:"All Specialties"}),X.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:V,onChange:s=>{le(s.target.value),h(1)},className:"px-4 py-2.5 rounded-xl border border-stone-300 bg-white text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"",children:"All States"}),e.jsx("option",{value:"FL",children:"Florida"}),e.jsx("option",{value:"GA",children:"Georgia"}),e.jsx("option",{value:"TX",children:"Texas"}),e.jsx("option",{value:"NY",children:"New York"}),e.jsx("option",{value:"CA",children:"California"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>$("grid"),className:`p-2.5 rounded-xl border transition-colors ${b==="grid"?"bg-primary-50 text-primary-600 border-primary-200":"text-stone-400 hover:text-stone-600 border-stone-300"}`,children:e.jsx(Le,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>$("table"),className:`p-2.5 rounded-xl border transition-colors ${b==="table"?"bg-primary-50 text-primary-600 border-primary-200":"text-stone-400 hover:text-stone-600 border-stone-300"}`,children:e.jsx(Fe,{className:"w-4 h-4"})})]})]}),pe?b==="grid"?e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:Array.from({length:6}).map((s,t)=>e.jsx(Re,{},t))}):e.jsx(R,{padding:"none",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("table",{className:"w-full",children:e.jsx("tbody",{children:Array.from({length:6}).map((s,t)=>e.jsx(Me,{cols:5},t))})})})}):m.length===0?e.jsx(R,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(se,{className:"w-12 h-12 text-stone-300 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-stone-900 mb-1",children:"No sites found"}),e.jsx("p",{className:"text-stone-500 text-sm",children:"Try adjusting your search or filters."})]})}):b==="grid"?e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:m.map(s=>e.jsx(R,{hover:!0,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-primary-100 to-secondary-100 text-primary-600 flex items-center justify-center shrink-0",children:e.jsx(se,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-semibold text-stone-900 truncate",children:s.name}),s.is_verified&&e.jsx(c,{variant:"success",size:"sm",children:"Verified"})]}),e.jsxs("p",{className:"text-xs text-stone-500 flex items-center gap-1 mt-0.5",children:[e.jsx(Te,{className:"w-3 h-3"})," ",s.city,", ",s.state]})]})]}),e.jsx("p",{className:"text-sm text-stone-600 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.specialties.slice(0,3).map(t=>e.jsx(c,{variant:"default",size:"sm",children:t},t)),s.specialties.length>3&&e.jsxs(c,{variant:"default",size:"sm",children:["+",s.specialties.length-3]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-1",children:[e.jsxs("div",{className:"flex gap-3 text-xs text-stone-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"w-3.5 h-3.5 text-amber-400"})," ",s.rating]}),e.jsxs("span",{children:[s.review_count," reviews"]}),s.ehr_system&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"w-3 h-3"})," ",s.ehr_system]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[y&&(()=>{const t=W(s.id);return t==="linked"||t==="approved"?e.jsxs("span",{className:"flex items-center gap-1 text-xs text-green-600 font-medium px-2 py-1",children:[e.jsx(Ie,{className:"w-3.5 h-3.5"})," Joined"]}):t==="pending"?e.jsxs("span",{className:"flex items-center gap-1 text-xs text-amber-600 font-medium px-2 py-1",children:[e.jsx(Ee,{className:"w-3.5 h-3.5"})," Requested"]}):e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>j(s.id),children:[e.jsx(J,{className:"w-3.5 h-3.5"})," Request to Join"]})})(),E(s)&&e.jsxs(e.Fragment,{children:[e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>D(s),children:e.jsx(L,{className:"w-3.5 h-3.5"})}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>x(s),children:e.jsx(P,{className:"w-3.5 h-3.5 text-red-500"})})]}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>T(`/sites/${s.id}`),children:"Details"})]})]})]})},s.id))}):e.jsx("div",{className:"overflow-x-auto rounded-xl border border-stone-200",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-stone-50 border-b border-stone-200",children:[e.jsx("th",{className:"text-left px-4 py-3 font-medium text-stone-600",children:"Name"}),e.jsx("th",{className:"text-left px-4 py-3 font-medium text-stone-600",children:"Location"}),e.jsx("th",{className:"text-left px-4 py-3 font-medium text-stone-600",children:"Specialties"}),e.jsx("th",{className:"text-left px-4 py-3 font-medium text-stone-600",children:"Rating"}),e.jsx("th",{className:"text-left px-4 py-3 font-medium text-stone-600",children:"EHR"}),e.jsx("th",{className:"text-right px-4 py-3 font-medium text-stone-600",children:"Actions"})]})}),e.jsx("tbody",{children:m.map(s=>e.jsxs("tr",{className:"border-b border-stone-100 table-row-hover",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-stone-900",children:s.name}),s.is_verified&&e.jsx(c,{variant:"success",size:"sm",children:"Verified"})]})}),e.jsxs("td",{className:"px-4 py-3 text-stone-600",children:[s.city,", ",s.state]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.specialties.slice(0,2).map(t=>e.jsx(c,{variant:"default",size:"sm",children:t},t)),s.specialties.length>2&&e.jsxs(c,{variant:"default",size:"sm",children:["+",s.specialties.length-2]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"flex items-center gap-1 text-stone-600",children:[e.jsx(M,{className:"w-3.5 h-3.5 text-amber-400"})," ",s.rating]})}),e.jsx("td",{className:"px-4 py-3 text-stone-600",children:s.ehr_system||"—"}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[y&&(()=>{const t=W(s.id);return t==="linked"||t==="approved"?e.jsx("span",{className:"text-xs text-green-600 font-medium px-2",children:"Joined"}):t==="pending"?e.jsx("span",{className:"text-xs text-amber-600 font-medium px-2",children:"Requested"}):e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>j(s.id),children:[e.jsx(J,{className:"w-3.5 h-3.5"})," Join"]})})(),E(s)&&e.jsxs(e.Fragment,{children:[e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>D(s),children:e.jsx(L,{className:"w-3.5 h-3.5"})}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>x(s),children:e.jsx(P,{className:"w-3.5 h-3.5 text-red-500"})})]}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>T(`/sites/${s.id}`),children:"Details"})]})})]},s.id))})]})}),A>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(a,{variant:"outline",size:"sm",disabled:N<=1,onClick:()=>h(s=>s-1),children:e.jsx(Be,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm text-stone-600",children:["Page ",N," of ",A]}),e.jsx(a,{variant:"outline",size:"sm",disabled:N>=A,onClick:()=>h(s=>s+1),children:e.jsx(Ve,{className:"w-4 h-4"})})]}),i&&e.jsx(g,{isOpen:!0,onClose:()=>p(null),title:i.name,size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"Address"}),e.jsxs("p",{className:"text-sm font-semibold text-stone-900",children:[i.address,", ",i.city,", ",i.state," ",i.zip]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"Phone"}),e.jsxs("p",{className:"text-sm font-semibold text-stone-900 flex items-center gap-1",children:[e.jsx($e,{className:"w-3.5 h-3.5"})," ",i.phone]})]}),i.website&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"Website"}),e.jsxs("a",{href:i.website,target:"_blank",rel:"noopener noreferrer",className:"text-sm font-semibold text-primary-600 flex items-center gap-1 hover:underline",children:[e.jsx(Ge,{className:"w-3.5 h-3.5"})," ",i.website.replace(/^https?:\/\//,"")]})]}),i.ehr_system&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"EHR System"}),e.jsx("p",{className:"text-sm font-semibold text-stone-900",children:i.ehr_system})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"Rating"}),e.jsxs("p",{className:"text-sm font-semibold text-stone-900 flex items-center gap-1",children:[e.jsx(M,{className:"w-3.5 h-3.5 text-amber-400"})," ",i.rating," (",i.review_count," reviews)"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"Status"}),e.jsx(c,{variant:i.is_verified?"success":"warning",children:i.is_verified?"Verified":"Pending Verification"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"Description"}),e.jsx("p",{className:"text-sm text-stone-700",children:i.description})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500 mb-2",children:"Specialties"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:i.specialties.map(s=>e.jsx(c,{variant:"primary",size:"sm",children:s},s))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[E(i)&&e.jsxs(e.Fragment,{children:[e.jsxs(a,{variant:"outline",onClick:()=>{p(null),D(i)},children:[e.jsx(L,{className:"w-3.5 h-3.5 mr-1.5"})," Edit"]}),e.jsxs(a,{variant:"outline",onClick:()=>{p(null),x(i)},className:"text-red-600 border-red-200 hover:bg-red-50",children:[e.jsx(P,{className:"w-3.5 h-3.5 mr-1.5"})," Delete"]})]}),e.jsx(a,{variant:"outline",onClick:()=>p(null),children:"Close"})]})]})}),ce&&e.jsx(g,{isOpen:!0,onClose:()=>w(!1),title:"Add Site",size:"lg",children:e.jsxs("form",{onSubmit:fe,className:"space-y-6",children:[ee,e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(a,{variant:"outline",type:"button",onClick:()=>w(!1),children:"Cancel"}),e.jsx(a,{type:"submit",isLoading:Y.isPending,children:"Create Site"})]})]})}),_&&e.jsx(g,{isOpen:!0,onClose:()=>C(null),title:"Edit Site",size:"lg",children:e.jsxs("form",{onSubmit:ge,className:"space-y-6",children:[ee,e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(a,{variant:"outline",type:"button",onClick:()=>C(null),children:"Cancel"}),e.jsx(a,{type:"submit",isLoading:Z.isPending,children:"Save Changes"})]})]})}),u&&e.jsx(g,{isOpen:!0,onClose:()=>x(null),title:"Delete Site",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-stone-600",children:["Are you sure you want to delete ",e.jsx("strong",{children:u.name}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(a,{variant:"outline",onClick:()=>x(null),children:"Cancel"}),e.jsx(a,{onClick:ve,isLoading:oe,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})}),k&&e.jsx(g,{isOpen:!0,onClose:()=>{j(null),z("")},title:"Request to Join Site",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-stone-600",children:["Submit a request to join ",e.jsx("strong",{children:m.find(s=>s.id===k)?.name})," as a preceptor. The site manager will review your request."]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Message (optional)"}),e.jsx("textarea",{value:U,onChange:s=>z(s.target.value),placeholder:"Introduce yourself or explain why you'd like to join...",rows:3,className:"w-full rounded-xl border border-stone-300 px-4 py-2.5 text-sm bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none resize-none"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(a,{variant:"outline",onClick:()=>{j(null),z("")},children:"Cancel"}),e.jsxs(a,{onClick:he,isLoading:H.isPending,children:[e.jsx(J,{className:"w-4 h-4"})," Submit Request"]})]})]})})]})}export{ds as SitesDirectory};
