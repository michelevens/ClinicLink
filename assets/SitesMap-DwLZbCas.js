import{c as E,a as F,u as O,r as n,bb as D,j as e,d as P,X as w,B as S}from"./index-GzcG7CSS.js";import{u as V,M as R,T as _,a as B,P as W,L as U}from"./leaflet-aOLJjKD0.js";import{B as M}from"./Badge-9_pL70Ln.js";import{u as q}from"./usePageTitle-CSRQyC0a.js";import{F as H}from"./funnel-fE0ZCBlq.js";import{L as K}from"./list-NlTBPj9A.js";import{S as C}from"./star-CqpiQmYF.js";import{C as Y}from"./chevron-right-D8jrJqqK.js";import{M as k}from"./map-pin-B8WKBtoC.js";const G=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Z=E("layers",G);function X(){return V().map}const J={AL:[32.806671,-86.79113],AK:[61.370716,-152.404419],AZ:[33.729759,-111.431221],AR:[34.969704,-92.373123],CA:[36.116203,-119.681564],CO:[39.059811,-105.311104],CT:[41.597782,-72.755371],DE:[39.318523,-75.507141],FL:[27.766279,-81.686783],GA:[33.040619,-83.643074],HI:[21.094318,-157.498337],ID:[44.240459,-114.478828],IL:[40.349457,-88.986137],IN:[39.849426,-86.258278],IA:[42.011539,-93.210526],KS:[38.5266,-96.726486],KY:[37.66814,-84.670067],LA:[31.169546,-91.867805],ME:[44.693947,-69.381927],MD:[39.063946,-76.802101],MA:[42.230171,-71.530106],MI:[43.326618,-84.536095],MN:[45.694454,-93.900192],MS:[32.741646,-89.678696],MO:[38.456085,-92.288368],MT:[46.921925,-110.454353],NE:[41.12537,-98.268082],NV:[38.313515,-117.055374],NH:[43.452492,-71.563896],NJ:[40.298904,-74.521011],NM:[34.840515,-106.248482],NY:[42.165726,-74.948051],NC:[35.630066,-79.806419],ND:[47.528912,-99.784012],OH:[40.388783,-82.764915],OK:[35.565342,-96.928917],OR:[44.572021,-122.070938],PA:[40.590752,-77.209755],RI:[41.680893,-71.51178],SC:[33.856892,-80.945007],SD:[44.299782,-99.438828],TN:[35.747845,-86.692345],TX:[31.054487,-97.563461],UT:[40.150032,-111.862434],VT:[44.045876,-72.710686],VA:[37.769337,-78.169968],WA:[47.400902,-121.490494],WV:[38.491226,-80.954456],WI:[44.268543,-89.616508],WY:[42.755966,-107.30249],DC:[38.897438,-77.026817]};function Q(r,i){const a=i*137.508*(Math.PI/180),d=.15+i%5*.08;return[r[0]+d*Math.cos(a),r[1]+d*Math.sin(a)]}function ee(r,i){const a=i?32:24;return U.divIcon({className:"custom-marker",html:`<div style="
      width: ${a}px; height: ${a}px;
      background: ${r};
      border: 3px solid white;
      border-radius: 50%;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      transition: all 0.2s;
      ${i?"transform: scale(1.2);":""}
    "></div>`,iconSize:[a,a],iconAnchor:[a/2,a/2]})}function se({center:r,zoom:i}){const a=X();return n.useEffect(()=>{a.flyTo(r,i,{duration:.8})},[a,r,i]),null}const te=["Family Medicine","Internal Medicine","Pediatrics","Emergency Medicine","Surgery","OB/GYN","Psychiatry","Cardiology","Dermatology","Orthopedics"];function me(){q("Sites Map");const{user:r}=F(),i=O(),[a,d]=n.useState(""),[p,g]=n.useState(""),[h,j]=n.useState(""),[t,u]=n.useState(null),[f,A]=n.useState(!1),[x,L]=n.useState(!0),b=n.useRef(null),{data:I,isLoading:N}=D({search:a||void 0,specialty:h||void 0,state:p||void 0}),m=I?.data??[],o=n.useMemo(()=>{const s={};return m.map(l=>{const c=l.state?.toUpperCase(),v=J[c];if(!v)return{site:l,coords:null};const y=s[c]??0;return s[c]=y+1,{site:l,coords:Q(v,y)}}).filter(l=>l.coords!==null)},[m]),T=t?o.find(s=>s.site.id===t.id)?.coords??[39.8,-98.5]:[39.8,-98.5],$=t?8:4;n.useEffect(()=>{t&&b.current&&b.current.querySelector(`[data-site-id="${t.id}"]`)?.scrollIntoView({behavior:"smooth",block:"nearest"})},[t]);const z=n.useMemo(()=>[...new Set(m.map(l=>l.state?.toUpperCase()).filter(Boolean))].sort(),[m]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-stone-900",children:"Sites Map"}),e.jsxs("p",{className:"text-sm text-stone-500 mt-0.5",children:[o.length," clinical rotation sites"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-stone-400"}),e.jsx("input",{type:"text",placeholder:"Search sites...",value:a,onChange:s=>d(s.target.value),className:"pl-8 pr-3 py-2 text-sm rounded-xl border border-stone-200 bg-white focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-400 w-48"})]}),e.jsx("button",{onClick:()=>A(!f),className:`p-2 rounded-xl border transition-all ${f?"bg-primary-50 border-primary-200 text-primary-600":"border-stone-200 text-stone-500 hover:bg-stone-50"}`,title:"Filters",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>L(!x),className:`p-2 rounded-xl border transition-all ${x?"bg-primary-50 border-primary-200 text-primary-600":"border-stone-200 text-stone-500 hover:bg-stone-50"}`,title:"Toggle list",children:e.jsx(K,{className:"w-4 h-4"})})]})]}),f&&e.jsxs("div",{className:"flex flex-wrap gap-3 p-3 bg-white border border-stone-200 rounded-xl",children:[e.jsxs("select",{value:p,onChange:s=>g(s.target.value),className:"text-sm px-3 py-1.5 rounded-lg border border-stone-200 bg-white focus:outline-none focus:ring-2 focus:ring-primary-500/20",children:[e.jsx("option",{value:"",children:"All States"}),z.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:h,onChange:s=>j(s.target.value),className:"text-sm px-3 py-1.5 rounded-lg border border-stone-200 bg-white focus:outline-none focus:ring-2 focus:ring-primary-500/20",children:[e.jsx("option",{value:"",children:"All Specialties"}),te.map(s=>e.jsx("option",{value:s,children:s},s))]}),(p||h)&&e.jsxs("button",{onClick:()=>{g(""),j("")},className:"text-xs text-stone-500 hover:text-stone-700 flex items-center gap-1",children:[e.jsx(w,{className:"w-3 h-3"})," Clear"]})]}),e.jsxs("div",{className:"flex gap-4",style:{height:"calc(100vh - 220px)"},children:[e.jsxs("div",{className:`${x?"flex-1":"w-full"} rounded-2xl overflow-hidden border border-stone-200 shadow-sm relative`,children:[N?e.jsx("div",{className:"w-full h-full bg-stone-100 flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(Z,{className:"w-8 h-8 text-stone-300 animate-pulse"}),e.jsx("p",{className:"text-sm text-stone-400",children:"Loading map..."})]})}):e.jsxs(R,{center:[39.8,-98.5],zoom:4,style:{width:"100%",height:"100%"},scrollWheelZoom:!0,zoomControl:!1,children:[e.jsx(_,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(se,{center:T,zoom:$}),o.map(({site:s,coords:l})=>e.jsx(B,{position:l,icon:ee(s.is_verified?"#3b82f6":"#a8a29e",t?.id===s.id),eventHandlers:{click:()=>u(s)},children:e.jsx(W,{children:e.jsxs("div",{className:"min-w-[200px]",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[e.jsx(S,{className:"w-4 h-4 text-primary-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-stone-900 text-sm",children:s.name}),e.jsxs("p",{className:"text-xs text-stone-500",children:[s.city,", ",s.state]})]})]}),s.specialties?.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[s.specialties.slice(0,3).map(c=>e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-blue-50 text-blue-600 rounded-full",children:c},c)),s.specialties.length>3&&e.jsxs("span",{className:"text-[10px] text-stone-400",children:["+",s.specialties.length-3]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[s.rating>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"w-3 h-3 text-amber-400 fill-amber-400"}),e.jsx("span",{className:"text-xs font-medium",children:s.rating})]}),(r?.role==="coordinator"||r?.role==="admin")&&e.jsxs("button",{onClick:()=>i(`/sites/${s.id}`),className:"text-xs text-primary-600 hover:text-primary-700 font-medium flex items-center gap-0.5",children:["View ",e.jsx(Y,{className:"w-3 h-3"})]})]})]})})},s.id))]}),e.jsx("div",{className:"absolute bottom-4 left-4 bg-white/90 backdrop-blur-sm rounded-xl border border-stone-200 px-3 py-2 z-[1000]",children:e.jsxs("div",{className:"flex items-center gap-4 text-xs text-stone-600",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500 border-2 border-white shadow"}),"Verified"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-stone-400 border-2 border-white shadow"}),"Unverified"]})]})})]}),x&&e.jsxs("div",{className:"w-80 shrink-0 bg-white border border-stone-200 rounded-2xl flex flex-col overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b border-stone-100",children:e.jsxs("p",{className:"text-xs font-semibold text-stone-500 uppercase tracking-wide",children:["Sites (",o.length,")"]})}),e.jsxs("div",{ref:b,className:"flex-1 overflow-y-auto divide-y divide-stone-50",children:[o.length===0&&!N&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(k,{className:"w-8 h-8 text-stone-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-stone-400",children:"No sites found"})]}),o.map(({site:s})=>e.jsx("button",{"data-site-id":s.id,onClick:()=>u(t?.id===s.id?null:s),className:`w-full text-left px-4 py-3 transition-all hover:bg-stone-50 ${t?.id===s.id?"bg-primary-50 border-l-2 border-primary-500":""}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center shrink-0 ${s.is_verified?"bg-blue-50":"bg-stone-100"}`,children:e.jsx(S,{className:`w-4 h-4 ${s.is_verified?"text-blue-500":"text-stone-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-stone-900 truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-stone-500 flex items-center gap-1 mt-0.5",children:[e.jsx(k,{className:"w-3 h-3 shrink-0"}),s.city,", ",s.state]}),s.specialties?.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1.5",children:[s.specialties.slice(0,2).map(l=>e.jsx(M,{variant:"default",size:"sm",children:l},l)),s.specialties.length>2&&e.jsxs("span",{className:"text-[10px] text-stone-400 self-center",children:["+",s.specialties.length-2]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 shrink-0",children:[s.rating>0&&e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(C,{className:"w-3 h-3 text-amber-400 fill-amber-400"}),e.jsx("span",{className:"text-xs font-medium text-stone-700",children:s.rating})]}),s.is_verified&&e.jsx(M,{variant:"primary",size:"sm",children:"Verified"})]})]})},s.id))]}),t&&e.jsxs("div",{className:"border-t border-stone-200 p-4 bg-stone-50/50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-stone-900",children:t.name}),e.jsx("button",{onClick:()=>u(null),className:"p-1 rounded-lg text-stone-400 hover:text-stone-600",children:e.jsx(w,{className:"w-3.5 h-3.5"})})]}),e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:t.address}),e.jsxs("p",{className:"text-xs text-stone-500 mb-3",children:[t.city,", ",t.state," ",t.zip]}),t.phone&&e.jsx("p",{className:"text-xs text-stone-600 mb-1",children:t.phone}),t.specialties?.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:t.specialties.map(s=>e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-blue-50 text-blue-600 rounded-full font-medium",children:s},s))}),(r?.role==="coordinator"||r?.role==="admin")&&e.jsx("button",{onClick:()=>i(`/sites/${t.id}`),className:"w-full text-center text-xs font-medium text-primary-600 hover:text-primary-700 bg-primary-50 hover:bg-primary-100 py-2 rounded-lg transition-all",children:"View Site Details"})]})]})]})]})}export{me as SitesMap};
