import{a as L,aD as $,r as c,j as e,f as x,af as I,A as g,g as A,d as E,e as P,D as T,a4 as z,aE as F,aF as H,aG as B}from"./index-GzcG7CSS.js";import{C as N}from"./Card-FSc1waky.js";import{B as D}from"./Badge-9_pL70Ln.js";import{M as R}from"./Modal-CA0K5bCb.js";import{u as O}from"./usePageTitle-CSRQyC0a.js";import{C as y}from"./circle-check-big-B5eOtT2b.js";import{C as h}from"./circle-x-BhxGvoPR.js";import{H as U}from"./hash-Dj_bhZyC.js";import{U as V}from"./user-BvMymkx8.js";import{M as q}from"./map-pin-B8WKBtoC.js";import{S as G}from"./star-CqpiQmYF.js";import{E as X}from"./eye-DPEVXjN5.js";import{T as M}from"./triangle-alert-DWR7AhnE.js";import{D as Y}from"./download-COygb2Hf.js";function he(){O("Certificates");const{user:s}=L(),r=s?.role==="student",o=s?.role==="preceptor"||s?.role==="site_manager",d=s?.role==="admin"||s?.role==="coordinator",{data:a,isLoading:v}=$(),l=a?.certificates||[],[m,C]=c.useState(""),[u,n]=c.useState("all"),[_,k]=c.useState(null),[i,f]=c.useState(!1),[S,p]=c.useState(null),b=c.useMemo(()=>l.filter(t=>{if(u!=="all"&&t.status!==u)return!1;if(m){const j=m.toLowerCase();return t.title.toLowerCase().includes(j)||t.certificate_number.toLowerCase().includes(j)||(t.student?.first_name+" "+t.student?.last_name).toLowerCase().includes(j)||t.slot?.site?.name?.toLowerCase().includes(j)}return!0}),[l,m,u]),w=c.useMemo(()=>({total:l.length,issued:l.filter(t=>t.status==="issued").length,revoked:l.filter(t=>t.status==="revoked").length,totalHours:l.filter(t=>t.status==="issued").reduce((t,j)=>t+(parseFloat(String(j.total_hours))||0),0)}),[l]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-stone-900",children:r?"My Certificates":o?"Issued Certificates":"All Certificates"}),e.jsx("p",{className:"text-stone-500 mt-1",children:r?"Certificates earned from completed rotations":o?"Issue and manage rotation completion certificates":"View all certificates across the platform"})]}),o&&e.jsxs(x,{onClick:()=>f(!0),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Issue Certificate"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsx(N,{padding:"sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary-50 text-primary-500 flex items-center justify-center",children:e.jsx(g,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:w.total}),e.jsx("p",{className:"text-xs text-stone-500",children:"Total"})]})]})}),e.jsx(N,{padding:"sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-50 text-green-500 flex items-center justify-center",children:e.jsx(y,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:w.issued}),e.jsx("p",{className:"text-xs text-stone-500",children:"Active"})]})]})}),e.jsx(N,{padding:"sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-50 text-amber-500 flex items-center justify-center",children:e.jsx(A,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:Math.round(w.totalHours*10)/10}),e.jsx("p",{className:"text-xs text-stone-500",children:"Total Hours"})]})]})}),w.revoked>0&&e.jsx(N,{padding:"sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-50 text-red-500 flex items-center justify-center",children:e.jsx(h,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:w.revoked}),e.jsx("p",{className:"text-xs text-stone-500",children:"Revoked"})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(E,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-stone-400"}),e.jsx("input",{type:"text",placeholder:"Search certificates...",value:m,onChange:t=>C(t.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-xl border border-stone-300 bg-white text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"})]}),e.jsxs("select",{value:u,onChange:t=>n(t.target.value),className:"px-4 py-2.5 rounded-xl border border-stone-300 bg-white text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"issued",children:"Active"}),e.jsx("option",{value:"revoked",children:"Revoked"})]})]}),v?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"})}):b.length===0?e.jsx(N,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(g,{className:"w-12 h-12 text-stone-300 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-stone-900 mb-1",children:l.length===0?"No certificates yet":"No matching certificates"}),e.jsx("p",{className:"text-stone-500 text-sm",children:r?"Complete rotations and evaluations to earn certificates.":o?"Issue certificates to students who have completed their rotations.":"No certificates have been issued yet."})]})}):e.jsx("div",{className:"grid gap-4",children:b.map(t=>e.jsx(J,{certificate:t,isPreceptor:o,isAdmin:d,onView:()=>k(t),onRevoke:()=>p(t)},t.id))}),_&&e.jsx(K,{certificate:_,onClose:()=>k(null)}),i&&e.jsx(Q,{onClose:()=>f(!1)}),S&&e.jsx(W,{certificate:S,onClose:()=>p(null)})]})}function J({certificate:s,isPreceptor:r,isAdmin:o,onView:d,onRevoke:a}){return e.jsx(N,{hover:!0,children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-primary-100 to-secondary-100 text-primary-600 flex items-center justify-center shrink-0",children:e.jsx(g,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-stone-900 truncate",children:s.title}),e.jsx(D,{variant:s.status==="issued"?"success":"danger",size:"sm",children:s.status==="issued"?"Active":"Revoked"})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-sm text-stone-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-3.5 h-3.5"}),s.certificate_number]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-3.5 h-3.5"}),s.student?.first_name," ",s.student?.last_name]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"w-3.5 h-3.5"}),s.slot?.site?.name||"Unknown Site"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"w-3.5 h-3.5"}),new Date(s.issued_date).toLocaleDateString()]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"w-3.5 h-3.5"}),s.total_hours,"h"]}),s.overall_score&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-3.5 h-3.5"}),s.overall_score,"/5.0"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:d,children:[e.jsx(X,{className:"w-4 h-4 mr-1"})," View"]}),(r||o)&&s.status==="issued"&&e.jsxs(x,{variant:"outline",size:"sm",onClick:a,className:"text-red-600 border-red-200 hover:bg-red-50",children:[e.jsx(h,{className:"w-4 h-4 mr-1"})," Revoke"]})]})]})})}function K({certificate:s,onClose:r}){return e.jsx(R,{isOpen:!0,onClose:r,title:"Certificate Details",size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center py-6 bg-gradient-to-br from-primary-50 via-white to-secondary-50 rounded-xl border border-stone-200",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-primary-500 to-secondary-500 text-white flex items-center justify-center mx-auto mb-4",children:e.jsx(g,{className:"w-8 h-8"})}),e.jsx("h3",{className:"text-xl font-bold text-stone-900 mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-stone-500",children:"Certificate of Completion"}),e.jsx("div",{className:"mt-3",children:e.jsx(D,{variant:s.status==="issued"?"success":"danger",children:s.status==="issued"?"Active":"Revoked"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"Certificate Number"}),e.jsx("p",{className:"text-sm font-mono font-semibold text-stone-900",children:s.certificate_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"Issued Date"}),e.jsx("p",{className:"text-sm font-semibold text-stone-900",children:new Date(s.issued_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"Student"}),e.jsxs("p",{className:"text-sm font-semibold text-stone-900",children:[s.student?.first_name," ",s.student?.last_name]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"Issued By"}),e.jsxs("p",{className:"text-sm font-semibold text-stone-900",children:[s.issuer?.first_name," ",s.issuer?.last_name]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"Rotation Site"}),e.jsx("p",{className:"text-sm font-semibold text-stone-900",children:s.slot?.site?.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"Rotation"}),e.jsx("p",{className:"text-sm font-semibold text-stone-900",children:s.slot?.title})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"Total Approved Hours"}),e.jsxs("p",{className:"text-sm font-semibold text-stone-900",children:[s.total_hours," hours"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"Overall Score"}),e.jsx("p",{className:"text-sm font-semibold text-stone-900",children:s.overall_score?`${s.overall_score} / 5.0`:"N/A"})]})]}),s.status==="revoked"&&e.jsxs("div",{className:"p-4 bg-red-50 rounded-xl border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700 mb-1",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("p",{className:"text-sm font-semibold",children:"Certificate Revoked"})]}),e.jsxs("p",{className:"text-sm text-red-600",children:["Revoked on ",s.revoked_date?new Date(s.revoked_date).toLocaleDateString():"N/A",s.revocation_reason?` — ${s.revocation_reason}`:""]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[s.status==="issued"&&e.jsxs(x,{onClick:()=>window.open(T.getPdfUrl(s.id),"_blank"),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Download PDF"]}),e.jsx(x,{variant:"outline",onClick:r,children:"Close"})]})]})})}function Q({onClose:s}){const{data:r,isLoading:o}=z(),d=c.useMemo(()=>(r?.data||[]).filter(i=>i.status==="accepted"),[r]),[a,v]=c.useState(null),[l,m]=c.useState(""),C=F(),u=c.useMemo(()=>d.map(i=>({app:i,label:`${i.student?.first_name} ${i.student?.last_name} — ${i.slot?.title||"Rotation"}`})),[d]),{data:n,isLoading:_}=H(a?.slot_id||"",a?.student_id||""),k=async()=>{if(!(!a||!l.trim()))try{await C.mutateAsync({student_id:a.student_id,slot_id:a.slot_id,title:l.trim()}),s()}catch{}};return e.jsx(R,{isOpen:!0,onClose:s,title:"Issue Certificate",size:"lg",children:e.jsx("div",{className:"space-y-4",children:o?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"})}):d.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(g,{className:"w-12 h-12 text-stone-300 mx-auto mb-3"}),e.jsx("p",{className:"text-stone-500",children:"No accepted students to issue certificates for."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Student & Rotation *"}),e.jsxs("select",{value:a?`${a.student_id}|${a.slot_id}`:"",onChange:i=>{const[f,S]=i.target.value.split("|"),p=d.find(b=>b.student_id===f&&b.slot_id===S);v(p||null),p?.slot?.title&&m(`${p.slot.title} - Completion Certificate`)},className:"w-full rounded-xl border border-stone-300 bg-white px-4 py-2.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"",children:"Select student & rotation..."}),u.map(({app:i,label:f})=>e.jsx("option",{value:`${i.student_id}|${i.slot_id}`,children:f},`${i.student_id}|${i.slot_id}`))]})]}),a&&e.jsxs("div",{className:"space-y-3",children:[_?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-stone-500",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"}),"Checking eligibility..."]}):n?e.jsxs("div",{className:`p-4 rounded-xl border ${n.eligible?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[e.jsx("h4",{className:`text-sm font-semibold mb-2 ${n.eligible?"text-green-700":"text-amber-700"}`,children:n.eligible?"Eligible for Certificate":"Not Yet Eligible"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[n.has_application?e.jsx(y,{className:"w-4 h-4 text-green-500"}):e.jsx(h,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:"text-stone-600",children:"Accepted application"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[n.total_approved_hours>0?e.jsx(y,{className:"w-4 h-4 text-green-500"}):e.jsx(h,{className:"w-4 h-4 text-red-400"}),e.jsxs("span",{className:"text-stone-600",children:[n.total_approved_hours,"h approved"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[n.has_evaluation?e.jsx(y,{className:"w-4 h-4 text-green-500"}):e.jsx(h,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:"text-stone-600",children:"Evaluation submitted"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[n.has_certificate?e.jsx(h,{className:"w-4 h-4 text-red-400"}):e.jsx(y,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-stone-600",children:n.has_certificate?"Already issued":"No existing cert"})]})]}),n.pending_hours>0&&e.jsxs("p",{className:"mt-2 text-xs text-amber-600",children:["Note: ",n.pending_hours,"h pending review"]})]}):null,e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Certificate Title *"}),e.jsx("input",{type:"text",value:l,onChange:i=>m(i.target.value),placeholder:"e.g. Emergency Department NP Clinical - Completion Certificate",className:"w-full rounded-xl border border-stone-300 bg-white px-4 py-2.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx(x,{variant:"outline",onClick:s,children:"Cancel"}),e.jsxs(x,{onClick:k,disabled:!a||!l.trim()||!n?.eligible,isLoading:C.isPending,children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),"Issue Certificate"]})]})]})})})}function W({certificate:s,onClose:r}){const[o,d]=c.useState(""),a=B(),v=async()=>{if(o.trim())try{await a.mutateAsync({id:s.id,data:{reason:o.trim()}}),r()}catch{}};return e.jsx(R,{isOpen:!0,onClose:r,title:"Revoke Certificate",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-red-50 rounded-xl border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700 mb-2",children:[e.jsx(M,{className:"w-5 h-5"}),e.jsx("p",{className:"font-semibold",children:"This action cannot be undone"})]}),e.jsxs("p",{className:"text-sm text-red-600",children:["Revoking certificate ",e.jsx("strong",{children:s.certificate_number})," for"," ",e.jsxs("strong",{children:[s.student?.first_name," ",s.student?.last_name]}),"."]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Reason for Revocation *"}),e.jsx("textarea",{value:o,onChange:l=>d(l.target.value),rows:3,placeholder:"Provide the reason for revoking this certificate...",className:"w-full rounded-xl border border-stone-300 bg-white px-4 py-2.5 text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none resize-none"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(x,{variant:"outline",onClick:r,children:"Cancel"}),e.jsxs(x,{variant:"danger",onClick:v,disabled:!o.trim(),isLoading:a.isPending,children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Revoke Certificate"]})]})]})})}export{he as Certificates};
