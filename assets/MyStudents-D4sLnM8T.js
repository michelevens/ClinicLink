import{c as M,r as c,j as e,n as C,f,w as R,a as A,u as $,b1 as z,U as B,g as w,d as I,i as E,G as F}from"./index-GzcG7CSS.js";import{C as j}from"./Card-FSc1waky.js";import{G as L}from"./GradientAvatar-AwIYZPqW.js";import{B as k}from"./Badge-9_pL70Ln.js";import{E as U}from"./EmptyState-A3BIGBYI.js";import{M as H}from"./Modal-CA0K5bCb.js";import{D as P}from"./download-COygb2Hf.js";import{U as b}from"./upload-DVvKjw19.js";import{C as D}from"./circle-check-big-B5eOtT2b.js";import{T as V}from"./triangle-alert-DWR7AhnE.js";import{C as T}from"./circle-x-BhxGvoPR.js";import{u as q}from"./usePageTitle-CSRQyC0a.js";import{C as G}from"./chevron-right-D8jrJqqK.js";const O=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],S=M("file-spreadsheet",O);function K({open:t,onClose:x,programId:d,onSuccess:p}){const[i,l]=c.useState(null),[o,g]=c.useState(!1),[r,h]=c.useState(null),u=c.useRef(null),N=async()=>{if(i){g(!0),h(null);try{const a=new FormData;a.append("file",i),d&&a.append("program_id",d);const m=localStorage.getItem("cliniclink_token"),s=await fetch(`${C}/students/bulk-import`,{method:"POST",headers:{Accept:"application/json",...m?{Authorization:`Bearer ${m}`}:{}},body:a});if(!s.ok){const _=await s.json().catch(()=>({}));throw new Error(_.message||`Upload failed (${s.status})`)}const n=await s.json();h(n),n.summary.created>0&&p?.()}catch(a){h({summary:{created:0,skipped:0,errors:1},created:[],skipped:[],errors:[{row:0,email:"",error:a.message}]})}finally{g(!1)}}},v=()=>{l(null),h(null),x()},y=`${C}/students/import-template`;return e.jsx(H,{isOpen:t,onClose:v,title:"Import Students from CSV",children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-primary-50 rounded-xl border border-primary-200",children:[e.jsx(S,{className:"w-5 h-5 text-primary-600 shrink-0"}),e.jsx("div",{className:"flex-1 text-sm text-stone-700",children:"Download the CSV template, fill in student details, then upload it here."}),e.jsxs("a",{href:y,download:!0,className:"text-sm font-medium text-primary-600 hover:text-primary-700 whitespace-nowrap",children:[e.jsx(P,{className:"w-4 h-4 inline mr-1"}),"Template"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"CSV File"}),e.jsxs("div",{className:"border-2 border-dashed border-stone-300 rounded-xl p-6 text-center hover:border-primary-400 transition-colors cursor-pointer",onClick:()=>u.current?.click(),children:[e.jsx("input",{ref:u,type:"file",accept:".csv",className:"hidden",onChange:a=>{l(a.target.files?.[0]||null),h(null)}}),i?e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-stone-700",children:[e.jsx(S,{className:"w-5 h-5 text-primary-500"}),e.jsx("span",{className:"font-medium",children:i.name}),e.jsxs("span",{className:"text-stone-400",children:["(",(i.size/1024).toFixed(1)," KB)"]})]}):e.jsxs("div",{className:"text-stone-400",children:[e.jsx(b,{className:"w-8 h-8 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"Click to select a CSV file"}),e.jsx("p",{className:"text-xs mt-1",children:"Max 2MB, .csv format"})]})]})]}),r&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[r.summary.created>0&&e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-green-50 text-green-700 rounded-lg text-sm font-medium",children:[e.jsx(D,{className:"w-4 h-4"})," ",r.summary.created," created"]}),r.summary.skipped>0&&e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-amber-50 text-amber-700 rounded-lg text-sm font-medium",children:[e.jsx(V,{className:"w-4 h-4"})," ",r.summary.skipped," skipped"]}),r.summary.errors>0&&e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-red-50 text-red-700 rounded-lg text-sm font-medium",children:[e.jsx(T,{className:"w-4 h-4"})," ",r.summary.errors," errors"]})]}),(r.created.length>0||r.skipped.length>0||r.errors.length>0)&&e.jsx("div",{className:"max-h-48 overflow-y-auto border border-stone-200 rounded-xl",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-stone-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-medium text-stone-500",children:"Row"}),e.jsx("th",{className:"text-left p-2 font-medium text-stone-500",children:"Email"}),e.jsx("th",{className:"text-left p-2 font-medium text-stone-500",children:"Status"}),e.jsx("th",{className:"text-left p-2 font-medium text-stone-500",children:"Detail"})]})}),e.jsxs("tbody",{children:[r.created.map(a=>e.jsxs("tr",{className:"border-t border-stone-100",children:[e.jsx("td",{className:"p-2",children:a.row}),e.jsx("td",{className:"p-2",children:a.email}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:"text-green-600 font-medium",children:"Created"})}),e.jsx("td",{className:"p-2 text-stone-500",children:a.name})]},`c-${a.row}`)),r.skipped.map(a=>e.jsxs("tr",{className:"border-t border-stone-100",children:[e.jsx("td",{className:"p-2",children:a.row}),e.jsx("td",{className:"p-2",children:a.email}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:"text-amber-600 font-medium",children:"Skipped"})}),e.jsx("td",{className:"p-2 text-stone-500",children:a.reason})]},`s-${a.row}`)),r.errors.map((a,m)=>e.jsxs("tr",{className:"border-t border-stone-100",children:[e.jsx("td",{className:"p-2",children:a.row||"-"}),e.jsx("td",{className:"p-2",children:a.email||"-"}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:"text-red-600 font-medium",children:"Error"})}),e.jsx("td",{className:"p-2 text-stone-500",children:a.error})]},`e-${m}`))]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(f,{variant:"secondary",onClick:v,children:r?"Close":"Cancel"}),!r&&e.jsx(f,{onClick:N,disabled:!i||o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 animate-spin"})," Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-4 h-4"})," Import Students"]})})]})]})})}function oe(){q("My Students");const{user:t}=A(),x=$(),d=t?.role==="preceptor"||t?.role==="site_manager",{data:p,isLoading:i}=z(),l=p?.students||[],[o,g]=c.useState(""),[r,h]=c.useState("all"),[u,N]=c.useState(!1),v=t?.role==="coordinator"||t?.role==="admin",y=c.useMemo(()=>{const s=new Set(l.map(n=>n.program).filter(Boolean));return Array.from(s)},[l]),a=c.useMemo(()=>l.filter(s=>{if(r!=="all"&&s.program!==r)return!1;if(o){const n=o.toLowerCase();return(s.first_name+" "+s.last_name).toLowerCase().includes(n)||s.email.toLowerCase().includes(n)||s.university?.toLowerCase().includes(n)||s.program?.toLowerCase().includes(n)}return!0}),[l,o,r]),m=c.useMemo(()=>({total:l.length,avgHours:l.length>0?Math.round(l.reduce((s,n)=>s+(n.total_hours??n.prior_hours+n.hours_completed),0)/l.length):0,pendingReviews:l.reduce((s,n)=>s+n.pending_hours,0)}),[l]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-stone-900",children:"My Students"}),e.jsx("p",{className:"text-stone-500 mt-1",children:d?"Students assigned to your rotations":"All students in the system"})]}),v&&e.jsxs(f,{onClick:()=>N(!0),children:[e.jsx(b,{className:"w-4 h-4 mr-1.5"}),"Import Students"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:[e.jsx(j,{padding:"sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary-50 text-primary-500 flex items-center justify-center",children:e.jsx(B,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:m.total}),e.jsx("p",{className:"text-xs text-stone-500",children:"Students"})]})]})}),e.jsx(j,{padding:"sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-50 text-green-500 flex items-center justify-center",children:e.jsx(w,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:m.avgHours}),e.jsx("p",{className:"text-xs text-stone-500",children:"Avg Hours"})]})]})}),d&&m.pendingReviews>0&&e.jsx(j,{padding:"sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-50 text-amber-500 flex items-center justify-center",children:e.jsx(w,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:m.pendingReviews}),e.jsx("p",{className:"text-xs text-stone-500",children:"Pending Hrs"})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(I,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-stone-400"}),e.jsx("input",{type:"text",placeholder:"Search students...",value:o,onChange:s=>g(s.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-xl border border-stone-300 bg-white text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"})]}),y.length>1&&e.jsxs("select",{value:r,onChange:s=>h(s.target.value),className:"px-4 py-2.5 rounded-xl border border-stone-300 bg-white text-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none",children:[e.jsx("option",{value:"all",children:"All Programs"}),y.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),i?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"})}):a.length===0?e.jsx(j,{children:e.jsx(U,{illustration:"users",title:l.length===0?"No students yet":"No matching students",description:d?"Students will appear here once they are accepted into your rotations.":"No students found matching your criteria."})}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:a.map(s=>e.jsx(W,{student:s,isPreceptor:d,onView:()=>x(`/students/${s.id}`),onReviewHours:()=>x("/hours"),onWriteEval:()=>x("/evaluations")},s.id))}),u&&e.jsx(K,{open:u,onClose:()=>N(!1)})]})}function W({student:t,isPreceptor:x,onView:d,onReviewHours:p,onWriteEval:i}){const l=t.total_hours??t.prior_hours+t.hours_completed,o=t.hours_required>0?Math.min(100,Math.round(l/t.hours_required*100)):0;return e.jsx(j,{hover:!0,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{name:`${t.first_name} ${t.last_name}`,size:"md"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-stone-900",children:[t.first_name," ",t.last_name]}),e.jsx("p",{className:"text-xs text-stone-500",children:t.email})]})]}),e.jsx("button",{onClick:d,className:"p-1.5 rounded-lg hover:bg-stone-100 text-stone-400 transition-colors",children:e.jsx(G,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.degree_type&&e.jsx(k,{variant:"primary",size:"sm",children:t.degree_type}),t.university&&e.jsx(k,{variant:"default",size:"sm",children:t.university})]}),t.program&&e.jsxs("p",{className:"text-xs text-stone-500 flex items-center gap-1",children:[e.jsx(E,{className:"w-3.5 h-3.5"}),t.program]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-stone-500",children:"Clinical Hours"}),e.jsxs("span",{className:"font-semibold text-stone-700",children:[l," / ",t.hours_required,"h"]})]}),e.jsx("div",{className:"w-full h-2 bg-stone-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-primary-500 to-secondary-500 transition-all duration-500",style:{width:`${o}%`}})}),e.jsxs("div",{className:"flex items-center justify-between text-xs mt-1",children:[e.jsxs("span",{className:"text-stone-400",children:[o,"%"]}),t.pending_hours>0&&e.jsxs("span",{className:"text-amber-500 font-medium",children:[t.pending_hours,"h pending"]})]})]}),x&&e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:p,className:"flex-1",children:[e.jsx(w,{className:"w-3.5 h-3.5 mr-1"})," Review Hours"]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:i,className:"flex-1",children:[e.jsx(F,{className:"w-3.5 h-3.5 mr-1"})," Evaluate"]})]})]})})}export{oe as MyStudents};
