import{a as y,r as i,cy as D,cz as S,j as e,cA as P,af as R,w as N,cB as v,T,cC as A,X as w,cD as I}from"./index-GzcG7CSS.js";import{E as G}from"./EmptyState-A3BIGBYI.js";import{u as E}from"./usePageTitle-CSRQyC0a.js";import{E as F}from"./eye-DPEVXjN5.js";import{D as _}from"./download-COygb2Hf.js";const k=[{value:"annual_summary",label:"Annual Summary"},{value:"program_review",label:"Program Review"},{value:"site_evaluation",label:"Site Evaluation"},{value:"student_outcomes",label:"Student Outcomes"},{value:"clinical_hours",label:"Clinical Hours"}];function j(n){return k.find(r=>r.value===n)?.label||n}function L(n){return n==="completed"?"bg-green-100 text-green-700":n==="generating"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}function H(){E("Accreditation Reports");const{user:n}=y(),[r,d]=i.useState(1),[c,l]=i.useState(!1),[u,p]=i.useState(null),[s,x]=i.useState(null),{data:o,isLoading:b}=D({page:r}),m=o?.data||[],h=o?.last_page||1,f=S(),g=async t=>{await f.mutateAsync(t),p(null)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-primary-500 to-secondary-500 flex items-center justify-center",children:e.jsx(P,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-stone-900 to-stone-600 bg-clip-text text-transparent",children:"Accreditation Reports"}),e.jsx("p",{className:"text-sm text-stone-500",children:"Generate compliance reports for accrediting bodies"})]})]}),e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-primary-600 text-white rounded-xl text-sm font-medium hover:bg-primary-700 transition-colors",children:[e.jsx(R,{className:"w-4 h-4"}),"Generate Report"]})]}),e.jsx("div",{className:"bg-white border border-stone-200 rounded-xl overflow-hidden",children:b?e.jsx("div",{className:"p-12 text-center",children:e.jsx(N,{className:"w-6 h-6 animate-spin text-stone-400 mx-auto"})}):m.length===0?e.jsx(G,{illustration:"chart",title:"No reports generated yet",description:"Click 'Generate Report' to create your first accreditation report for compliance tracking."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-stone-100 bg-stone-50",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-stone-500",children:"Title"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-stone-500",children:"Type"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-stone-500",children:"Date Range"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-stone-500",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-stone-500",children:"Generated"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-stone-500",children:"Actions"})]})}),e.jsx("tbody",{children:m.map(t=>e.jsxs("tr",{className:"border-b border-stone-50 table-row-hover",children:[e.jsx("td",{className:"py-3 px-4 font-medium text-stone-900",children:t.title}),e.jsx("td",{className:"py-3 px-4 text-stone-600",children:j(t.report_type)}),e.jsx("td",{className:"py-3 px-4 text-stone-500 text-xs",children:t.parameters.date_from&&t.parameters.date_to?`${t.parameters.date_from} — ${t.parameters.date_to}`:"—"}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium capitalize ${L(t.status)}`,children:t.status})}),e.jsx("td",{className:"py-3 px-4 text-stone-500 text-xs",children:t.generated_at?new Date(t.generated_at).toLocaleDateString():"—"}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[t.status==="completed"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>x(t.id),className:"p-1.5 rounded-lg text-stone-400 hover:text-secondary-600 hover:bg-secondary-50 transition-colors",title:"Preview Data",children:e.jsx(F,{className:"w-4 h-4"})}),e.jsx("a",{href:v.downloadUrl(t.id),target:"_blank",rel:"noreferrer",className:"p-1.5 rounded-lg text-stone-400 hover:text-primary-600 hover:bg-primary-50 transition-colors",title:"Download PDF",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:()=>p(t.id),className:"p-1.5 rounded-lg text-stone-400 hover:text-red-600 hover:bg-red-50 transition-colors",title:"Delete",children:e.jsx(T,{className:"w-4 h-4"})})]})})]},t.id))})]})})}),h>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{disabled:r<=1,onClick:()=>d(t=>t-1),className:"px-4 py-2 text-sm border border-stone-200 rounded-xl hover:bg-stone-50 disabled:opacity-40 transition-colors",children:"Previous"}),e.jsxs("span",{className:"text-sm text-stone-500",children:["Page ",r," of ",h]}),e.jsx("button",{disabled:r>=h,onClick:()=>d(t=>t+1),className:"px-4 py-2 text-sm border border-stone-200 rounded-xl hover:bg-stone-50 disabled:opacity-40 transition-colors",children:"Next"})]}),c&&e.jsx(z,{onClose:()=>l(!1)}),s&&e.jsx(O,{reportId:s,onClose:()=>x(null)}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm p-6",children:[e.jsx("h3",{className:"font-semibold text-stone-900 mb-2",children:"Delete Report?"}),e.jsx("p",{className:"text-sm text-stone-500 mb-4",children:"This action cannot be undone. The report file will be permanently deleted."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>p(null),className:"flex-1 px-4 py-2.5 border border-stone-200 rounded-xl text-sm font-medium text-stone-600 hover:bg-stone-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>g(u),disabled:f.isPending,className:"flex-1 px-4 py-2.5 bg-red-600 text-white rounded-xl text-sm font-medium hover:bg-red-700 transition-colors disabled:opacity-50",children:f.isPending?"Deleting...":"Delete"})]})]})})]})}function z({onClose:n}){const{user:r}=y(),d=A(),[c,l]=i.useState("annual_summary"),[u,p]=i.useState(""),[s,x]=i.useState(""),[o,b]=i.useState(""),[m]=i.useState(r?.universityId||""),[h,f]=i.useState(""),[g,t]=i.useState(""),C=async()=>{!s||!o||!m||(await d.mutateAsync({report_type:c,title:u||`${j(c)} — ${s}`,university_id:m,date_from:s,date_to:o,...h?{program_id:h}:{},...g?{site_id:g}:{}}),n())};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-stone-100",children:[e.jsx("h2",{className:"font-semibold text-stone-900",children:"Generate Report"}),e.jsx("button",{onClick:n,className:"p-1.5 rounded-lg text-stone-400 hover:text-stone-600 hover:bg-stone-100 transition-colors",children:e.jsx(w,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Report Type"}),e.jsx("select",{value:c,onChange:a=>l(a.target.value),className:"w-full px-3 py-2 border border-stone-200 rounded-xl text-sm bg-white focus:outline-none focus:ring-2 focus:ring-primary-500",children:k.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Title (optional)"}),e.jsx("input",{value:u,onChange:a=>p(a.target.value),placeholder:"Auto-generated if empty",className:"w-full px-3 py-2 border border-stone-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"From *"}),e.jsx("input",{type:"date",value:s,onChange:a=>x(a.target.value),className:"w-full px-3 py-2 border border-stone-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"To *"}),e.jsx("input",{type:"date",value:o,onChange:a=>b(a.target.value),className:"w-full px-3 py-2 border border-stone-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-500"})]})]}),!m&&e.jsx("p",{className:"text-xs text-amber-600 bg-amber-50 rounded-lg px-3 py-2",children:"Your account is not linked to a university. Contact an admin to set up your profile."}),c==="program_review"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Program ID (optional)"}),e.jsx("input",{value:h,onChange:a=>f(a.target.value),className:"w-full px-3 py-2 border border-stone-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),c==="site_evaluation"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Site ID (optional)"}),e.jsx("input",{value:g,onChange:a=>t(a.target.value),className:"w-full px-3 py-2 border border-stone-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-500"})]})]}),e.jsxs("div",{className:"flex gap-3 p-5 border-t border-stone-100",children:[e.jsx("button",{onClick:n,className:"flex-1 px-4 py-2.5 border border-stone-200 rounded-xl text-sm font-medium text-stone-600 hover:bg-stone-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:C,disabled:d.isPending||!m||!s||!o,className:"flex-1 px-4 py-2.5 bg-primary-600 text-white rounded-xl text-sm font-medium hover:bg-primary-700 transition-colors disabled:opacity-50",children:d.isPending?"Generating...":"Generate PDF"})]})]})})}function O({reportId:n,onClose:r}){const{data:d,isLoading:c}=I(n),l=d?.report,u=d?.data;return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-stone-100",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-stone-900",children:l?.title||"Report Preview"}),l&&e.jsxs("p",{className:"text-xs text-stone-500 mt-0.5",children:[j(l.report_type)," — Generated ",l.generated_at?new Date(l.generated_at).toLocaleDateString():"—"]})]}),e.jsx("button",{onClick:r,className:"p-1.5 rounded-lg text-stone-400 hover:text-stone-600 hover:bg-stone-100 transition-colors",children:e.jsx(w,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:c?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(N,{className:"w-6 h-6 animate-spin text-stone-400"})}):u?e.jsx("div",{className:"space-y-4",children:Object.entries(u).map(([p,s])=>e.jsxs("div",{className:"bg-stone-50 rounded-xl p-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-stone-500 uppercase tracking-wider mb-2",children:p.replace(/_/g," ")}),typeof s=="object"&&s!==null?Array.isArray(s)?e.jsxs("div",{className:"space-y-1",children:[s.slice(0,20).map((x,o)=>e.jsx("div",{className:"text-sm text-stone-700 bg-white rounded-lg px-3 py-2 border border-stone-100",children:Object.entries(x).map(([b,m])=>e.jsxs("span",{className:"mr-4",children:[e.jsxs("span",{className:"text-stone-400 text-xs",children:[b.replace(/_/g," "),":"]})," ",e.jsx("span",{className:"font-medium",children:String(m)})]},b))},o)),s.length>20&&e.jsxs("p",{className:"text-xs text-stone-400 italic",children:["...and ",s.length-20," more"]})]}):e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(s).map(([x,o])=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"text-stone-400 text-xs",children:[x.replace(/_/g," "),":"]})," ",e.jsx("span",{className:"font-medium text-stone-700",children:String(o)})]},x))}):e.jsx("p",{className:"text-2xl font-bold text-stone-900",children:String(s)})]},p))}):e.jsx("p",{className:"text-center text-stone-400 py-8",children:"No preview data available."})}),e.jsxs("div",{className:"flex justify-end gap-2 p-5 border-t border-stone-100",children:[l?.status==="completed"&&e.jsxs("a",{href:v.downloadUrl(n),target:"_blank",rel:"noreferrer",className:"flex items-center gap-2 px-4 py-2.5 bg-primary-600 text-white rounded-xl text-sm font-medium hover:bg-primary-700 transition-colors",children:[e.jsx(_,{className:"w-4 h-4"})," Download PDF"]}),e.jsx("button",{onClick:r,className:"px-4 py-2.5 border border-stone-200 rounded-xl text-sm font-medium text-stone-600 hover:bg-stone-50 transition-colors",children:"Close"})]})]})})}export{H as AccreditationReports};
