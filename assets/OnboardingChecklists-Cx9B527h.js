import{c as U,a as le,r as p,j as e,bk as oe,bl as ce,a8 as de,bm as me,bn as xe,bo as pe,af as M,T as V,w as P,f as y,B as H,bp as J,bq as he,br as ue,as as K,bs as Q,a4 as fe,bt as je,bu as ge,bv as be,t as x}from"./index-GzcG7CSS.js";import{C as F}from"./Card-FSc1waky.js";import{I as G}from"./Input-B5MQDJHu.js";import{B as k}from"./Badge-9_pL70Ln.js";import{M as I}from"./Modal-CA0K5bCb.js";import{u as Ne}from"./usePageTitle-CSRQyC0a.js";import{U as ve}from"./user-BvMymkx8.js";import{G as ye}from"./grip-vertical-DIjb3W0q.js";import{C as W}from"./chevron-up-B1BLTNfs.js";import{S as O}from"./shield-B4OQBYN4.js";import{C as X}from"./circle-check-big-B5eOtT2b.js";import{P as Y}from"./paperclip-CDP-dEKu.js";import{D as Z}from"./download-COygb2Hf.js";import{U as we}from"./upload-DVvKjw19.js";const _e=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ee=U("circle",_e);const Ce=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],L=U("inbox",Ce);const Te=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],ke=U("pen-line",Te);function Ae(){const{data:w,isLoading:_}=ce(),{data:f}=de(),j=me(),A=xe(),C=pe(),[S,b]=p.useState(!1),[g,N]=p.useState(null),[r,m]=p.useState(null),l=w?.templates??[],h=f?.sites??[],[a,n]=p.useState(""),[o,u]=p.useState(""),[t,T]=p.useState(""),[q,i]=p.useState(!0),[c,D]=p.useState([{title:"",description:"",is_required:!0}]);function se(){n(h[0]?.id||""),u(""),T(""),i(!0),D([{title:"",description:"",is_required:!0}])}function E(){se(),h.length>0&&n(h[0].id),b(!0)}function te(s){n(s.site_id),u(s.name),T(s.description||""),i(s.is_active),D(s.items?.map(d=>({title:d.title,description:d.description||"",is_required:d.is_required}))||[{title:"",description:"",is_required:!0}]),N(s)}function ie(){D([...c,{title:"",description:"",is_required:!0}])}function ae(s){c.length<=1||D(c.filter((d,v)=>v!==s))}function z(s,d,v){D(c.map((R,re)=>re===s?{...R,[d]:v}:R))}async function $(){const s=c.filter(d=>d.title.trim());if(!o.trim()||s.length===0){x.error("Please provide a template name and at least one item");return}try{g?(await A.mutateAsync({id:g.id,data:{name:o,description:t||void 0,is_active:q,items:s}}),x.success("Template updated"),N(null)):(await j.mutateAsync({site_id:a,name:o,description:t||void 0,is_active:q,items:s}),x.success("Template created"),b(!1))}catch{x.error("Failed to save template")}}async function ne(){if(r)try{await C.mutateAsync(r.id),x.success("Template deleted"),m(null)}catch{x.error("Failed to delete template")}}const B=e.jsxs("div",{className:"space-y-4",children:[!g&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Site"}),e.jsx("select",{value:a,onChange:s=>n(s.target.value),className:"w-full rounded-xl border border-stone-300 px-3 py-2.5 text-sm focus:border-primary-500 focus:ring-1 focus:ring-primary-500",children:h.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]}),e.jsx(G,{label:"Template Name",value:o,onChange:s=>u(s.target.value),placeholder:"e.g., Main Campus Onboarding"}),e.jsx(G,{label:"Description (optional)",value:t,onChange:s=>T(s.target.value),placeholder:"Brief description of this checklist"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:q,onChange:s=>i(s.target.checked),className:"rounded border-stone-300"}),e.jsx("span",{className:"font-medium text-stone-700",children:"Active"}),e.jsx("span",{className:"text-stone-500",children:"(will be used for new accepted applications)"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-700",children:"Checklist Items"}),e.jsxs("button",{onClick:ie,className:"text-xs text-primary-600 hover:text-primary-700 font-medium flex items-center gap-1",children:[e.jsx(M,{className:"w-3.5 h-3.5"})," Add Item"]})]}),e.jsx("div",{className:"space-y-3",children:c.map((s,d)=>e.jsxs("div",{className:"flex gap-2 items-start bg-stone-50 rounded-xl p-3 border border-stone-200",children:[e.jsx(ye,{className:"w-4 h-4 text-stone-400 mt-2.5 shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("input",{value:s.title,onChange:v=>z(d,"title",v.target.value),placeholder:`Item ${d+1} title (e.g., Complete HIPAA Training)`,className:"w-full rounded-lg border border-stone-300 px-3 py-2 text-sm focus:border-primary-500 focus:ring-1 focus:ring-primary-500"}),e.jsx("input",{value:s.description,onChange:v=>z(d,"description",v.target.value),placeholder:"Optional description or instructions",className:"w-full rounded-lg border border-stone-300 px-3 py-1.5 text-xs text-stone-600 focus:border-primary-500 focus:ring-1 focus:ring-primary-500"}),e.jsxs("label",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("input",{type:"checkbox",checked:s.is_required,onChange:v=>z(d,"is_required",v.target.checked),className:"rounded border-stone-300"}),e.jsx("span",{className:"text-stone-600",children:"Required"})]})]}),e.jsx("button",{onClick:()=>ae(d),className:"p-1 text-stone-400 hover:text-red-500 mt-2",disabled:c.length<=1,children:e.jsx(V,{className:"w-4 h-4"})})]},d))})]})]});return _?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(P,{className:"w-6 h-6 animate-spin text-primary-500"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-stone-500",children:[l.length," template",l.length!==1?"s":""]}),e.jsxs(y,{onClick:E,size:"sm",children:[e.jsx(M,{className:"w-4 h-4 mr-1"})," New Template"]})]}),l.length===0?e.jsx(F,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(L,{className:"w-12 h-12 text-stone-300 mx-auto mb-3"}),e.jsx("h3",{className:"font-semibold text-stone-900 mb-1",children:"No onboarding templates"}),e.jsx("p",{className:"text-sm text-stone-500 mb-4",children:"Create a checklist template for your site"}),e.jsxs(y,{onClick:E,size:"sm",children:[e.jsx(M,{className:"w-4 h-4 mr-1"})," Create Template"]})]})}):l.map(s=>e.jsx(F,{hover:!0,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-stone-900",children:s.name}),s.is_active?e.jsx(k,{variant:"success",size:"sm",children:"Active"}):e.jsx(k,{size:"sm",children:"Inactive"})]}),s.site&&e.jsxs("p",{className:"text-xs text-stone-500 flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"})," ",s.site.name]}),s.description&&e.jsx("p",{className:"text-sm text-stone-600 mt-1",children:s.description}),e.jsxs("p",{className:"text-xs text-stone-400 mt-2",children:[s.items?.length||0," items (",s.items?.filter(d=>d.is_required).length||0," required)"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>te(s),className:"p-2 text-stone-400 hover:text-primary-600 rounded-lg hover:bg-primary-50",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>m(s),className:"p-2 text-stone-400 hover:text-red-500 rounded-lg hover:bg-red-50",children:e.jsx(V,{className:"w-4 h-4"})})]})]})},s.id)),e.jsxs(I,{isOpen:S,onClose:()=>b(!1),title:"Create Onboarding Template",size:"lg",children:[B,e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(y,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(y,{onClick:$,isLoading:j.isPending,children:"Create Template"})]})]}),e.jsxs(I,{isOpen:!!g,onClose:()=>N(null),title:"Edit Onboarding Template",size:"lg",children:[B,e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(y,{variant:"outline",onClick:()=>N(null),children:"Cancel"}),e.jsx(y,{onClick:$,isLoading:A.isPending,children:"Save Changes"})]})]}),e.jsxs(I,{isOpen:!!r,onClose:()=>m(null),title:"Delete Template",size:"sm",children:[e.jsxs("p",{className:"text-sm text-stone-600",children:["Are you sure you want to delete ",e.jsx("strong",{children:r?.name}),"? This will not affect existing student onboarding tasks."]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(y,{variant:"outline",onClick:()=>m(null),children:"Cancel"}),e.jsx(y,{variant:"danger",onClick:ne,isLoading:C.isPending,children:"Delete"})]})]})]})}function Se(){const{data:w,isLoading:_}=J(),f=he(),j=ue(),[A,C]=p.useState(null),S=w?.tasks??[],b=p.useMemo(()=>{const r={};for(const m of S){const l=m.application_id;r[l]||(r[l]={application:m.application,tasks:[]}),r[l].tasks.push(m)}return Object.entries(r)},[S]);async function g(r){try{await f.mutateAsync({id:r,data:{}}),x.success("Task verified")}catch{x.error("Failed to verify task")}}async function N(r){try{await j.mutateAsync(r),x.success("Verification removed")}catch{x.error("Failed to unverify task")}}return _?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(P,{className:"w-6 h-6 animate-spin text-primary-500"})}):b.length===0?e.jsx(F,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(L,{className:"w-12 h-12 text-stone-300 mx-auto mb-3"}),e.jsx("h3",{className:"font-semibold text-stone-900 mb-1",children:"No student onboarding tasks"}),e.jsx("p",{className:"text-sm text-stone-500",children:"Tasks will appear here when students are accepted to rotations with an active template"})]})}):e.jsx("div",{className:"space-y-3",children:b.map(([r,m])=>{const l=m.application,h=m.tasks.filter(t=>t.is_required),a=h.filter(t=>t.completed_at),n=h.filter(t=>t.verified_at),o=h.length>0?Math.round(a.length/h.length*100):100,u=A===r;return e.jsxs(F,{children:[e.jsxs("button",{onClick:()=>C(u?null:r),className:"w-full text-left",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-9 h-9 rounded-full bg-primary-100 flex items-center justify-center text-primary-700 font-semibold text-sm",children:[l?.student?.first_name?.[0],l?.student?.last_name?.[0]]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-stone-900 text-sm",children:[l?.student?.first_name," ",l?.student?.last_name]}),e.jsxs("p",{className:"text-xs text-stone-500",children:[l?.slot?.site?.name," â€” ",l?.slot?.title||l?.slot?.specialty]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-semibold text-stone-900",children:[o,"%"]}),e.jsxs("div",{className:"text-xs text-stone-500",children:[n.length,"/",h.length," verified"]})]}),u?e.jsx(W,{className:"w-4 h-4 text-stone-400"}):e.jsx(K,{className:"w-4 h-4 text-stone-400"})]})]}),e.jsx("div",{className:"mt-2 w-full bg-stone-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-primary-500 h-1.5 rounded-full transition-all",style:{width:`${o}%`}})})]}),u&&e.jsx("div",{className:"mt-4 space-y-2 border-t border-stone-100 pt-4",children:m.tasks.map(t=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-xl border ${t.verified_at?"bg-green-50 border-green-200":t.completed_at?"bg-amber-50 border-amber-200":"bg-stone-50 border-stone-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.verified_at?e.jsx(O,{className:"w-5 h-5 text-green-500"}):t.completed_at?e.jsx(X,{className:"w-5 h-5 text-amber-500"}):e.jsx(ee,{className:"w-5 h-5 text-stone-300"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-stone-900",children:t.title}),t.description&&e.jsx("p",{className:"text-xs text-stone-500",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[t.is_required&&e.jsx(k,{variant:"warning",size:"sm",children:"Required"}),t.verified_at&&e.jsx(k,{variant:"success",size:"sm",children:"Verified"}),t.completed_at&&!t.verified_at&&e.jsx(k,{variant:"primary",size:"sm",children:"Completed"})]}),t.file_name&&e.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[e.jsx(Y,{className:"w-3 h-3 text-stone-400"}),e.jsxs("a",{href:Q.downloadFileUrl(t.id),target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary-600 hover:text-primary-700 font-medium flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"})," ",t.file_name]})]})]})]}),e.jsxs("div",{children:[t.completed_at&&!t.verified_at&&e.jsxs(y,{size:"sm",onClick:()=>g(t.id),isLoading:f.isPending,children:[e.jsx(O,{className:"w-3.5 h-3.5 mr-1"})," Verify"]}),t.verified_at&&e.jsx("button",{onClick:()=>N(t.id),className:"text-xs text-stone-500 hover:text-red-500",children:"Undo"})]})]},t.id))})]},r)})})}function qe(){const{data:w,isLoading:_}=J(),{data:f}=fe(),j=je(),A=ge(),C=be(),[S,b]=p.useState(null),g=new Map,N=w?.tasks??[],r=(f?.data??[]).filter(a=>a.status==="accepted"),m=p.useMemo(()=>{const a={};for(const n of N)a[n.application_id]||(a[n.application_id]=[]),a[n.application_id].push(n);return a},[N]);async function l(a){try{a.completed_at?await A.mutateAsync(a.id):await j.mutateAsync(a.id)}catch(n){const o=n instanceof Error?n.message:"Failed to update task";x.error(o)}}async function h(a,n){if(n.size>20*1024*1024){x.error("File too large. Maximum size is 20MB.");return}try{await C.mutateAsync({taskId:a,file:n}),x.success("File uploaded")}catch(o){const u=o instanceof Error?o.message:"Failed to upload";x.error(u)}}return _?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(P,{className:"w-6 h-6 animate-spin text-primary-500"})}):r.length===0?e.jsx(F,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(L,{className:"w-12 h-12 text-stone-300 mx-auto mb-3"}),e.jsx("h3",{className:"font-semibold text-stone-900 mb-1",children:"No onboarding checklists"}),e.jsx("p",{className:"text-sm text-stone-500",children:"Checklists will appear here after your rotation application is accepted"})]})}):e.jsx("div",{className:"space-y-4",children:r.map(a=>{const n=m[a.id]||[],o=n.filter(i=>i.is_required),u=o.filter(i=>i.completed_at),t=o.length>0?Math.round(u.length/o.length*100):100,T=S===a.id,q=o.length>0&&u.length===o.length;return e.jsxs(F,{children:[e.jsxs("button",{onClick:()=>b(T?null:a.id),className:"w-full text-left",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-stone-900",children:a.slot?.title||a.slot?.specialty}),e.jsxs("p",{className:"text-xs text-stone-500 flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"})," ",a.slot?.site?.name]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[n.length===0?e.jsx(k,{size:"sm",children:"No checklist"}):q?e.jsx(k,{variant:"success",size:"sm",children:"Complete"}):e.jsxs("span",{className:"text-sm font-semibold text-primary-600",children:[t,"%"]}),T?e.jsx(W,{className:"w-4 h-4 text-stone-400"}):e.jsx(K,{className:"w-4 h-4 text-stone-400"})]})]}),n.length>0&&e.jsx("div",{className:"mt-2 w-full bg-stone-200 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full transition-all ${q?"bg-green-500":"bg-primary-500"}`,style:{width:`${t}%`}})})]}),T&&n.length>0&&e.jsx("div",{className:"mt-4 space-y-2 border-t border-stone-100 pt-4",children:n.map(i=>e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-xl border transition-colors ${i.verified_at?"bg-green-50 border-green-200":i.completed_at?"bg-primary-50 border-primary-200":"bg-white border-stone-200 hover:border-stone-300"}`,children:[e.jsx("button",{onClick:()=>l(i),disabled:!!i.verified_at||j.isPending||A.isPending,className:"shrink-0",children:i.verified_at?e.jsx(O,{className:"w-5 h-5 text-green-500"}):i.completed_at?e.jsx(X,{className:"w-5 h-5 text-primary-500"}):e.jsx(ee,{className:"w-5 h-5 text-stone-300 hover:text-primary-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm font-medium ${i.completed_at?"text-stone-500 line-through":"text-stone-900"}`,children:i.title}),i.description&&e.jsx("p",{className:"text-xs text-stone-500 mt-0.5",children:i.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[i.is_required&&e.jsx(k,{variant:"warning",size:"sm",children:"Required"}),i.verified_at&&e.jsx("span",{className:"text-[11px] text-green-600",children:"Verified by site"}),i.completed_at&&!i.verified_at&&e.jsxs("span",{className:"text-[11px] text-stone-400",children:["Completed ",new Date(i.completed_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"mt-1.5",children:[i.file_name?e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Y,{className:"w-3 h-3 text-stone-400"}),e.jsxs("a",{href:Q.downloadFileUrl(i.id),target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary-600 hover:text-primary-700 font-medium flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"})," ",i.file_name]}),!i.verified_at&&e.jsx("button",{onClick:c=>{c.stopPropagation(),g.get(i.id)?.click()},className:"text-xs text-stone-500 hover:text-stone-700 ml-1",children:"Replace"})]}):i.verified_at?null:e.jsxs("button",{onClick:c=>{c.stopPropagation(),g.get(i.id)?.click()},disabled:C.isPending,className:"inline-flex items-center gap-1 text-xs text-primary-600 hover:text-primary-700 font-medium py-0.5 px-1.5 rounded hover:bg-primary-50 transition-colors disabled:opacity-50",children:[C.isPending?e.jsx(P,{className:"w-3 h-3 animate-spin"}):e.jsx(we,{className:"w-3 h-3"}),"Attach file"]}),e.jsx("input",{ref:c=>{c&&g.set(i.id,c)},type:"file",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",className:"hidden",onChange:c=>{c.target.files?.[0]&&(h(i.id,c.target.files[0]),c.target.value="")}})]})]})]},i.id))}),T&&n.length===0&&e.jsx("div",{className:"mt-4 border-t border-stone-100 pt-4 text-center text-sm text-stone-400",children:"No onboarding checklist for this rotation"})]},a.id)})})}function Ge(){Ne("Onboarding Checklists");const{user:w}=le(),_=w?.role==="site_manager"||w?.role==="admin",[f,j]=p.useState("templates");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-stone-900",children:"Onboarding"}),e.jsx("p",{className:"text-sm text-stone-500 mt-1",children:_?"Manage onboarding checklists and verify student completion":"Complete your onboarding requirements before starting rotations"})]}),_?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-1 bg-stone-100 rounded-xl p-1 w-fit",children:[e.jsxs("button",{onClick:()=>j("templates"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${f==="templates"?"bg-white text-stone-900 shadow-sm":"text-stone-600 hover:text-stone-900"}`,children:[e.jsx(oe,{className:"w-4 h-4 inline mr-1.5 -mt-0.5"}),"Templates"]}),e.jsxs("button",{onClick:()=>j("progress"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${f==="progress"?"bg-white text-stone-900 shadow-sm":"text-stone-600 hover:text-stone-900"}`,children:[e.jsx(ve,{className:"w-4 h-4 inline mr-1.5 -mt-0.5"}),"Student Progress"]})]}),f==="templates"?e.jsx(Ae,{}):e.jsx(Se,{})]}):e.jsx(qe,{})]})}export{Ge as OnboardingChecklists};
