import{y as L,u as k,a as D,bc as P,r as y,j as e,w as C,B as z,f as u,m as B,S as w,U as g,H as _,a1 as S,af as T,L as U,e as $,bd as I,be as R,t as M}from"./index-GzcG7CSS.js";import{C as d}from"./Card-FSc1waky.js";import{B as F}from"./Breadcrumbs-B2TfZ2DQ.js";import{B as c}from"./Badge-9_pL70Ln.js";import{M as O}from"./Modal-CA0K5bCb.js";import{u as E}from"./usePageTitle-CSRQyC0a.js";import{C as H}from"./circle-check-DXK6A2lJ.js";import{M as G}from"./map-pin-B8WKBtoC.js";import{P as q}from"./phone-D6Tod6__.js";import{G as V}from"./globe-DMMzYTpl.js";import{S as W}from"./star-CqpiQmYF.js";import{S as A}from"./shield-B4OQBYN4.js";import{P as J}from"./pencil-Cb-MolFd.js";import"./chevron-right-D8jrJqqK.js";const b={open:"success",filled:"warning",closed:"default",active:"success",draft:"default",pending_review:"warning",expired:"danger",terminated:"danger",accepted:"success",pending:"warning",declined:"danger",completed:"success",withdrawn:"default"};function de(){E("Site Details");const{id:p}=L(),f=k(),{user:o}=D(),{data:t,isLoading:N}=P(p),[m,j]=y.useState(!1),v=o?.role==="admin";if(N)return e.jsx("div",{className:"flex justify-center py-24",children:e.jsx(C,{className:"w-8 h-8 animate-spin text-primary-500"})});if(!t)return e.jsxs("div",{className:"text-center py-24",children:[e.jsx(z,{className:"w-12 h-12 text-stone-300 mx-auto mb-3"}),e.jsx("h2",{className:"text-lg font-semibold text-stone-900",children:"Site not found"}),e.jsxs(u,{variant:"outline",className:"mt-4",onClick:()=>f("/sites"),children:[e.jsx(B,{className:"w-4 h-4 mr-2"})," Back to Sites"]})]});const i=t.slots||[],l=t.affiliation_agreements||[],x=t.onboarding_templates||[];t.invites;const r=[];for(const s of i)for(const n of s.applications||[])n.student&&r.push({id:n.student.id,first_name:n.student.first_name,last_name:n.student.last_name,email:n.student.email,status:n.status,slot_title:s.title,specialty:s.specialty});const h=new Map;for(const s of i)if(s.preceptor){const n=h.get(s.preceptor.id);n?n.slots.push(s.title):h.set(s.preceptor.id,{id:s.preceptor.id,first_name:s.preceptor.first_name,last_name:s.preceptor.last_name,email:s.preceptor.email,slots:[s.title]})}const a=Array.from(h.values());return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(F,{items:[{label:"Sites Directory",path:"/sites"},{label:t.name}]}),e.jsxs("div",{className:"bg-gradient-to-r from-primary-50 to-secondary-50 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-stone-900",children:t.name}),t.is_verified&&e.jsxs(c,{variant:"success",children:[e.jsx(H,{className:"w-3 h-3 mr-1"}),"Verified"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mt-2 text-sm text-stone-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4 text-stone-400"})," ",t.address,", ",t.city,", ",t.state," ",t.zip]}),t.phone&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"w-4 h-4 text-stone-400"})," ",t.phone]}),t.website&&e.jsxs("a",{href:t.website,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-primary-600 hover:underline",children:[e.jsx(V,{className:"w-4 h-4"})," Website"]})]}),t.description&&e.jsx("p",{className:"mt-3 text-sm text-stone-600 max-w-2xl",children:t.description})]}),e.jsxs("div",{className:"text-right shrink-0",children:[t.rating>0&&e.jsxs("div",{className:"flex items-center gap-1 text-amber-600",children:[e.jsx(W,{className:"w-5 h-5 fill-current"}),e.jsx("span",{className:"text-xl font-bold",children:t.rating}),e.jsxs("span",{className:"text-sm text-stone-400",children:["(",t.review_count,")"]})]}),t.ehr_system&&e.jsxs("p",{className:"text-xs text-stone-500 mt-1",children:["EHR: ",t.ehr_system]})]})]}),t.specialties?.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:t.specialties.map(s=>e.jsx(c,{variant:"default",children:s},s))})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-3",children:[{icon:e.jsx(w,{className:"w-5 h-5"}),label:"Rotation Slots",value:i.length,color:"bg-primary-50 text-primary-600"},{icon:e.jsx(g,{className:"w-5 h-5"}),label:"Preceptors",value:a.length,color:"bg-secondary-50 text-secondary-600"},{icon:e.jsx(g,{className:"w-5 h-5"}),label:"Students",value:r.length,color:"bg-green-50 text-green-600"},{icon:e.jsx(_,{className:"w-5 h-5"}),label:"Agreements",value:l.length,color:"bg-amber-50 text-amber-600"},{icon:e.jsx(S,{className:"w-5 h-5"}),label:"Templates",value:x.length,color:"bg-stone-100 text-stone-600"}].map(s=>e.jsxs("div",{className:"bg-white rounded-xl border border-stone-200 p-4 text-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl ${s.color} flex items-center justify-center mx-auto mb-2`,children:s.icon}),e.jsx("p",{className:"text-xl font-bold text-stone-900",children:s.value}),e.jsx("p",{className:"text-xs text-stone-500",children:s.label})]},s.label))}),e.jsxs(d,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-sm font-semibold text-stone-900 flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-primary-500"})," Site Manager"]}),v&&e.jsx(u,{size:"sm",variant:"outline",onClick:()=>j(!0),children:t.manager?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-3.5 h-3.5 mr-1"})," Change"]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-3.5 h-3.5 mr-1"})," Assign"]})})]}),t.manager?e.jsxs(U,{to:`/users/${t.manager.id}`,className:"flex items-center gap-3 hover:opacity-80 transition-opacity",children:[e.jsxs("div",{className:"w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center text-primary-700 font-semibold text-sm",children:[t.manager.first_name?.[0],t.manager.last_name?.[0]]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-stone-900",children:[t.manager.first_name," ",t.manager.last_name]}),e.jsx("p",{className:"text-xs text-stone-500",children:t.manager.email})]})]}):e.jsx("p",{className:"text-sm text-stone-400 text-center py-4",children:"No manager assigned to this site."})]}),m&&e.jsx(K,{siteId:p,currentManagerId:t.manager?.id,onClose:()=>j(!1)}),e.jsxs(d,{children:[e.jsxs("h2",{className:"text-sm font-semibold text-stone-900 mb-3 flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4 text-primary-500"})," Rotation Slots (",i.length,")"]}),i.length===0?e.jsx("p",{className:"text-sm text-stone-400 py-4 text-center",children:"No rotation slots yet"}):e.jsx("div",{className:"space-y-2",children:i.map(s=>e.jsx("div",{className:"p-4 bg-stone-50 rounded-xl",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-stone-900",children:s.title}),e.jsxs("p",{className:"text-xs text-stone-500",children:[s.specialty," - ",s.shift_schedule||""]}),s.preceptor&&e.jsxs("p",{className:"text-xs text-stone-500 mt-1",children:["Preceptor: ",s.preceptor.first_name," ",s.preceptor.last_name]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs(c,{variant:b[s.status]||"default",size:"sm",children:[s.status," (",s.filled,"/",s.capacity,")"]}),e.jsxs("div",{className:"text-xs text-stone-400 mt-1",children:[e.jsx($,{className:"w-3 h-3 inline mr-0.5"}),new Date(s.start_date).toLocaleDateString()," - ",new Date(s.end_date).toLocaleDateString()]})]})]})},s.id))})]}),a.length>0&&e.jsxs(d,{children:[e.jsxs("h2",{className:"text-sm font-semibold text-stone-900 mb-3 flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4 text-primary-500"})," Preceptors (",a.length,")"]}),e.jsx("div",{className:"space-y-2",children:a.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-stone-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-9 h-9 rounded-full bg-secondary-100 flex items-center justify-center text-secondary-700 font-semibold text-sm",children:[s.first_name[0],s.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-stone-900",children:[s.first_name," ",s.last_name]}),e.jsx("p",{className:"text-xs text-stone-500",children:s.email})]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 justify-end",children:s.slots.map(n=>e.jsx(c,{variant:"default",size:"sm",children:n},n))})]},s.id))})]}),r.length>0&&e.jsxs(d,{children:[e.jsxs("h2",{className:"text-sm font-semibold text-stone-900 mb-3 flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4 text-primary-500"})," Students (",r.length,")"]}),e.jsx("div",{className:"space-y-2",children:r.map((s,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-stone-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-9 h-9 rounded-full bg-green-100 flex items-center justify-center text-green-700 font-semibold text-sm",children:[s.first_name[0],s.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-stone-900",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-xs text-stone-500",children:[s.slot_title," - ",s.specialty]})]})]}),e.jsx(c,{variant:b[s.status]||"default",size:"sm",children:s.status})]},`${s.id}-${n}`))})]}),l.length>0&&e.jsxs(d,{children:[e.jsxs("h2",{className:"text-sm font-semibold text-stone-900 mb-3 flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 text-primary-500"})," Affiliation Agreements (",l.length,")"]}),e.jsx("div",{className:"space-y-2",children:l.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-stone-50 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-stone-900",children:s.university?.name||"Unknown University"}),e.jsxs("p",{className:"text-xs text-stone-500",children:[s.start_date?new Date(s.start_date).toLocaleDateString():"?"," - ",s.end_date?new Date(s.end_date).toLocaleDateString():"?"]})]}),e.jsx(c,{variant:b[s.status]||"default",size:"sm",children:s.status})]},s.id))})]}),x.length>0&&e.jsxs(d,{children:[e.jsxs("h2",{className:"text-sm font-semibold text-stone-900 mb-3 flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4 text-primary-500"})," Onboarding Templates (",x.length,")"]}),e.jsx("div",{className:"space-y-2",children:x.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-stone-50 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-stone-900",children:s.name}),s.description&&e.jsx("p",{className:"text-xs text-stone-500",children:s.description})]}),e.jsx(c,{variant:s.is_active?"success":"default",size:"sm",children:s.is_active?"Active":"Inactive"})]},s.id))})]})]})}function K({siteId:p,currentManagerId:f,onClose:o}){const[t,N]=y.useState(""),[m,j]=y.useState(null),{data:v,isLoading:i}=I({role:"site_manager"}),l=R(),r=(v?.data||[]).filter(a=>{if(a.id===f)return!1;if(!t)return!0;const s=t.toLowerCase();return`${a.first_name} ${a.last_name}`.toLowerCase().includes(s)||a.email.toLowerCase().includes(s)}),h=async()=>{if(m)try{const a=await l.mutateAsync({siteId:p,managerId:m});M.success(a.message),o()}catch(a){M.error(a.message||"Failed to assign manager.")}};return e.jsx(O,{isOpen:!0,onClose:o,title:f?"Change Site Manager":"Assign Site Manager",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Search site managers...",value:t,onChange:a=>N(a.target.value),className:"w-full px-3 py-2 border border-stone-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-500"}),i?e.jsx("div",{className:"flex justify-center py-6",children:e.jsx(C,{className:"w-5 h-5 animate-spin text-stone-400"})}):r.length>0?e.jsx("div",{className:"max-h-64 overflow-y-auto border border-stone-200 rounded-xl divide-y divide-stone-100",children:r.map(a=>e.jsxs("label",{className:"flex items-center gap-3 px-4 py-3 hover:bg-stone-50 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"manager",checked:m===a.id,onChange:()=>j(a.id),className:"border-stone-300 text-primary-500 focus:ring-primary-500"}),e.jsxs("div",{className:"w-8 h-8 rounded-full bg-primary-100 flex items-center justify-center text-primary-700 font-semibold text-xs shrink-0",children:[a.first_name[0],a.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-stone-900",children:[a.first_name," ",a.last_name]}),e.jsx("p",{className:"text-xs text-stone-500",children:a.email})]})]},a.id))}):e.jsx("p",{className:"text-sm text-stone-400 text-center py-4",children:"No site managers available."}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx(u,{variant:"outline",onClick:o,children:"Cancel"}),e.jsxs(u,{onClick:h,isLoading:l.isPending,disabled:!m,children:[e.jsx(A,{className:"w-4 h-4 mr-2"})," Assign Manager"]})]})]})})}export{de as SiteDetail};
